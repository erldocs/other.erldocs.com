<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>elysium_queue (elysium) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>elysium_queue</h1>
<h2 class="modsummary">     
Elysium_fsm is a gen_fsm that owns a FIFO queue of Cassandra     
sessions.</h2>
<div class="description">
<p>     
Elysium_fsm is a gen_fsm that owns a FIFO queue of Cassandra     
sessions. This FSM is started before any of the Cassandra     
connections so that the ets_buffer FIFO queue can be owned by     
a process which is less volatile than the individual connections.     
A containing application can crash a connection without disrupting     
other connections, nor disrupting the smooth flow of connection     
checkin / checkout.</p>
  
     <p>To avoid serializing requests through this gen_fsm, all queues     
are assumed to be FIFO, dedicated ets_buffers. Queue Name is     
provided by the caller to avoid an ets lookup from the application     
environment. Normally, the caller will use configured_name/0     
to get the Queue Name initially, which is then stored locally     
to the client caller and used on subsequent requests.</p>
  
     There currently may only be one elysium_queue per application
     because it is a registered name and there is only one worker
     configuration.
  </div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-ets_buffer_name">ets_buffer_name() = atom()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="configured_name/0">configured_name() -&gt; undefined | {ok, ets_buffer_name()}</h3>


<div class="description">

<p>
    Fetch the queue name configured as cassandra_worker_queue in the
    elysium section of the application config.</p>
</div></div>
<div class="function">
<h3 id="start_link/1">start_link(Queue_Name::ets_buffer_name()) -&gt; {ok, pid()}</h3>


<div class="description">

<p>
    Create an ets_buffer dedicated FIFO queue using the passed in queue
    name.</p>
</div></div>
<div class="function">
<h3 id="idle_connections/1">idle_connections(Queue_Name::ets_buffer_name()) -&gt; non_neg_integer()</h3>


<div class="description">

<p>
    Report the number of queued connections, since active connections
    are removed from the available queue.</p>
</div></div>
<div class="function">
<h3 id="checkout/1">checkout(Queue_Name::ets_buffer_name()) -&gt; pid() | none_available</h3>


<div class="description">

<p>    
Allocate a seestar_session to the caller by popping an entry    
from the front of the connection queue. This function either    
returns a live pid(), or none_available to indicate that all    
connections to Cassandra are currently checked out.</p>
 
    <p>The queue name must be provided so that we can avoid serializing
    all concurrent calls through the underlying gen_fsm.</p>
</div></div>
<div class="function">
<h3 id="checkin/1">checkin(Queue_Name::ets_buffer_name(), Session_Id::pid()) -&gt; {boolean(), pos_integer()}</h3>


<div class="description">

<p>    
Checkin a seestar_session by putting it at the end of the    
available connection queue. Returns whether the checkin was    
successful (it fails if the process is dead when checkin is    
attempted), and how many connections are available after the    
checkin.</p>
 
    <p>Currently sessions stay active until they fail or are
    deliberately ended. In future, this function will include a
    small decay factor so that sessions will eventually get
    recycled.</p>
</div></div></div>

<authors>

<aname>Jay Nelson</aname>
<email>jay@duomark.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
