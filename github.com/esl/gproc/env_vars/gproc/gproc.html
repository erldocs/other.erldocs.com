<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>gproc (gproc) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>gproc</h1>
<h2 class="modsummary">Extended process registry.</h2>
<div class="description">
<p>Extended process registry
  </p><p>This module implements an extended process registry</p>
  <p>For a detailed description, see
  <url href="erlang07-wiger.pdf">erlang07-wiger.pdf</url>.</p>
 
  <p>Type and scope for registration and lookup:
 </p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-context">context() = {scope(), type()} | type()</h3></div>
    <div class="type"><h3 id="type-headpat">headpat() = {keypat(), pidpat(), ValPat}</h3></div>
    <div class="type"><h3 id="type-key">key() = {type(), scope(), any()}</h3></div>
    <div class="type"><h3 id="type-keypat">keypat() = {sel_type() | sel_var(), l | g | sel_var(), any()}</h3></div>
    <div class="type"><h3 id="type-pidpat">pidpat() = pid() | sel_var()</h3></div>
    <div class="type"><h3 id="type-scope">scope() = l | g</h3></div>
    <div class="type"><h3 id="type-sel_pattern">sel_pattern() = [{headpat(), Guards, Prod}]</h3></div>
    <div class="type"><h3 id="type-sel_scope">sel_scope() = scope | all | global | local</h3></div>
    <div class="type"><h3 id="type-sel_type">sel_type() = type() | names | props | counters | aggr_counters</h3></div>
    <div class="type"><h3 id="type-type">type() = n | p | c | a</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/0">start_link() -&gt; {ok, pid()}</h3>


<div class="description">

<p>Starts the gproc server.</p>
 
  <p>This function is intended to be called from gproc_sup, as part of
  starting the gproc application.</p>
</div></div>
<div class="function">
<h3 id="add_local_name/1">add_local_name(Name) -&gt; term()
</h3>


<div class="description">

<p>Registers a local (unique) name. @equiv reg({n,l,Name})</p>
</div></div>
<div class="function">
<h3 id="add_global_name/1">add_global_name(Name) -&gt; term()
</h3>


<div class="description">

<p>Registers a global (unique) name. @equiv reg({n,g,Name})</p>
</div></div>
<div class="function">
<h3 id="add_local_property/2">add_local_property(Name, Value) -&gt; term()
</h3>


<div class="description">

<p>Registers a local (non-unique) property. @equiv reg({p,l,Name},Value)</p>
</div></div>
<div class="function">
<h3 id="add_global_property/2">add_global_property(Name, Value) -&gt; term()
</h3>


<div class="description">

<p>Registers a global (non-unique) property. @equiv reg({p,g,Name},Value)</p>
</div></div>
<div class="function">
<h3 id="add_local_counter/2">add_local_counter(Name, Initial) -&gt; term()
</h3>


<div class="description">

<p>Registers a local (non-unique) counter. @equiv reg({c,l,Name},Value)</p>
</div></div>
<div class="function">
<h3 id="add_global_counter/2">add_global_counter(Name, Initial) -&gt; term()
</h3>


<div class="description">

<p>Registers a global (non-unique) counter. @equiv reg({c,g,Name},Value)</p>
</div></div>
<div class="function">
<h3 id="add_local_aggr_counter/1">add_local_aggr_counter(Name) -&gt; term()
</h3>


<div class="description">

<p>Registers a local (unique) aggregated counter.</p>
</div></div>
<div class="function">
<h3 id="add_global_aggr_counter/1">add_global_aggr_counter(Name) -&gt; term()
</h3>


<div class="description">

<p>Registers a global (unique) aggregated counter.</p>
</div></div>
<div class="function">
<h3 id="lookup_local_name/1">lookup_local_name(Name::any()) -&gt; pid()</h3>


<div class="description">

<p>Lookup a local unique name. Fails if there is no such name.</p>
</div></div>
<div class="function">
<h3 id="lookup_global_name/1">lookup_global_name(Name::any()) -&gt; pid()</h3>


<div class="description">

<p>Lookup a global unique name. Fails if there is no such name.</p>
</div></div>
<div class="function">
<h3 id="lookup_local_aggr_counter/1">lookup_local_aggr_counter(Name::any()) -&gt; integer()</h3>


<div class="description">

<p>Lookup a local (unique) aggregated counter and returns its value.
  Fails if there is no such object.</p>
</div></div>
<div class="function">
<h3 id="lookup_global_aggr_counter/1">lookup_global_aggr_counter(Name::any()) -&gt; integer()</h3>


<div class="description">

<p>Lookup a global (unique) aggregated counter and returns its value.
  Fails if there is no such object.</p>
</div></div>
<div class="function">
<h3 id="lookup_local_properties/1">lookup_local_properties(Property::any()) -&gt; [{pid(), Value}]</h3>


<div class="description">

<p>Look up all local (non-unique) instances of a given Property.
  Returns a list of {Pid, Value} tuples for all matching objects.</p>
</div></div>
<div class="function">
<h3 id="lookup_global_properties/1">lookup_global_properties(Property::any()) -&gt; [{pid(), Value}]</h3>


<div class="description">

<p>Look up all global (non-unique) instances of a given Property.
  Returns a list of {Pid, Value} tuples for all matching objects.</p>
</div></div>
<div class="function">
<h3 id="lookup_local_counters/1">lookup_local_counters(Counter::any()) -&gt; [{pid(), Value::integer()}]</h3>


<div class="description">

<p>Look up all local (non-unique) instances of a given Counter.
  Returns a list of {Pid, Value} tuples for all matching objects.</p>
</div></div>
<div class="function">
<h3 id="lookup_global_counters/1">lookup_global_counters(Counter::any()) -&gt; [{pid(), Value::integer()}]</h3>


<div class="description">

<p>Look up all global (non-unique) instances of a given Counter.
  Returns a list of {Pid, Value} tuples for all matching objects.</p>
</div></div>
<div class="function">
<h3 id="get_env/1">get_env(Scope::scope(), App::atom(), Key::atom()) -&gt; term()</h3>


<div class="description">
<p>Equivalent to <a href="#get_env/4" class="seealso">get_env(Scope, App, Key, [app_env])</a>.</p>
</div></div>
<div class="function">
<h3 id="get_env/1-1">get_env(Scope::scope(), App::atom(), Key::atom(), Strategy) -&gt; term()</h3>

<ul class="type">
<li><code>Strategy = [Alternative]</code></li><li><code>Alternative = app_env | os_env | inherit | {inherit, pid()} | {default, term()} | error</code></li></ul>
<div class="description">

<p>Fetch an environment value, potentially cached as a <code>gproc_env</code> property.</p>
 
  <p>This function first tries to read the value of a cached property,
  <code>{p, Scope, {gproc_env, App, Key}}</code>. If this fails, it will try the provided
  alternative strategy. <code>Strategy</code> is a list of alternatives, tried in order.  
Each alternative can be one of:</p>
 
  <p>* <code>app_env</code> - try <code>application:get_env(App, Key)</code>
  * <code>os_env</code> - try <code>os:getenv(ENV)</code>, where <code>ENV</code> is <code>Key</code> converted into an
    uppercase string
  * <code>{os_env, ENV}</code> - try <code>os:getenv(ENV)</code>
  * <code>inherit</code> - inherit the cached value, if any, held by the (proc_lib) parent.
  * <code>{inherit, Pid}</code> - inherit the cached value, if any, held by <code>Pid</code>.
  * <code>{inherit, Name}</code> - inherit the cached value, if any, held by the process
     registered in <code>gproc</code> as <code>Name</code>.
  * <code>init_arg</code> - try <code>init:get_argument(Key)</code>; expects a single value, if any.
  * <code>{mnesia, ActivityType, Oid, Pos}</code> - try
    <code>mnesia:activity(ActivityType, fun() -&gt; mnesia:read(Oid) end)</code>; retrieve the
     value in position <code>Pos</code> if object found.
  * <code>{default, Value}</code> - set a default value to return once alternatives have been
     exhausted; if not set, <code>undefined</code> will be returned.
  * <code>error</code> - raise an exception, <code>erlang:error(gproc_env, [App, Key, Scope])</code>.</p>
 
  <p>While any alternative can occur more than once, the only one that might make
  sense to repeat is <code>{default, Value}</code>.  
The last instance will be the one that determines the return value.</p>
 
  <p>The <code>error</code> option can be used to assert that a value has been previously
  cached. Alternatively, it can be used to assert that a value is either cached
  or at least defined somewhere, e.g. <code>get_env(l, mnesia, dir, [app_env, error])</code>.</p>
</div></div>
<div class="function">
<h3 id="get_set_env/1">get_set_env(Scope::scope(), App::atom(), Key::atom()) -&gt; term()</h3>


<div class="description">
<p>Equivalent to <a href="#get_set_env/4" class="seealso">get_set_env(Scope, App, Key, [app_env])</a>.</p>
</div></div>
<div class="function">
<h3 id="get_set_env/1-1">get_set_env(Scope::scope(), App::atom(), Key::atom(), Strategy) -&gt; Value</h3>


<div class="description">

<p>Fetch and cache an environment value, if not already cached.</p>
 
  <p>This function does the same thing as <a href="#get_env/4" class="seealso">get_env/4</a>, but also updates the
  cache. Note that the cache will be updated even if the result of the lookup
  is <code>undefined</code>.
 </p>
<p><em>See also:</em> <a href="#get_env/4" class="seealso">get_env/4</a>.</p>
</div></div>
<div class="function">
<h3 id="set_env/1">set_env(Scope::scope(), App::atom(), Key::atom(), Value::term(), Strategy) -&gt; Value</h3>

<ul class="type">
<li><code>Strategy = [Alternative]</code></li><li><code>Alternative = app_env | os_env | {os_env, VAR} | {mnesia, ActivityType, Oid, Pos}</code></li></ul>
<div class="description">

<p>Updates the cached value as well as underlying environment.</p>
 
  <p>This function should be exercised with caution, as it affects the larger  
environment outside gproc. This function modifies the cached value, and then  
proceeds to update the underlying environment (OS environment variable or  
application environment variable).</p>
 
  <p>When the <code>mnesia</code> alternative is used, gproc will try to update any existing
  object, changing only the <code>Pos</code> position. If no such object exists, it will
  create a new object, setting any other attributes (except <code>Pos</code> and the key)
  to <code>undefined</code>.</p>
</div></div>
<div class="function">
<h3 id="reg/1">reg(Key::key()) -&gt; true</h3>


<div class="description">
<p>Equivalent to <a href="#reg/2" class="seealso">reg(Key, default(Key))</a>.</p>
</div></div>
<div class="function">
<h3 id="default/1">default(X1) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="await/1">await(Key::key()) -&gt; {pid(), Value}</h3>


<div class="description">
<p>Equivalent to <a href="#await/2" class="seealso">await(Key, infinity)</a>.</p>
</div></div>
<div class="function">
<h3 id="await/1-1">await(Key::key(), Timeout) -&gt; {pid(), Value}</h3>

<ul class="type">
<li><code>Timeout = integer() | infinity</code></li></ul>
<div class="description">

<p>Wait for a local name to be registered.
  The function raises an exception if the timeout expires. Timeout must be
  either an interger &gt; 0 or 'infinity'.
  A small optimization: we first perform a lookup, to see if the name
  is already registered. This way, the cost of the operation will be
  roughly the same as of where/1 in the case where the name is already
  registered (the difference: await/2 also returns the value).</p>
</div></div>
<div class="function">
<h3 id="nb_wait/1">nb_wait(Key::key()) -&gt; Ref</h3>


<div class="description">

<p>Wait for a local name to be registered.
  The caller can expect to receive a message,
  {gproc, Ref, registered, {Key, Pid, Value}}, once the name is registered.</p>
</div></div>
<div class="function">
<h3 id="cancel_wait/2">cancel_wait(Key, Ref) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="reg/1-1">reg(Key::key(), Value) -&gt; true</h3>


<div class="description">

<p>Register a name or property for the current process</p>
 
 
</div></div>
<div class="function">
<h3 id="mreg/1">mreg(T::type(), X2::scope(), KVL::[{Key::any(), Value::any()}]) -&gt; true</h3>


<div class="description">

<p>Register multiple {Key,Value} pairs of a given type and scope.</p>
 
  <p>This function is more efficient than calling <a href="#reg/2" class="seealso">reg/2</a> repeatedly.</p>
</div></div>
<div class="function">
<h3 id="unreg/1">unreg(Key::key()) -&gt; true</h3>


<div class="description">

<p>Unregister a name or property.</p>
</div></div>
<div class="function">
<h3 id="unregister_name/1">unregister_name(Key) -&gt; term()
</h3>


<div class="description">
<p>Equivalent to <code>unreg / 1</code>.</p>
</div></div>
<div class="function">
<h3 id="select/1">select(Pat::select_pattern()) -&gt; [sel_object()]</h3>


<div class="description">
<p>Equivalent to <a href="#select/2" class="seealso">select(all, Pat)</a>.</p>
</div></div>
<div class="function">
<h3 id="select/1-1">select(Context::context(), Pat::sel_pattern()) -&gt; [{Key, Pid, Value}]</h3>


<div class="description">

<p>Perform a select operation on the process registry.</p>
 
  <p>The physical representation in the registry may differ from the above,
  but the select patterns are transformed appropriately.</p>
</div></div>
<div class="function">
<h3 id="select/1-2">select(Context::context(), Pat::sel_patten(), Limit::integer()) -&gt; [{Key, Pid, Value}]</h3>


<div class="description">

<p>Like <a href="#select/2" class="seealso">select/2</a> but returns Limit objects at a time.</p>
 
  <p>See <url href="http://www.erlang.org/doc/man/ets.html#select-3">http://www.erlang.org/doc/man/ets.html#select-3</url>.</p>
</div></div>
<div class="function">
<h3 id="set_value/1">set_value(Key::key(), Value) -&gt; true</h3>


<div class="description">

<p>Sets the value of the registeration entry given by Key</p>
 
  <p>Key is assumed to exist and belong to the calling process.  
If it doesn't, this function will exit.</p>
 
  <p>Value can be any term, unless the object is a counter, in which case
  it must be an integer.</p>
</div></div>
<div class="function">
<h3 id="get_value/1">get_value(Key) -&gt; Value</h3>


<div class="description">

<p>Read the value stored with a key registered to the current process.</p>
 
  <p>If no such key is registered to the current process, this function exits.</p>
</div></div>
<div class="function">
<h3 id="lookup_pid/1">lookup_pid(Key) -&gt; Pid</h3>


<div class="description">

<p>Lookup the Pid stored with a key.
 </p>
</div></div>
<div class="function">
<h3 id="lookup_value/1">lookup_value(Key) -&gt; Value</h3>


<div class="description">

<p>Lookup the value stored with a key.
 </p>
</div></div>
<div class="function">
<h3 id="where/1">where(Key::key()) -&gt; pid()</h3>


<div class="description">

<p>Returns the pid registered as Key</p>
 
  <p>The type of registration entry must be either name or aggregated counter.
  Otherwise this function will exit. Use <a href="#lookup_pids/1" class="seealso">lookup_pids/1</a> in these
  cases.</p>
</div></div>
<div class="function">
<h3 id="whereis_name/1">whereis_name(Key) -&gt; term()
</h3>


<div class="description">
<p>Equivalent to <code>where / 1</code>.</p>
</div></div>
<div class="function">
<h3 id="lookup_pids/1">lookup_pids(Key::key()) -&gt; [pid()]</h3>


<div class="description">

<p>Returns a list of pids with the published key Key</p>
 
  <p>If the type of registration entry is either name or aggregated counter,
  this function will return either an empty list, or a list of one pid.
  For non-unique types, the return value can be a list of any length.</p>
</div></div>
<div class="function">
<h3 id="lookup_values/1">lookup_values(Key::key()) -&gt; [{pid(), Value}]</h3>


<div class="description">

<p>Retrieve the <code>{Pid,Value}</code> pairs corresponding to Key.</p>
 
  <p>Key refer to any type of registry object. If it refers to a unique
  object, the list will be of length 0 or 1. If it refers to a non-unique
  object, the return value can be a list of any length.</p>
</div></div>
<div class="function">
<h3 id="update_counter/1">update_counter(Key::key(), Incr::integer()) -&gt; integer()</h3>


<div class="description">

<p>Updates the counter registered as Key for the current process.</p>
 
  <p>This function works like ets:update_counter/3
  (see <url href="http://www.erlang.org/doc/man/ets.html#update_counter-3">http://www.erlang.org/doc/man/ets.html#update_counter-3</url>), but
  will fail if the type of object referred to by Key is not a counter.</p>
</div></div>
<div class="function">
<h3 id="give_away/1">give_away(From::key(), To::pid() | key()) -&gt; undefined | pid()</h3>


<div class="description">

<p>Atomically transfers the key <code>From</code> to the process identified by <code>To</code>.</p>
 
  <p>This function transfers any gproc key (name, property, counter, aggr. counter)  
from one process to another, and returns the pid of the new owner.</p>
 
  <p><code>To</code> must be either a pid or a unique name (name or aggregated counter), but
  does not necessarily have to resolve to an existing process. If there is
  no process registered with the <code>To</code> key, <code>give_away/2</code> returns <code>undefined</code>,
  and the <code>From</code> key is effectively unregistered.</p>
 
  <p>It is allowed to give away a key to oneself, but of course, this operation  
will have no effect.</p>
 
  <p>Fails with <code>badarg</code> if the calling process does not have a <code>From</code> key
  registered.</p>
</div></div>
<div class="function">
<h3 id="send/1">send(Key::key(), Msg::any()) -&gt; Msg</h3>


<div class="description">

<p>Sends a message to the process, or processes, corresponding to Key.</p>
 
  <p>If Key belongs to a unique object (name or aggregated counter), this
  function will send a message to the corresponding process, or fail if there
  is no such process. If Key is for a non-unique object type (counter or
  property), Msg will be send to all processes that have such an object.</p>
</div></div>
<div class="function">
<h3 id="first/1">first(Context::context()) -&gt; key() | '$end_of_table'</h3>


<div class="description">

<p>Behaves as ets:first(Tab) for a given type of registration object.</p>
 
  <p>See <url href="http://www.erlang.org/doc/man/ets.html#first-1">http://www.erlang.org/doc/man/ets.html#first-1</url>.
   The registry behaves as an ordered_set table.</p>
</div></div>
<div class="function">
<h3 id="last/1">last(Context::context()) -&gt; key() | '$end_of_table'</h3>


<div class="description">

<p>Behaves as ets:last(Tab) for a given type of registration object.</p>
 
  <p>See <url href="http://www.erlang.org/doc/man/ets.html#last-1">http://www.erlang.org/doc/man/ets.html#last-1</url>.
  The registry behaves as an ordered_set table.</p>
</div></div>
<div class="function">
<h3 id="next/1">next(Context::context(), Key::key()) -&gt; key() | '$end_of_table'</h3>


<div class="description">

<p>Behaves as ets:next(Tab,Key) for a given type of registration object.</p>
 
  <p>See <url href="http://www.erlang.org/doc/man/ets.html#next-2">http://www.erlang.org/doc/man/ets.html#next-2</url>.
  The registry behaves as an ordered_set table.</p>
</div></div>
<div class="function">
<h3 id="prev/1">prev(Context::context(), Key::key()) -&gt; key() | '$end_of_table'</h3>


<div class="description">

<p>Behaves as ets:prev(Tab,Key) for a given type of registration object.</p>
 
  <p>See <url href="http://www.erlang.org/doc/man/ets.html#prev-2">http://www.erlang.org/doc/man/ets.html#prev-2</url>.
  The registry behaves as an ordered_set table.</p>
</div></div>
<div class="function">
<h3 id="info/1">info(Pid::pid()) -&gt; ProcessInfo</h3>

<ul class="type">
<li><code>ProcessInfo = [{gproc, [{Key, Value}]} | ProcessInfo]</code></li></ul>
<div class="description">

<p>Similar to <code>process_info(Pid)</code> but with additional gproc info.</p>
 
  <p>Returns the same information as process_info(Pid), but with the
  addition of a <code>gproc</code> information item, containing the <code>{Key,Value}</code>
  pairs registered to the process.</p>
</div></div>
<div class="function">
<h3 id="info/1-1">info(Pid::pid(), Item::atom()) -&gt; {Item, Info}</h3>


<div class="description">

<p>Similar to process_info(Pid, Item), but with additional gproc info.</p>
 
  <p>For <code>Item = gproc</code>, this function returns a list of <code>{Key, Value}</code> pairs
  registered to the process Pid. For other values of Item, it returns the
  same as <url href="http://www.erlang.org/doc/man/erlang.html#process_info-2">http://www.erlang.org/doc/man/erlang.html#process_info-2</url>.</p>
</div></div>
<div class="function">
<h3 id="audit_process/1">audit_process(Pid::pid()) -&gt; ok</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="table/1">table(Context::context()) -&gt; any()</h3>


<div class="description">
<p>Equivalent to <a href="#table/2" class="seealso">table(Context, [])</a>.</p>
</div></div>
<div class="function">
<h3 id="table/1-1">table(Context::context(), Opts) -&gt; any()</h3>


<div class="description">

<p>QLC table generator for the gproc registry.
  Context specifies which subset of the registry should be queried.
  See <url href="http://www.erlang.org/doc/man/qlc.html">http://www.erlang.org/doc/man/qlc.html</url>.</p>
</div></div></div>

<authors>

<aname>Ulf Wiger</aname>
<email>ulf.wiger@erlang-consulting.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
