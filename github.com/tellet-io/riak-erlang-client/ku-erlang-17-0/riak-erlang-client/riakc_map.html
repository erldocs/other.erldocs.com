<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riakc_map (riak-erlang-client) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riakc_map</h1>
<h2 class="modsummary">Encapsulates a map data-type.</h2>
<div class="description">
<p>Encapsulates a map data-type. Maps differ from Erlang's dict
  types in several ways:</p>
  <list>
  <item><p>Maps are special key-value structures where the key is a pair
  of a binary name and data type, and the value is a container of the
  specified type, e.g. <code>{&lt;&lt;"friends"&gt;&gt;, set} -&gt; riakc_set:set()</code>.
  Regular Erlang terms may not be values in the map, but could be
  serialized into <code>register</code> fields if last-write-wins semantics are
  sufficient.</p></item>
  <item><p>Like the other eventually-consistent types, updates are not
  applied to local state. Instead, additions, removals, and
  modifications are captured for later application by Riak. Use
  <code>dirty_value/1</code> to access a local "view" of the updates.</p></item>
  <item><p>You may not "store" values in a map, but you may create new
  entries using <code>add/2</code>, which inserts an empty value of the
  specified type. Existing or non-existing entries can be modified
  using <code>update/3</code>, which is analogous to <code>dict:update/3</code>. If the
  entry is not present, it will be populated with a new value before
  the update function is applied. The update function will receive
  the appropriate container type as its sole argument.</p></item>
  <item><p>Like sets, removals will be processed before additions and
  updates in Riak. Removals performed without a context may result in
  failure.</p></item>
  <item><p>Adding or updating an entry followed by removing that same
  entry will result in no operation being recorded. Likewise,
  removing an entry followed by adding or updating that entry will
  cancel the removal operation.</p></item>
  </list></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-crdt_map">crdt_map() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#map{value = [<a href="#type-raw_entry" class="seealso">raw_entry()</a>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updates = [<a href="#type-entry" class="seealso">entry()</a>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adds = <a href="ordsets.html#type-ordset" class="seealso">ordsets:ordset</a>(<a href="#type-key" class="seealso">key()</a>),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removes = <a href="ordsets.html#type-ordset" class="seealso">ordsets:ordset</a>(<a href="#type-key" class="seealso">key()</a>),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context = <a href="riakc_datatype.html#type-context" class="seealso">riakc_datatype:context()</a>}</h3></div>
    <div class="type"><h3 id="type-datatype">datatype() = counter | flag | register | set | map</h3></div>
    <div class="type"><h3 id="type-embedded_type_op">embedded_type_op() = <a href="riakc_counter.html#type-counter_op" class="seealso">riakc_counter:counter_op()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="riakc_set.html#type-set_op" class="seealso">riakc_set:set_op()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="riakc_flag.html#type-flag_op" class="seealso">riakc_flag:flag_op()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="riakc_register.html#type-register_op" class="seealso">riakc_register:register_op()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="#type-map_op" class="seealso">map_op()</a></h3></div>
    <div class="type"><h3 id="type-entry">entry() = {<a href="#type-key" class="seealso">key()</a>, <a href="riakc_datatype.html#type-datatype" class="seealso">riakc_datatype:datatype()</a>}</h3></div>
    <div class="type"><h3 id="type-field_update">field_update() = {update, <a href="#type-key" class="seealso">key()</a>, <a href="#type-embedded_type_op" class="seealso">embedded_type_op()</a>}</h3></div>
    <div class="type"><h3 id="type-key">key() = {binary(), <a href="#type-datatype" class="seealso">datatype()</a>}</h3></div>
    <div class="type"><h3 id="type-map_op">map_op() = {update, [<a href="#type-simple_map_op" class="seealso">simple_map_op()</a>]}</h3></div>
    <div class="type"><h3 id="type-raw_entry">raw_entry() = {<a href="#type-key" class="seealso">key()</a>, term()}</h3></div>
    <div class="type"><h3 id="type-simple_map_op">simple_map_op() = {add, <a href="#type-key" class="seealso">key()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {remove, <a href="#type-key" class="seealso">key()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="#type-field_update" class="seealso">field_update()</a></h3></div>
    <div class="type"><h3 id="type-update_fun">update_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((<a href="riakc_datatype.html#type-datatype" class="seealso">riakc_datatype:datatype()</a>) -> <a href="riakc_datatype.html#type-datatype" class="seealso">riakc_datatype:datatype()</a>)</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="new/0">new() -&gt; crdt_map()</h3>


<div class="description">

<p>Creates a new, empty map container type.</p>
</div></div>
<div class="function">
<h3 id="new/1">new(Values::[raw_entry()], Context::context() (see module riakc_datatype)) -&gt; crdt_map()</h3>


<div class="description">

<p>Creates a new map with the specified key-value pairs and context.</p>
</div></div>
<div class="function">
<h3 id="value/1">value(Map::crdt_map()) -&gt; [raw_entry()]</h3>


<div class="description">

<p>Gets the original value of the map.</p>
</div></div>
<div class="function">
<h3 id="dirty_value/1">dirty_value(Map::crdt_map()) -&gt; [raw_entry()]</h3>


<div class="description">

<p>Gets the value of the map after local updates are applied.</p>
</div></div>
<div class="function">
<h3 id="to_op/1">to_op(Map::crdt_map()) -&gt; update(map_op()) (see module riakc_datatype)</h3>


<div class="description">

<p>Extracts an operation from the map that can be encoded into an
  update request.</p>
</div></div>
<div class="function">
<h3 id="is_type/1">is_type(T::term()) -&gt; boolean()</h3>


<div class="description">

<p>Determines whether the passed term is a map container.</p>
</div></div>
<div class="function">
<h3 id="type/0">type() -&gt; atom()</h3>


<div class="description">

<p>Returns the symbolic name of this container.</p>
</div></div>
<div class="function">
<h3 id="add/1">add(Key::key(), Map::crdt_map()) -&gt; crdt_map()</h3>


<div class="description">

<p>Adds a key to the map, inserting the empty value for its type.
  Adding a key that already exists in the map has no effect. If the
  key has been previously removed from the map, the removal will be
  discarded, but no explicit add will be recorded.</p>
</div></div>
<div class="function">
<h3 id="erase/1">erase(Key::key(), Map::crdt_map()) -&gt; crdt_map()</h3>


<div class="description">

<p>Removes a key and its value from the map. Removing a key that
  does not exist simply records a remove operation. Removing a key
  whose value has been added via <code>add/2</code> or locally modified via
  <code>update/3</code> nullifies any of those modifications, without recording
  a remove operation.</p>
</div></div>
<div class="function">
<h3 id="update/1">update(Key::key(), Fun::update_fun(), Map::crdt_map()) -&gt; crdt_map()</h3>


<div class="description">

<p>Updates the value stored at the key by calling the passed
  function to get the new value. If the key did not previously exist,
  it will be initialized to the empty value for its type before being
  passed to the function. If the key was previously removed with
  <code>erase/2</code>, the remove operation will be nullified.</p>
</div></div>
<div class="function">
<h3 id="size/1">size(Map::crdt_map()) -&gt; pos_integer()</h3>


<div class="description">

<p>Returns the number of entries in the map.</p>
</div></div>
<div class="function">
<h3 id="fetch/1">fetch(Key::key(), Map::crdt_map()) -&gt; term()</h3>


<div class="description">

<p>Returns the "unwrapped" value associated with the key in the
  map. If the key is not present, an exception is generated.</p>
</div></div>
<div class="function">
<h3 id="find/1">find(Key::key(), Map::crdt_map()) -&gt; {ok, term()} | error</h3>


<div class="description">

<p>Searches for a key in the map. Returns <code>{ok, UnwrappedValue}</code>
  when the key is present, or <code>error</code> if the key is not present in
  the map.</p>
</div></div>
<div class="function">
<h3 id="is_key/1">is_key(Key::key(), Map::crdt_map()) -&gt; boolean()</h3>


<div class="description">

<p>Test if the key is contained in the map.</p>
</div></div>
<div class="function">
<h3 id="fetch_keys/1">fetch_keys(Map::crdt_map()) -&gt; [key()]</h3>


<div class="description">

<p>Returns a list of all keys in the map.</p>
</div></div>
<div class="function">
<h3 id="fold/1">fold(Fun::(key(), term(), term()) -&gt; term(), Acc0::term(), Map::crdt_map()) -&gt; term()</h3>


<div class="description">

<p>Folds over the entries in the map. This yields raw values,
  not container types.</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
