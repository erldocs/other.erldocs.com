<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>agent_auth_mnesia (openacd) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>agent_auth_mnesia</h1>
<h2 class="modsummary">Connection to the local authenication cache and integration to another module.</h2>
<div class="description">
<p>Connection to the local authenication cache and integration to another module.
  Authentication is first checked by the integration module (if any).  If that fails,
  this module will fall back to it's local cache in the mnesia 'agent_auth' table.
  the cache table is both ram and disc copies on all nodes.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-profile">profile() = string()</h3></div>
    <div class="type"><h3 id="type-profile_data">profile_data() = {<a href="#type-profile" class="seealso">profile()</a>, <a href="#type-skill_list" class="seealso">skill_list()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="#type-profile" class="seealso">profile()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="#type-skill_list" class="seealso">skill_list()</a></h3></div>
    <div class="type"><h3 id="type-profile_name">profile_name() = string()</h3></div>
    <div class="type"><h3 id="type-profile_option">profile_option() = hidden<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| isolated<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {queues, [string()]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {profiles, [string()]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {clients, [string()]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {graphed, boolean()}</h3></div>
    <div class="type"><h3 id="type-security_level">security_level() = agent | supervisor | admin</h3></div>
    <div class="type"><h3 id="type-skill">skill() = atom() | {atom(), any()}</h3></div>
    <div class="type"><h3 id="type-skill_list">skill_list() = [<a href="#type-skill" class="seealso">skill()</a>]</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start/0">start() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="new_release/1">new_release(Rec::#release_opt{id=undefined | pos_integer(), label=undefined | string(), bias=-1 | 0 | 1, timestamp=pos_integer()}) -&gt; {ok, any()} | {aborted, any()}</h3>


<div class="description">

<p>Add <code>#release_opt{} Rec</code> to the database.</p>
</div></div>
<div class="function">
<h3 id="destroy_release/1">destroy_release(Label::string()) -&gt; {atomic, ok}</h3>


<div class="description">

<p>Remove the release option <code>string() Label</code> from the database.</p>
</div></div>
<div class="function">
<h3 id="destroy_release/2">destroy_release(Key::id | label, Value::pos_integer() | string()) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">

<p>Remove the release option with the key (id, label) of value from the
  database.</p>
</div></div>
<div class="function">
<h3 id="update_release/1">update_release(Label::string(), Rec::#release_opt{id=undefined | pos_integer(), label=undefined | string(), bias=-1 | 0 | 1, timestamp=pos_integer()}) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">

<p>Update the release option <code>string() Label</code> to <code>#release_opt{} Rec</code>.</p>
</div></div>
<div class="function">
<h3 id="get_releases/0">get_releases() -&gt; {ok, [#release_opt{id=undefined | pos_integer(), label=undefined | string(), bias=-1 | 0 | 1, timestamp=pos_integer()}]}</h3>


<div class="description">

<p>Get all <code>#release_opt</code>.</p>
</div></div>
<div class="function">
<h3 id="new_profile/1">new_profile(Rec::#agent_profile{name=string() | error, id=undefined | string(), order=pos_integer(), options=[profile_option()], skills=[atom()], timestamp=pos_integer()}) -&gt; {error, any()} | {ok, any()}</h3>


<div class="description">

<p>Create a new agent profile.</p>
</div></div>
<div class="function">
<h3 id="new_profile/1-1">new_profile(Name::string(), Skills::[atom()]) -&gt; {atomic, ok}</h3>


<div class="description">

<p>Create a new agent profile <code>string() Name</code> with <code>[atom()] Skills</code>.</p>
</div></div>
<div class="function">
<h3 id="set_profile/1">set_profile(Oldname::string(), Name::string(), Skills::[atom()]) -&gt; {atomic, ok}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set_profile/1-1">set_profile(Oldname::string(), Rec::#agent_profile{name=string() | error, id=undefined | string(), order=pos_integer(), options=[profile_option()], skills=[atom()], timestamp=pos_integer()}) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">

<p>Update the profile <code>string() Oldname</code> to the given rec.</p>
</div></div>
<div class="function">
<h3 id="destroy_profile/1">destroy_profile(Name::string()) -&gt; {atomic, ok} | {error, any()}</h3>


<div class="description">

<p>Remove the profile <code>string() Name</code>.  Returns <code>error</code> if you try to remove the profile <code>"Default"</code>.</p>
</div></div>
<div class="function">
<h3 id="get_profile/1">get_profile(Name::string() | {id, string()} | {name, string()}) -&gt; {ok, #agent_profile{name=string() | error, id=undefined | string(), order=pos_integer(), options=[profile_option()], skills=[atom()], timestamp=pos_integer()}} | undefined</h3>


<div class="description">

<p>Gets the proflie <code>string() Name</code></p>
</div></div>
<div class="function">
<h3 id="get_profiles/0">get_profiles() -&gt; {ok, [#agent_profile{name=string() | error, id=undefined | string(), order=pos_integer(), options=[profile_option()], skills=[atom()], timestamp=pos_integer()}]}</h3>


<div class="description">

<p>Return all profiles as <code>[{string() Name, [atom] Skills}]</code>.</p>
</div></div>
<div class="function">
<h3 id="set_agent/1">set_agent(Id::string(), Props::[{atom(), any()}]) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">

<p>Sets the agent <code>string() Oldlogin</code> with new data in <code>proplist Props</code>;
  does not change data that is not in the proplist.  The proplist's
  <code>endpoints</code> field can also contain a partial list, preserving existing
  settings.</p>
</div></div>
<div class="function">
<h3 id="get_agent/1">get_agent(Login::string()) -&gt; {ok, #agent_auth{id=undefined | string(), login=undefined | string(), password=undefined | string(), skills=[atom()], securitylevel=security_level(), integrated=undefined | pos_integer(), profile=string(), firstname=string(), lastname=string(), endpoints=[{atom(), any()}], extended_props=[{atom(), any()}], timestamp=pos_integer()}} | none</h3>


<div class="description">

<p>Gets <code>#agent_auth{}</code> associated with <code>string() Login</code>.</p>
</div></div>
<div class="function">
<h3 id="get_agent/2">get_agent(Key::id | login, Value::string()) -&gt; {ok, #agent_auth{id=undefined | string(), login=undefined | string(), password=undefined | string(), skills=[atom()], securitylevel=security_level(), integrated=undefined | pos_integer(), profile=string(), firstname=string(), lastname=string(), endpoints=[{atom(), any()}], extended_props=[{atom(), any()}], timestamp=pos_integer()}} | none</h3>


<div class="description">

<p>Get an agent who's <code>Key</code> is <code>Value</code>.</p>
</div></div>
<div class="function">
<h3 id="get_agents/0">get_agents() -&gt; {ok, [#agent_auth{id=undefined | string(), login=undefined | string(), password=undefined | string(), skills=[atom()], securitylevel=security_level(), integrated=undefined | pos_integer(), profile=string(), firstname=string(), lastname=string(), endpoints=[{atom(), any()}], extended_props=[{atom(), any()}], timestamp=pos_integer()}]}</h3>


<div class="description">

<p>Gets All the agents.</p>
</div></div>
<div class="function">
<h3 id="get_agents/1">get_agents(Profile::string()) -&gt; {ok, [#agent_auth{id=undefined | string(), login=undefined | string(), password=undefined | string(), skills=[atom()], securitylevel=security_level(), integrated=undefined | pos_integer(), profile=string(), firstname=string(), lastname=string(), endpoints=[{atom(), any()}], extended_props=[{atom(), any()}], timestamp=pos_integer()}]}</h3>


<div class="description">

<p>Gets all the agents associated with <code>string() Profile</code>.</p>
</div></div>
<div class="function">
<h3 id="set_endpoint/2">set_endpoint(Key::{login | id, string()}, Endpoint::atom(), Data::any()) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="drop_endpoint/2">drop_endpoint(Key::{login | id, string()}, Endpoint::atom()) -&gt; {atomic, ok}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set_extended_prop/2">set_extended_prop(Key::{login | id, string()}, Prop::atom(), Val::any()) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="drop_extended_prop/2">drop_extended_prop(Key::{login | id, string()}, Prop::atom()) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_extended_prop/2">get_extended_prop(Key::{login | id, string()}, Prop::atom()) -&gt; {ok, any()} | {error, noagent} | undefined</h3>


<div class="description">

<p>Get an extened property either from the database or a record
  directly.</p>
</div></div>
<div class="function">
<h3 id="merge/1">merge(Nodes::[atom()], Time::pos_integer(), Replyto::pid()) -&gt; ok | {error, any()}</h3>


<div class="description">

<p>Utility function to handle merging data after a net split.  Takes the
  given nodes, selects all records with a timestamp greater than the given
  time, merges them, and passes the resulting list back to Pid.  Best if used
  inside a spawn.</p>
</div></div>
<div class="function">
<h3 id="query_agent_auth/1">query_agent_auth(Time::pos_integer()) -&gt; {atomic, [#agent_auth{id=undefined | string(), login=undefined | string(), password=undefined | string(), skills=[atom()], securitylevel=security_level(), integrated=undefined | pos_integer(), profile=string(), firstname=string(), lastname=string(), endpoints=[{atom(), any()}], extended_props=[{atom(), any()}], timestamp=pos_integer()}]}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="query_profiles/1">query_profiles(Time::pos_integer()) -&gt; {atomic, [#agent_profile{name=string() | error, id=undefined | string(), order=pos_integer(), options=[profile_option()], skills=[atom()], timestamp=pos_integer()}]}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="query_release/1">query_release(Time::pos_integer()) -&gt; {atomic, [#release_opt{id=undefined | pos_integer(), label=undefined | string(), bias=-1 | 0 | 1, timestamp=pos_integer()}]}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="auth/1">auth(Username::string(), Password::string()) -&gt; {ok, deny} | {ok, {allow, string(), skill_list(), security_level(), profile_name()}} | pass</h3>


<div class="description">

<p>Take the plaintext username and password and attempt to
  authenticate the agent.</p>
</div></div>
<div class="function">
<h3 id="build_tables/0">build_tables() -&gt; ok</h3>


<div class="description">

<p>Starts mnesia and creates the tables.  If the tables already exist,
  returns <code>ok</code>.  Otherwise, a default username of <code>"agent"</code> is stored
  with password <code>"Password123"</code> and skill <code>[english]</code>.</p>
</div></div>
<div class="function">
<h3 id="cache/1">cache(Id::string(), Username::string(), Password::string(), Profile::profile_data(), Security::agent | supervisor | admin, Extended::[{atom(), any()}]) -&gt; {atomic, ok} | {aborted, any()}</h3>


<div class="description">
<p><em>This function is deprecated: </em>Use <a href="#cache/2" class="seealso">cache/2</a> instead.</p>

<p>Caches the passed <code>Username</code>, <code>Password</code>, <code>Skills</code>, and <code>Security</code>
  type.  to the mnesia database.  <code>Username</code> is the plaintext name and
  used as the key.  <code>Password</code> is assumed to be plaintext; will be
  erlang:md5'ed.  <code>Security</code> is either <code>agent</code>, <code>supervisor</code>, or <code>admin</code>.</p>
</div></div>
<div class="function">
<h3 id="add_agent/1">add_agent(Username::string(), Password::string(), Skills::[atom()], Security::admin | agent | supervisor, Profile::string()) -&gt; {atomic, ok}</h3>


<div class="description">
<p><em>This function is deprecated: </em>Please use <a href="#add_agent/1" class="seealso">add_agent/1</a> instead.</p>

<p>adds a user to the local cache bypassing the integrated at check.
  Note that unlike <a href="#cache/4" class="seealso">cache/4</a> this expects the password in plain
  text!</p>
</div></div>
<div class="function">
<h3 id="add_agent/1-1">add_agent(Username::string(), Firstname::string(), Lastname::string(), Password::string(), Skills::[atom()], Security::admin | agent | supervisor, Profile::string()) -&gt; {atomic, ok}</h3>


<div class="description">
<p><em>This function is deprecated: </em>Please use <a href="#add_agent/1" class="seealso">add_agent/1</a> instead.</p>

<p>adds a user to the local cache bypassing the integrated at check.
  Note that unlike <a href="#cache/4" class="seealso">cache/4</a> this expects the password in plain
  text!</p>
</div></div>
<div class="function">
<h3 id="add_agent/1-2">add_agent(Proplist::[{atom(), any()}, ...] | #agent_auth{id=undefined | string(), login=undefined | string(), password=undefined | string(), skills=[atom()], securitylevel=security_level(), integrated=undefined | pos_integer(), profile=string(), firstname=string(), lastname=string(), endpoints=[{atom(), any()}], extended_props=[{atom(), any()}], timestamp=pos_integer()}) -&gt; {atomic, ok}</h3>


<div class="description">

<p>adds a user to the local cache.  Accepts either <code>#agent_auth{}</code> or
  a proplist as the initial argument.  If an agent with the given login
  already exists, this throws an error.  An id is created for ye.  The
  password should not be encoded.</p>
</div></div>
<div class="function">
<h3 id="destroy/2">destroy(Key::id | login, Value::string()) -&gt; {ok, any()} | {error, any()}</h3>


<div class="description">

<p>Destory either by id or login.</p>
</div></div>
<div class="function">
<h3 id="encode_password/1">encode_password(Password) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="upgrade_v1_table/0">upgrade_v1_table() -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
