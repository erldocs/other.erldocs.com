<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>tanuki_backend (tanuki_backend) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>tanuki_backend</h1>
<h2 class="modsummary"/>
<div class="description">
</div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="fetch_document/1">fetch_document(DocId) -&gt; {ok, Doc} | {error, Reason}</h3>

<ul class="type">
<li><code>DocId = string()</code></li><li><code>Doc = term()</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Retrieves the document with the given identifier as an ejson object
      (where ejson is defined in couchbeam as essentially a proplist of
      binary strings).
</p>
</div></div>
<div class="function">
<h3 id="all_tags/0">all_tags() -&gt; Rows</h3>

<ul class="type">
<li><code>Rows = [term()]</code></li></ul>
<div class="description">

<p>Retrieves all known tags as couchbeam view results.
</p>
</div></div>
<div class="function">
<h3 id="by_checksum/1">by_checksum(Checksum) -&gt; Rows</h3>

<ul class="type">
<li><code>Checksum = string()</code></li><li><code>Rows = [term()]</code></li></ul>
<div class="description">

<p>Retrieves all documents with a given checksum, as couchbeam view results.
      Result includes the id and mimetype fields.
</p>
</div></div>
<div class="function">
<h3 id="by_tag/1">by_tag(Tag) -&gt; Rows</h3>

<ul class="type">
<li><code>Tag = string()</code></li><li><code>Rows = [term()]</code></li></ul>
<div class="description">

<p>Retrieves all documents with a given tag, as couchbeam view results.
</p>
</div></div>
<div class="function">
<h3 id="by_tags/1">by_tags(Tags) -&gt; Rows</h3>

<ul class="type">
<li><code>Tags = [string()]</code></li><li><code>Rows = [term()]</code></li></ul>
<div class="description">

<p>Retrieves all documents with the given tags, as couchbeam view results.
      Only those documents containing all of the given tags will be returned.
      Ordering is non-deterministic.  TODO: that needs to be fixed
</p>
</div></div>
<div class="function">
<h3 id="by_date/1">by_date(Year) -&gt; Rows</h3>

<ul class="type">
<li><code>Year = integer()</code></li><li><code>Rows = [term()]</code></li></ul>
<div class="description">

<p>Retrieves all documents whose most relevant date is within the given year.
      The date used will be exif_date, or file_date, or import_date, in that
      order. Results are as from couchbeam_view:fetch/3.
</p>
</div></div>
<div class="function">
<h3 id="by_date/2">by_date(Year, Month) -&gt; Rows</h3>

<ul class="type">
<li><code>Year = integer()</code></li><li><code>Month = integer()</code></li><li><code>Rows = [term()]</code></li></ul>
<div class="description">

<p>Retrieves all documents whose most relevant date is within the given month.
      The date used will be exif_date, or file_date, or import_date, in that
      order. Results are as from couchbeam_view:fetch/3.
</p>
</div></div>
<div class="function">
<h3 id="date_list_to_string/1">date_list_to_string(DateList) -&gt; DateString</h3>

<ul class="type">
<li><code>DateList = [integer()]</code></li><li><code>DateString = string()</code></li></ul>
<div class="description">

<p>Converts a date-list (list of integers representing a date) of the
      form [2014, 7, 4, 12, 1] to a string: 2014/7/4 12:01.
</p>
</div></div>
<div class="function">
<h3 id="date_list_to_string/2">date_list_to_string(DateList, X2::date_only) -&gt; DateString</h3>

<ul class="type">
<li><code>DateList = [integer()]</code></li><li><code>DateString = string()</code></li></ul>
<div class="description">

<p>Converts a date-list (list of integers representing a date) of the
      form [2014, 7, 4, 12, 1] to a string, with only the date: 2014/7/4.
</p>
</div></div>
<div class="function">
<h3 id="path_to_mimes/2">path_to_mimes(Filename, Database) -&gt; MimeType</h3>

<ul class="type">
<li><code>Filename = bitstring()</code></li><li><code>Database = term()</code></li><li><code>MimeType = [binary()]</code></li></ul>
<div class="description">

<p>Retrieves the mimetype for a document with the given checksum, in
      a form suitable for the Cowboy dispatch mimetype handler.
</p>
</div></div>
<div class="function">
<h3 id="generate_etag/2">generate_etag(Arguments, X2::strong_etag_extra) -&gt; {strong, Etag}</h3>

<ul class="type">
<li><code>Arguments = list()</code></li><li><code>Etag = bitstring()</code></li></ul>
<div class="description">

<p>Returns an ETag for a given file, which essentially means converting
      the file path to a sha256 checksum.
</p>
</div></div>
<div class="function">
<h3 id="retrieve_thumbnail/2">retrieve_thumbnail(Checksum, RelativePath) -&gt; {ok, Image, MimeType}</h3>

<ul class="type">
<li><code>Checksum = string()</code></li><li><code>RelativePath = string()</code></li><li><code>Image = bitstring()</code></li><li><code>MimeType = binary()</code></li></ul>
<div class="description">

<p>Either retrieve the thumbnail produced earlier, or generate one
      now and cache for later use. Returns {ok, Binary, Mimetype}.
</p>
</div></div>
<div class="function">
<h3 id="seconds_since_epoch/0">seconds_since_epoch() -&gt; integer()</h3>


<div class="description">

<p>Return the seconds since the epoch (1970/1/1 00:00).
</p>
</div></div>
<div class="function">
<h3 id="get_best_date/1">get_best_date(Doc) -&gt; Result</h3>

<ul class="type">
<li><code>Doc = term()</code></li><li><code>Result = list() | none</code></li></ul>
<div class="description">

<p>Extract the most accurate date from the given document. The precedence
      is EXIF original date, followed by file date, followed by import date.
      The date is the format stored in the database (a list of integers).
</p>
</div></div>
<div class="function">
<h3 id="get_field_value/2">get_field_value(Field, Document) -&gt; Result</h3>

<ul class="type">
<li><code>Field = term()</code></li><li><code>Document = binary()</code></li><li><code>Result = term() | none</code></li></ul>
<div class="description">

<p>Extract the value of the named field, or none if either undefined or null.
</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
