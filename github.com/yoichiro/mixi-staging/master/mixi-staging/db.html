<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>db (mixi-staging) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>db</h1>
<h2 class="modsummary">This module has some functions to manipulate each entites in the database.</h2>
<div class="description">
<p>This module has some functions to manipulate each entites in the database.
  This client can retrieve, store and update entities of a category, server,
  user, session and booking from Mnesia. Basically, each functions are executed in a
  transaction.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="get_categories/0">get_categories() -&gt; [#category{id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()}]</h3>


<div class="description">

<p>Retrieve all categories.
  This result list is sorted by the category's name.
  Also, the category which its deleted flag is true is reduced from this result.
 </p>
</div></div>
<div class="function">
<h3 id="create_category/1">create_category(Name::string()) -&gt; {ok, #category{id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()}}</h3>


<div class="description">

<p>Create a new category into the database.
  The object of the category record is actually generated and stored.
  The created category has the specified name.
 </p>
</div></div>
<div class="function">
<h3 id="delete_category/1">delete_category(CategoryId::string()) -&gt; {ok, #category{id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()}} | {error, string()}</h3>


<div class="description">

<p>Delete a category from the database.
  Actually, the specified category is not deleted,
  instead the deleted flag is changed to true.
  As this result, the deleted record will be return.
 </p>
</div></div>
<div class="function">
<h3 id="create_server/1">create_server(CategoryId::string(), Name::string()) -&gt; {ok, #server{id=undefined | string(), category_id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()}}</h3>


<div class="description">

<p>Create a new server into the database.
  The server is created depending the category specified by the Category ID.
 </p>
</div></div>
<div class="function">
<h3 id="get_server/1">get_server(ServerId::string()) -&gt; #server{id=undefined | string(), category_id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()} | not_found | {error, string()}</h3>


<div class="description">

<p>Retrieve a server which has the specified server ID.
  If the server has deleted (in other words, its deleted flag is true),
  it will not be returned.
  Also, if multiple servers (has same server ID) exist, an error will be occurred.
 </p>
</div></div>
<div class="function">
<h3 id="get_servers/1">get_servers(CategoryId::string()) -&gt; [#server{id=undefined | string(), category_id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()}]</h3>


<div class="description">

<p>Retrieve all servers belonging the specified category.
  This result list is sorted by the server's name.
  Also, the server which its deleted flag is true is reduced from this result.
 </p>
</div></div>
<div class="function">
<h3 id="delete_server/1">delete_server(ServerId::string()) -&gt; {ok, #server{id=undefined | string(), category_id=undefined | string(), name=undefined | string(), deleted=undefined | boolean()}} | {error, string()}</h3>


<div class="description">

<p>Delete a server from the database.
  Actually, the specified server is not deleted,
  instead the deleted flag is changed to true.
  As this result, the deleted record will be return.
 </p>
</div></div>
<div class="function">
<h3 id="create_user/1">create_user(Name::string(), Email::string(), Password::string(), Irc::string()) -&gt; {ok, #user{id=undefined | string(), name=undefined | string(), email=undefined | string(), password=undefined | string(), irc=undefined | string()}} | {already_exists, #user{id=undefined | string(), name=undefined | string(), email=undefined | string(), password=undefined | string(), irc=undefined | string()}}</h3>


<div class="description">

<p>Create a new user into the database.
  If the user which has the same email address in the database,
  the error which presents this situation will be occurred.
 </p>
</div></div>
<div class="function">
<h3 id="authenticate/1">authenticate(Email::string(), Password::string()) -&gt; boolean()</h3>


<div class="description">

<p>Authenticate by the user's credential.
  The credential is composed of a email and password.
  The password is stored as the md5 hashed string, and is cofirmed by
  comparing each hashed them.
 </p>
</div></div>
<div class="function">
<h3 id="get_user_by_session_id/1">get_user_by_session_id(SessionId::string()) -&gt; #user{id=undefined | string(), name=undefined | string(), email=undefined | string(), password=undefined | string(), irc=undefined | string()} | not_found | {error, string()}</h3>


<div class="description">

<p>Retrieve an user related the specified session.
  One session is related to one user in the database.
 </p>
</div></div>
<div class="function">
<h3 id="get_user/1">get_user(UserId::string()) -&gt; #user{id=undefined | string(), name=undefined | string(), email=undefined | string(), password=undefined | string(), irc=undefined | string()} | not_found | {error, string()}</h3>


<div class="description">

<p>Retrieve an user which has the specified user ID.
 </p>
</div></div>
<div class="function">
<h3 id="create_session/1">create_session(Email::string(), SessionId::string()) -&gt; {ok, #session{id=undefined | string(), user_id=undefined | string()}} | {error, string()}</h3>


<div class="description">

<p>Create a new session related to an user specified by the email address.
  This function will be used at a logged-in process.
 </p>
</div></div>
<div class="function">
<h3 id="delete_session/1">delete_session(SessionId::string()) -&gt; ok</h3>


<div class="description">

<p>Delete a session from the database.
  This function actually deletes the session specified
  by the session ID from the database.
 </p>
</div></div>
<div class="function">
<h3 id="reserve/1">reserve(From::integer(), To::integer(), Branch::string(), Purpose::string(), CategoryId::string(), SessionId::string()) -&gt; {ok, #booking{id=undefined | string(), server_id=undefined | string(), start_date=undefined | integer(), end_date=undefined | integer(), branch=undefined | string(), purpose=undefined | string(), user_id=undefined | string()}} | available_server_not_found</h3>


<div class="description">

<p>Reserve a server according to some conditions.
  First, this function finds the server which will not be busy at the period
  the client specifies. If there are one or more such servers,
  this function creates a booking record to the database.
  If there is not such server, the error will be return.
  Two arguments "From" and "To" must present the date formatted "YYYYMMDD".
 </p>
</div></div>
<div class="function">
<h3 id="get_bookings/1">get_bookings(CategoryId::string()) -&gt; [#booking{id=undefined | string(), server_id=undefined | string(), start_date=undefined | integer(), end_date=undefined | integer(), branch=undefined | string(), purpose=undefined | string(), user_id=undefined | string()}]</h3>


<div class="description">

<p>Retrieve bookings belonging to the specified category.
  The server which has already been deleted is not included in this result.
  And, if the end date which the booking has is before than today,
  it is also reduce from the result. The result list is sorted by
  the start date.
 </p>
</div></div>
<div class="function">
<h3 id="get_booking/1">get_booking(BookingId::string()) -&gt; #booking{id=undefined | string(), server_id=undefined | string(), start_date=undefined | integer(), end_date=undefined | integer(), branch=undefined | string(), purpose=undefined | string(), user_id=undefined | string()} | not_found | {error, string()}</h3>


<div class="description">

<p>Retrieve a booking information with the specified booking ID.
 </p>
</div></div>
<div class="function">
<h3 id="delete_booking/1">delete_booking(BookingId::string(), SessionId::string()) -&gt; boolean()</h3>


<div class="description">

<p>Delete a booking with the booking ID.
  If the target booking information has not been created by the user
  of this session, this function will be failed.
 </p>
</div></div>
<div class="function">
<h3 id="get_all_bookings/0">get_all_bookings() -&gt; [#booking{id=undefined | string(), server_id=undefined | string(), start_date=undefined | integer(), end_date=undefined | integer(), branch=undefined | string(), purpose=undefined | string(), user_id=undefined | string()}]</h3>


<div class="description">

<p>Retrieve all bookings which is avairable today.
 </p>
</div></div>
<div class="function">
<h3 id="do/1">do(QH) -&gt; term()</h3>

<ul class="type">
<li><code>QH = query_handle() (see module qlc)</code></li></ul>
<div class="description">

<p>Execute a query and return results in a transaction.
  This function will return the list which has result entities of the query.
 </p>
</div></div></div>

<authors>

<aname>Yoichiro Tanaka</aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
