<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>mover_rmrf (chef-server) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>mover_rmrf</h1>
<h2 class="modsummary">Mover Node Deletion Tool.</h2>
<div class="description">
<p>Mover Node Deletion Tool</p>
 
  <p><em><marker id="Quick_Start">Quick Start</marker></em></p>
 
  <p>Edit <code>mover_rmrf.config</code>.</p>
 
  <p>Make a backup copy of all_nodes dets file</p>
 
  <p>Start Erlang: <code>erl -pa ebin deps/*/ebin</code></p>
 
  <p><code>mover_rmrf:start_link().</code></p>
 
  <p><code>mover_rmrf:nuke_nodes().</code></p>
 
 
  <p><em><marker id="Configuration">Configuration</marker></em></p>
 
  <p>Relies on a config file <code>mover_rmrf.config</code> in the current working directory. This should
  be a file of erlang terms suitable for file:consult like this:
  </p><pre class="sh_erlang">          {stop, false}.
          {min_delay, 1000}.
          {dry_run, true}.
          {couchdb_url, "http://localhost:5984"}.</pre>
 
  <p>Also expects to find an <code>all_nodes</code> dets file in current working directory. WARNING: the  
code will modify entries in this dets file marking nodes as deleted so you might want to  
make a backup before starting.</p>
 
  <p>You can change the delay rate by editing the config file. The <code>min_delay</code> key is in
  milliseconds. The code checks the file before each delete. If you set <code>stop</code> to true, the
  code will stop. You can also send the following control commands that will take effect
  after the current org-based batch is complete:
  </p><pre class="sh_erlang">  mover_rmrf:pause().
  mover_rmrf:resume().
  mover_rmrf:stop().</pre>
 
  <p><em><marker id="Logging">Logging</marker></em></p>
 
  <p>Activity logs are written to <code>mover_rmrf.log</code>
  You can also check current progress with: <code>summarize_nodes/0</code>.</p>
 
  <p><em><marker id="Dry_Run_Mode">Dry Run Mode</marker></em></p>
 
  <p>In dry_run mode, no HTTP requests are made, but the dets table is updated.</p>
 
 
  <p><em><marker id="Notes">Notes</marker></em></p>
 
  <p>At startup, the code loads entries in the all_nodes dets table by org_id. Then it deletes
  nodes by org enforcing a minimum delay between deletes. Each delete is two HTTP calls,
  one to fetch the current revision and one to issue the delete. If an error occurs for
  either call, the node is marked as a delete_error and the code continues on.
 </p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/0">start_link() -&gt; term()
</h3>


<div class="description">

<p>Start a new mover_rmrf process</p>
 
  <p>Configuration comes from <code>mover_rmrf.config</code> and the <code>all_nodes</code> dets file, both found in
  the current working directory.</p>
</div></div>
<div class="function">
<h3 id="nuke_nodes/0">nuke_nodes() -&gt; term()
</h3>


<div class="description">

<p>Start deleting nodes.</p>
 
  <p>Nodes are organized by org_id for deletion.</p>
</div></div>
<div class="function">
<h3 id="pause/0">pause() -&gt; term()
</h3>


<div class="description">

<p>Pause org nuking</p>
 
  <p>After the nodes for the current org are deleted, pause and wait for further instructions.</p>
</div></div>
<div class="function">
<h3 id="resume/0">resume() -&gt; term()
</h3>


<div class="description">

<p>Resume org nuking</p>
</div></div>
<div class="function">
<h3 id="stop/0">stop() -&gt; term()
</h3>


<div class="description">

<p>Stop org nuking, shutdown.</p>
 
  <p>After the nodes for the current org are deleted, shutdown. If you want a more immediate
  clean stop, edit the config file and set stop to true.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(X1) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="init_storage/2">init_storage(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="ready/2">ready(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_event/3">handle_event(Event, StateName, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_sync_event/4">handle_sync_event(Event, From, StateName, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_info/3">handle_info(Info, StateName, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="terminate/3">terminate(Reason, StateName, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="code_change/4">code_change(OldVsn, StateName, State, Extra) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="summarize_nodes/0">summarize_nodes() -&gt; term()
</h3>


<div class="description">

<p>Summarize delete progress</p>
</div></div></div>

<authors>

<aname>Seth Falcon</aname>
<email>seth@opscode.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
