<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>etorrent_upnp_proto (etorrent) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>etorrent_upnp_proto</h1>
<h2 class="modsummary">Utilities to manipulate UPnP wire message, such as parsing
       M-SEARCH response, parsing device description, and assembling
       action control message.</h2>
<div class="description">
<p>Utilities to manipulate UPnP wire message, such as parsing
       M-SEARCH response, parsing device description, and assembling
       action control message.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="parse_msearch_resp/1">parse_msearch_resp(Resp::string()) -&gt; {ok, device, upnp_device() (see module etorrent_types)} | {ok, service, upnp_service() (see module etorrent_types)} | {ok, uuid} | {error, _Reason}</h3>


<div class="description">

<p>Parse UPnP device's response to M-SEARCH request.</p>
 
       <p>The response is an HTTP one with empty body:
       </p><pre class="sh_erlang">       HTTP/1.1 200 OK
       CACHE-CONTROL: max-age = seconds until advertisement expires
       DATE: when response was generated
       EXT:
       LOCATION: URL for UPnP description for root device
       SERVER: OS/version UPnP/1.0 product/version
       ST: search target
       USN: advertisement UUID</pre>
</div></div>
<div class="function">
<h3 id="parse_description/1">parse_description(LocalAddr::ip_address() (see module inet), Desc::string()) -&gt; {ok, [upnp_device() (see module etorrent_types)], [upnp_service() (see module etorrent_types)]} | {error, _Reason}</h3>


<div class="description">

<p>Parses given description of a UPnP device.</p>
 
       <p>Besides of information of its embeded devices and services,
       each device node has format:
       </p><pre class="sh_erlang">       &lt;deviceType&gt;urn:schemas-upnp-org:device:deviceType:v&lt;/deviceType&gt;
       &lt;friendlyName&gt;short user-friendly title&lt;/friendlyName&gt;
       &lt;manufacturer&gt;manufacturer name&lt;/manufacturer&gt;
       &lt;manufacturerURL&gt;URL to manufacturer site&lt;/manufacturerURL&gt;
       &lt;modelDescription&gt;long user-friendly title&lt;/modelDescription&gt;
       &lt;modelName&gt;model name&lt;/modelName&gt;
       &lt;modelNumber&gt;model number&lt;/modelNumber&gt;
       &lt;modelURL&gt;URL to model site&lt;/modelURL&gt;
       &lt;serialNumber&gt;manufacturer's serial number&lt;/serialNumber&gt;
       &lt;UDN&gt;uuid:UUID&lt;/UDN&gt;
       &lt;UPC&gt;Universal Product Code&lt;/UPC&gt;</pre>
 
       <p>While each service node has format:
       </p><pre class="sh_erlang">       &lt;service&gt;
           &lt;serviceType&gt;urn:schemas-upnp-org:service:serviceType:v&lt;/serviceType&gt;
           &lt;serviceId&gt;urn:upnp-org:serviceId:serviceID&lt;/serviceId&gt;
           &lt;SCPDURL&gt;URL to service description&lt;/SCPDURL&gt;
           &lt;controlURL&gt;URL for control&lt;/controlURL&gt;
           &lt;eventSubURL&gt;URL for eventing&lt;/eventSubURL&gt;
       &lt;/service&gt;</pre>
</div></div>
<div class="function">
<h3 id="build_ctl_msg/1">build_ctl_msg(S::upnp_service() (see module etorrent_types), Action::string(), Args::[{string(), string()}]) -&gt; string()</h3>


<div class="description">

<p>Given service, action name and its arguments, assemble a UPnP       
control message body.</p>
 
       <p>According to UPnP Device Architecture 1.0 spec section 3.2,       
"Control: Action", a control invocation message is a HTTP one with       
following SOAP as its body:</p>
 
       <pre class="sh_erlang">       &lt;?xml version="1.0"?&gt;
       &lt;s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"
                   s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"&gt;
       &lt;s:Body&gt;
           &lt;u:actionName xmlns:u="urn:schemas-upnp-org:service:serviceType:v"&gt;
               &lt;argumentName&gt;in arg value&lt;/argumentName&gt;
               other in args and their values go here, if any
           &lt;/u:actionName&gt;
       &lt;/s:Body&gt;
       &lt;/s:Envelope&gt;</pre>
</div></div>
<div class="function">
<h3 id="parse_ctl_err_resp/1">parse_ctl_err_resp(Resp::string()) -&gt; {integer(), string()}</h3>


<div class="description">

<p>If UPnP service encounters error while executing the action sent by       
control point, the service sends back an error message. This function       
parses the error message and returns error code and description.</p>
 
       <p>According to UPnP Device Architecture 1.0 spec section 3.2, the error
       message has following format:
       </p><pre class="sh_erlang">       &lt;?xml version="1.0"?&gt;
       &lt;s:Envelope
           xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"
           s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"&gt;
           &lt;s:Body&gt;
               &lt;s:Fault&gt;
                   &lt;faultcode&gt;s:Client&lt;/faultcode&gt;
                   &lt;faultstring&gt;UPnPError&lt;/faultstring&gt;
                   &lt;detail&gt;
                       &lt;UPnPError xmlns="urn:schemas-upnp-org:control-1-0"&gt;
                       &lt;errorCode&gt;error code&lt;/errorCode&gt;
                       &lt;errorDescription&gt;error string&lt;/errorDescription&gt;
                       &lt;/UPnPError&gt;
                   &lt;/detail&gt;
               &lt;/s:Fault&gt;
           &lt;/s:Body&gt;
       &lt;/s:Envelope&gt;</pre>
</div></div>
<div class="function">
<h3 id="parse_sub_resp/1">parse_sub_resp(Resp::term()) -&gt; string() | undefined</h3>


<div class="description">

<p>Parses UPnP service's response to our subscription request,
       returns subscription id if succeeded. Or undefined if failed.</p>
</div></div>
<div class="function">
<h3 id="guess_sub_resp/1">guess_sub_resp(Resp::term()) -&gt; string() | undefined</h3>


<div class="description">

<p>Guesses what's in malformed subscription response.
 </p>
</div></div>
<div class="function">
<h3 id="parse_notify_msg/1">parse_notify_msg(Msg::binary()) -&gt; undefined</h3>


<div class="description">

<p>Parses UPnP eventing notify message.</p>
 
       <p>4.2.1
       </p><pre class="sh_erlang">       &lt;?xml version="1.0"?&gt;
       &lt;e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0"&gt;
           &lt;e:property&gt;
               &lt;variableName&gt;new value&lt;/variableName&gt;
           &lt;/e:property&gt;
           Other variable names and values (if any) go here.
       &lt;/e:propertyset&gt;</pre>
</div></div></div>

<authors>

<aname>Edward Wang</aname>
<email>yujiangw@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
