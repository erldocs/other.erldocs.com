<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>db_conn (erlang-db-driver) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>db_conn</h1>
<h2 class="modsummary">The driver's APIs.</h2>
<div class="description">
<p>The driver's APIs.
  </p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-conn_arg">conn_arg() = {default_pool, boolean()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {driver, <a href="#type-driver_name" class="seealso">driver_name()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {host, string()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {port, integer()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {user, string()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {password, string()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {database, string()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {poolsize, integer()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {table_info, boolean()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {default_pool, boolean()}</h3></div>
    <div class="type"><h3 id="type-conn_args">conn_args() = [<a href="#type-conn_arg" class="seealso">conn_arg()</a>]</h3></div>
    <div class="type"><h3 id="type-driver_name">driver_name() = mysql | oracle | db2 | sybase | informix</h3></div>
    <div class="type"><h3 id="type-extras">extras() = tuple() | [tuple()]</h3></div>
    <div class="type"><h3 id="type-fields">fields() = atom() | [atom()]</h3></div>
    <div class="type"><h3 id="type-mybool">mybool() = boolean() | 1 | 0</h3></div>
    <div class="type"><h3 id="type-option">option() = {pool, atom()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {fields, <a href="#type-fields" class="seealso">fields()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {extras, <a href="#type-extras" class="seealso">extras()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {distinct, <a href="#type-mybool" class="seealso">mybool()</a>}</h3></div>
    <div class="type"><h3 id="type-options">options() = [<a href="#type-option" class="seealso">option()</a>]</h3></div>
    <div class="type"><h3 id="type-param_list">param_list() = [{Key :: atom(), Value :: term()}]</h3></div>
    <div class="type"><h3 id="type-result">result() = {ok, Res :: term()} | {error, Error :: term()}</h3></div>
    <div class="type"><h3 id="type-tables">tables() = atom() | [atom()]</h3></div>
    <div class="type"><h3 id="type-throw">throw() = {error, Error :: term()}</h3></div>
    <div class="type"><h3 id="type-where_expr">where_expr() = tuple() | [tuple()]</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start/0">start() -&gt; pid()</h3>


<div class="description">

<p>Spawn a process to load database driver library.</p>
</div></div>
<div class="function">
<h3 id="stop/1">stop(Pid::pid()) -&gt; ok</h3>


<div class="description">

<p>Unload database driver library and stop the process.</p>
</div></div>
<div class="function">
<h3 id="connect/1">connect(ConnArgs::conn_args()) -&gt; result()</h3>


<div class="description">

<p>Starts a connection and, if successful, add it to the
  connection pool in the driver.</p>
</div></div>
<div class="function">
<h3 id="disconnect/1">disconnect(Connection::record() | record()) -&gt; result()</h3>


<div class="description">

<p>Stops a connection and, if successful, remove it from the
    connection pool in the driver.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(ThreadLen::integer()) -&gt; ok</h3>


<div class="description">

<p>Initializes the length of the thread pool.</p>
</div></div>
<div class="function">
<h3 id="execute_sql/1">execute_sql(Connection::record(), Sql::string()) -&gt; result()</h3>


<div class="description">

<p>Send a query to the driver and wait for the result.</p>
</div></div>
<div class="function">
<h3 id="execute_param/1">execute_param(Connection::record(), Statement::string(), ParamList::param_list()) -&gt; result()</h3>


<div class="description">

<p>Send a query with parameters to the driver and wait for the result.</p>
</div></div>
<div class="function">
<h3 id="insert/1">insert(Connection::record(), TableName::atom(), ParamList::param_list()) -&gt; result()</h3>


<div class="description">

<p>Insert a record into database.</p>
</div></div>
<div class="function">
<h3 id="update/1">update(Connection::record(), TableName::atom(), ParamList::param_list(), Where::where_expr()) -&gt; result()</h3>


<div class="description">

<p>Update one or more records from the database,
  and return the number of rows updated.</p>
</div></div>
<div class="function">
<h3 id="delete/1">delete(Connection::record(), TableName::atom(), Where::where_expr()) -&gt; result()</h3>


<div class="description">

<p>Delete one or more records from the database,
  and return the number of rows deleted.</p>
</div></div>
<div class="function">
<h3 id="select/1">select(Connection::record(), TableList::tables(), Where::where_expr(), Opts::options()) -&gt; result()</h3>


<div class="description">

<p>Find the records for the Where and Extras expressions.</p>
 
  <p>If no records match the conditions, the function returns {ok, []}.</p>
</div></div>
<div class="function">
<h3 id="transaction/1">transaction(PoolId::atom(), Fun::function()) -&gt; result()</h3>


<div class="description">

<p>Execute a transaction.</p>
</div></div>
<div class="function">
<h3 id="prepare/1">prepare(Connection::record(), Statement::string()) -&gt; result()</h3>


<div class="description">

<p>Register a prepared statement.</p>
</div></div>
<div class="function">
<h3 id="prepare_execute/1">prepare_execute(Connection::record(), StmtName::string(), Args::list()) -&gt; result()</h3>


<div class="description">

<p>Execute a prepared statement it has prepared.</p>
</div></div>
<div class="function">
<h3 id="add_pool/1">add_pool(PoolId::atom(), ConnArg::record()) -&gt; ok | no_return()</h3>


<div class="description">

<p>Synchronous call to the connection manager to add a pool.</p>
 
  <p>Creates a pool record, opens n=Size connections and calls
  db_conn_server:add_pool/1 to make the pool known to the pool management,
  it is translated into a blocking gen-server call.</p>
</div></div>
<div class="function">
<h3 id="remove_pool/1">remove_pool(PoolId::atom()) -&gt; ok | no_return()</h3>


<div class="description">

<p>Synchronous call to the connection manager to remove a pool.</p>
</div></div>
<div class="function">
<h3 id="increment_pool_size/1">increment_pool_size(PoolId::atom(), Num::integer()) -&gt; ok | no_return()</h3>


<div class="description">

<p>Synchronous call to the connection manager to enlarge a pool.</p>
 
  <p>This opens n=Num new connections and adds them to the pool of id PoolId.</p>
</div></div>
<div class="function">
<h3 id="decrement_pool_size/1">decrement_pool_size(PoolId::atom(), Num::integer()) -&gt; ok | no_return()</h3>


<div class="description">

<p>Synchronous call to the connection manager to shrink a pool.</p>
 
  <p>This reduces the connections by up to n=Num, but it only drops and closes available  
connections that are not in use at the moment that this function is called. Connections  
that are waiting for a server response are never dropped. In heavy duty, this function  
may thus do nothing.</p>
 
  <p>If Num is higher than the amount of connections or the amount of available connections,
  exactly all available connections are dropped and closed.</p>
</div></div>
<div class="function">
<h3 id="reset_connection/1">reset_connection(Conn::record(), StayLocked::pass | keep) -&gt; record() | {error, Error::term()}</h3>


<div class="description">

<p>Reset the connection.</p>
 
  <p>if a process dies or times out while doing work, the connection reset
  in the conn_server state. Also a new connection needs to be opened to
  replace the old one. If that fails, we queue the old as available for
  the next try by the next caller process coming along. So the pool can't
  run dry, even though it can freeze.</p>
</div></div>
<div class="function">
<h3 id="close_connection/1">close_connection(Connection) -&gt; term()
</h3>


<div class="description">

<p>Deallocate all prepared statements and close the connection.</p>
</div></div></div>

<authors>

<aname>deng.lifen</aname>
<email>deng.lifen@rytong.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
