<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>hdr_histogram (hdr_histogram_erl) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>hdr_histogram</h1>
<h2 class="modsummary">.</h2>
<div class="description">
<p>The HDR histogram library is an Erlang native interface function wrapper of  
Mike Barker's C port of Gil Tene's HDR Histogram utility.</p>
 
 
  <p>A high dynamic range histogram is one that supports recording and analyzing  
sampled data points across a configurable range with configurable precision  
within that range. The precision is expressed as a number of significant  
figures in the recording.</p>
 
  <p>This HDR histogram implementation is designed for recording histograms of  
value measurements in latency sensitive environments. Although the native  
recording times can be as low as single digit nanoseconds there is added  
overhead in this wrapper/binding due to both the frontend overhead of converting  
from native C to the NIF interface, and the erlang overhead incurred calling  
into the NIFs. C'est la vie, I suppose.</p>
 
  <p>A distinct advantage of this histogram implementation is constant space and  
recording (time) overhead with an ability to recycle and reset instances whilst  
reclaiming already allocated space for reuse thereby reducing allocation cost  
and garbage collection overhead in the BEAM where repeated or continuous usage  
is likely. For example, a gen_server recording metrics continuously and resetting  
and logging histogram dumps on a periodic or other windowed basis.</p>
 
  <p>The code is released to the public domain, under the same terms as its  
sibling projects, as explained in the LICENSE.txt and COPYING.txt in the  
root of this repository, but normatively at:</p>
 
  <p>http://creativecommons.org/publicdomain/zero/1.0/</p>
 
  <p>For users of this code who wish to consume it under the "BSD" license  
rather than under the public domain or CC0 contribution text mentioned  
above, the code found under this directory is *also* provided under the  
following license (commonly referred to as the BSD 2-Clause License). This  
license does not detract from the above stated release of the code into  
the public domain, and simply represents an additional license granted by  
http://creativecommons.org/publicdomain/zero/1.0/</p>
 
  <p>-----------------------------------------------------------------------------  
** Beginning of "BSD 2-Clause License" text. **</p>
 
  <p>Copyright (c) 2012, 2013, 2014 Gil Tene  
Copyright (c) 2014 Michael Barker  
Copyright (c) 2014 Darach Ennis  
All rights reserved.</p>
 
  <p>Redistribution and use in source and binary forms, with or without  
modification, are permitted provided that the following conditions are met:</p>
 
  <p>1. Redistributions of source code must retain the above copyright notice,  
this list of conditions and the following disclaimer.</p>
 
  <p>2. Redistributions in binary form must reproduce the above copyright notice,  
this list of conditions and the following disclaimer in the documentation  
and/or other materials provided with the distribution.</p>
 
  <p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
  THE POSSIBILITY OF SUCH DAMAGE.
 </p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-ref">ref() = binary()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="open/2">open(HighestTrackableValue, SignificantFigures) -&gt; {ok, Ref} | {error, Reason}</h3>

<ul class="type">
<li><code>HighestTrackableValue = integer()</code></li><li><code>SignificantFigures = 1..5</code></li><li><code>Ref = ref()</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Open a fresh instance of a high dynamic range (HDR) histogram</p>
</div></div>
<div class="function">
<h3 id="get_memory_size/1">get_memory_size(Ref) -&gt; Size</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Size = integer()</code></li></ul>
<div class="description">

<p>Get memory footprint of an HDR histogram</p>
</div></div>
<div class="function">
<h3 id="get_total_count/1">get_total_count(Ref) -&gt; Count</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Count = integer()</code></li></ul>
<div class="description">

<p>Get total count of record values</p>
</div></div>
<div class="function">
<h3 id="record/2">record(Ref, Value) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Value = integer()</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Record an uncorrected histogram data point value in a HDR histogram</p>
</div></div>
<div class="function">
<h3 id="record_corrected/3">record_corrected(Ref, Value, ExpectedInterval) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Value = integer()</code></li><li><code>ExpectedInterval = integer()</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Record a histogram data point value in a HDR histogram with
  expected interval for correction for coordinated ommission</p>
</div></div>
<div class="function">
<h3 id="record_many/3">record_many(Ref, Value, Count) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Value = integer()</code></li><li><code>Count = integer()</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Record a histogram data point value and number of occurances</p>
</div></div>
<div class="function">
<h3 id="add/2">add(To, From) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>To = ref()</code></li><li><code>From = ref()</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Contribute the data points from a HDR histogram to another</p>
</div></div>
<div class="function">
<h3 id="min/1">min(Ref) -&gt; MinValue</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>MinValue = integer()</code></li></ul>
<div class="description">

<p>Get the minimum recorded data point value</p>
</div></div>
<div class="function">
<h3 id="max/1">max(Ref) -&gt; MaxValue</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>MaxValue = integer()</code></li></ul>
<div class="description">

<p>Get the maximum recorded data point value</p>
</div></div>
<div class="function">
<h3 id="mean/1">mean(Ref) -&gt; MeanValue</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>MeanValue = float()</code></li></ul>
<div class="description">

<p>Get the mean data point value to a significant figure</p>
</div></div>
<div class="function">
<h3 id="median/1">median(Ref) -&gt; MedianValue</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>MedianValue = float()</code></li></ul>
<div class="description">

<p>Get the median data point value to a significant figure</p>
</div></div>
<div class="function">
<h3 id="stddev/1">stddev(Ref) -&gt; StddevValue</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>StddevValue = float()</code></li></ul>
<div class="description">

<p>Get the standard deviation data point value to a significant figure</p>
</div></div>
<div class="function">
<h3 id="percentile/2">percentile(Ref, Percentile) -&gt; PercentileValue</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Percentile = float()</code></li><li><code>PercentileValue = float()</code></li></ul>
<div class="description">

<p>Get the specified percentile  data point value to a significant figure</p>
</div></div>
<div class="function">
<h3 id="same/3">same(Ref, A, B) -&gt; AreEquivalent</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>A = integer()</code></li><li><code>B = integer()</code></li><li><code>AreEquivalent = boolean()</code></li></ul>
<div class="description">

<p>Are two data point values considered to be equivalent</p>
</div></div>
<div class="function">
<h3 id="lowest_at/2">lowest_at(Ref, Value) -&gt; LowestValueAt</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Value = integer()</code></li><li><code>LowestValueAt = float()</code></li></ul>
<div class="description">

<p>Get the lowest equivalent value</p>
</div></div>
<div class="function">
<h3 id="count_at/2">count_at(Ref, Value) -&gt; CountAt</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Value = integer()</code></li><li><code>CountAt = integer()</code></li></ul>
<div class="description">

<p>Get the count of values at a given at a given value</p>
</div></div>
<div class="function">
<h3 id="print/2">print(Ref, Format) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Format = classic | csv</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Print the histogram to standard output in classic or CSV format</p>
</div></div>
<div class="function">
<h3 id="log/3">log(Ref, Format, FileName::name() (see module file)) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li><li><code>Format = classic | csv</code></li><li><code>Reason = term()</code></li></ul>
<div class="description">

<p>Log the histogram to a file in classic or CSV format</p>
</div></div>
<div class="function">
<h3 id="reset/1">reset(Ref) -&gt; ok | {error, term()}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li></ul>
<div class="description">

<p>Reset the memory backing this HDR histogram instance and zero results</p>
</div></div>
<div class="function">
<h3 id="close/1">close(Ref) -&gt; ok | {error, term()}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li></ul>
<div class="description">

<p>Close this HDR histogram instance and free any system resources</p>
</div></div>
<div class="function">
<h3 id="from_binary/1">from_binary(Binary) -&gt; {ok, Ref} | {error, term()}</h3>

<ul class="type">
<li><code>Binary = binary()</code></li><li><code>Ref = ref()</code></li></ul>
<div class="description">

<p>Take a snapshot of HDR histogram internal state as a compressed binary and hydrate/open a reference. The reference SHOULD be closed when no longer needed to reclaim the memory used</p>
</div></div>
<div class="function">
<h3 id="to_binary/1">to_binary(Ref) -&gt; binary() | {error, term()}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li></ul>
<div class="description">

<p>Take a snapshot of HDR histogram internal state as a compressed binary. The reference HDR instance can be modified after a snapshot is taken in the usual way with no restrictions.</p>
</div></div>
<div class="function">
<h3 id="to_binary/4">to_binary(Ref, X2::[{compression, none} | {compression, zlib}]) -&gt; binary() | {error, term()}</h3>

<ul class="type">
<li><code>Ref = ref()</code></li></ul>
<div class="description">

<p>Take a snapshot of HDR histogram internal state as an (optionally) compressed binary. The reference HDR instance can be modified after a snapshot is taken in the usual way with no restrictions.</p>
</div></div></div>

<authors>

<aname>Darach Ennis</aname>
<email>darach@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
