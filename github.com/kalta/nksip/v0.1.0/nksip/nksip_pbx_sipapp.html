<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>nksip_pbx_sipapp (nksip) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>nksip_pbx_sipapp</h1>
<h2 class="modsummary">SipApp callback module.</h2>
<div class="description">
<p>SipApp callback module.</p>
 
  <p>This module implements the mandatory callback module of each SipApp application,
  with behaviour <code>nksip_sipapp</code>.</p>
 
  <p>This SipApp implements a SIP proxy, allowing  endpoints to register  
and call each other using its registered uri.  
Each registered endpoint's speed is monitored and special "extensions" are  
available to call all nodes, call the fastest, etc.</p>
 
  <p>See <url href="/home/pete/wefwefwef/docs/other/6491459840/nksip-tag-v0.1.0/nksip_pbx/doc/index.html">//nksip_pbx</url> for an overview.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start/0">start() -&gt; term()
</h3>


<div class="description">

<p>Starts a new SipApp, listening on port 5060 for udp and tcp and 5061 for tls,
  and acting as a registrar.</p>
</div></div>
<div class="function">
<h3 id="stop/0">stop() -&gt; term()
</h3>


<div class="description">

<p>Stops the SipApp.</p>
</div></div>
<div class="function">
<h3 id="check_speed/1">check_speed(Bool) -&gt; term()
</h3>


<div class="description">

<p>Stops or restart automatic response time detection.</p>
</div></div>
<div class="function">
<h3 id="get_speed/0">get_speed() -&gt; term()
</h3>


<div class="description">

<p>Get all registered endpoints with their last respnse time.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(X1) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: initialization.
  This function is called by NkSIP after calling <code>nksip:start/4</code>.
  We program a timer to check our nodes.</p>
</div></div>
<div class="function">
<h3 id="get_user_pass/4">get_user_pass(User, Realm, From, State) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: Called to check user's password.
  If the incoming user's realm is one of our domains, the password for any
  user is "1234". For other realms, no password is valid.</p>
</div></div>
<div class="function">
<h3 id="authorize/4">authorize(Auth, ReqId, From, State) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: Called to check if a request should be authorized.
  </p><list>
       <item><p>We first check to see if the request is an in-dialog request, coming from
           the same ip and port of a previously authorized request.</p></item>
       <item><p>If not, we check if we have a previous authorized REGISTER request from
           the same ip and port.</p></item>
       <item><p>Next, we check if the request has a valid authentication header with realm
           "nksip". If <code>{{digest, &lt;&lt;"nksip"&gt;&gt;}, true}</code> is present, the user has
           provided a valid password and it is authorized.
           If <code>{{digest, &lt;&lt;"nksip"&gt;&gt;}, false}</code> is present, we have presented
           a challenge, but the user has failed it. We send 403.</p></item>
       <item><p>If no digest header is present, reply with a 407 response sending
           a challenge to the user.</p></item>
  </list>
</div></div>
<div class="function">
<h3 id="route/6">route(Scheme, User, Domain, ReqId, From, State) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: Called to decide how to route every new request.</p>
 
  <list>
       <item><p>If the user part of the request-uri is 200, proxy in parallel to all
           registered endpoints but me, including a <i>Record-Route</i>, so
           all dialog requests will go to this proxy.</p></item>
       <item><p>If it is 201, call in parallel each two random endpoints, including
           a custom header but no <i>Record-Route</i>, so next dialog requests will
           go directly to the endpoint.</p></item>
       <item><p>For 202, send the request to the fastest registered endpoint.</p></item>
       <item><p>For 203, to the slowest.</p></item>
       <item><p>If there is a different user part in the request-uri, check to see if
           it is already registered with us and redirect to it.</p></item>
       <item><p>If the there is no user part in the request-uri (only the domain)
           process locally if it is one of our domains.
           (Since we have not implemented <code>invite/4</code>, <code>options/4,</code> etc., all responses
           will be default responses). REGISTER will be processed as configured
           when starting the SipApp.</p></item>
  </list>
</div></div>
<div class="function">
<h3 id="dialog_update/3">dialog_update(DialogId, Update, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="session_update/3">session_update(DialogId, Update, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_call/3">handle_call(X1, From, State) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: Synchronous user call.</p>
</div></div>
<div class="function">
<h3 id="handle_cast/2">handle_cast(X1, State) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: Asynchronous user cast.</p>
</div></div>
<div class="function">
<h3 id="handle_info/2">handle_info(X1, State) -&gt; term()
</h3>


<div class="description">

<p>SipApp Callback: External erlang message received.
  The programmed timer sends a <code>{timeout, _Ref, check_speed}</code> message
  periodically to the SipApp.</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
