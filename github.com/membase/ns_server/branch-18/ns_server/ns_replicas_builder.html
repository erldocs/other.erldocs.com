<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>ns_replicas_builder (ns_server) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>ns_replicas_builder</h1>
<h2 class="modsummary">this implements creating replication stream for particular  
vbucket from some node to bunch of other nodes and waiting until  
all backfills are done.</h2>
<div class="description">
<p>this implements creating replication stream for particular  
vbucket from some node to bunch of other nodes and waiting until  
all backfills are done. It is also possible to shutdown some  
replications earlier then others.</p>
 
  <p>NOTE: this code can be structured as gen_server, but I decided
  against that. Reason is that I'd like to keep logic straight and
  fsm-less, but if you, my dear reader, is planning any extra
  features here, please, consider refactoring it into gen_server.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-bucket_name">bucket_name() = nonempty_string()</h3></div>
    <div class="type"><h3 id="type-vbucket_id">vbucket_id() = integer() &gt;= 0</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="spawn_link/1">spawn_link(Bucket::bucket_name(), VBucket::vbucket_id(), SrcNode::node(), ReplicateIntoNodes::[node()], JustBackfillNodes::[node()], AfterDone::() -&gt; any()) -&gt; pid()</h3>


<div class="description">

<p>spawns replicas builder for given bucket, vbucket, source and  
destination node(s). AfterDone will be called after all backfills  
are done, so it can notify whoever is interested in this event. For  
JustBackfillNodes it'll backfill replicas just as for any other  
destination node, but it'll stop replication when backfill is done  
(and before AfterDone is called). Replicas on ReplicateIntoNodes  
will be built and replication will continue maintaining them even  
when AfterDone is called and after it returns.</p>
 
  <p>When replicas are built and AfterDone is called this process will
  wait EXIT signal from parent, on which it'll reliably terminate
  child replicator and exit.</p>
</div></div>
<div class="function">
<h3 id="try_with_maybe_ignorant_after/2">try_with_maybe_ignorant_after(TryBody, AfterBody) -&gt; term()
</h3>


<div class="description">

<p>works like try/after but when try has raised exception, any
  exception from AfterBody is logged and ignored. I.e. when we face
  exceptions from both try-block and after-block, exception from
  after-block is logged and ignored and exception from try-block is
  rethrown. Use this when exception from TryBody is more important
  than exception from AfterBody.</p>
</div></div>
<div class="function">
<h3 id="sync_shutdown_many/1">sync_shutdown_many(Pids::[pid()]) -&gt; ok</h3>


<div class="description">
 </div></div></div>

<authors>

<aname>Couchbase, Inc</aname>
<email>info@couchbase.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
