<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>failover_safeness_level (ns_server) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>failover_safeness_level</h1>
<h2 class="modsummary">This gen_event handler holds failover safeness level for some  
particular bucket.</h2>
<div class="description">
<p>This gen_event handler holds failover safeness level for some  
particular bucket. We estimate failover safeness as approximation  
of time required to replicate backlog of un-replicated yet items.</p>
 
  <p>The approach is to subscribe to stats and keep moving averages of  
replication tap streams backlog and replication tap streams drain  
rate. After each new sample we update averages and compute  
estimated time to drain all replication backlog. If that estimate is  
higher then 2000 ms we switch to 'yellow' level. Switching back to  
green has much lower bound to avoid too frequent changing of levels  
(i.e. hysteresis).</p>
 
  <p>We also keep track of last time we've seen any stats sample. And we
  use it when asked about current safeness level. If our information
  is too stale (5 or more seconds old), then we respond with 'stale'
  level.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-bucket_name">bucket_name() = nonempty_string()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/1">start_link(BucketName) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_value/1">get_value(BucketName::bucket_name()) -&gt; stale | unknown | green | yellow</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="init/1">init(X1) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="terminate/2">terminate(Reason, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="code_change/3">code_change(OldVsn, State, X3) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_event/2">handle_event(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_call/2">handle_call(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_info/2">handle_info(Info, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="build_local_safeness_info/1">build_local_safeness_info(BucketNames) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="extract_replication_uptodateness/4">extract_replication_uptodateness(BucketName, BucketConfig, Node, NodeStatuses) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>

<aname>Couchbase</aname>
<email>info@couchbase.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
