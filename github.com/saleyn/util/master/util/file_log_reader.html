<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>file_log_reader (util) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>file_log_reader</h1>
<h2 class="modsummary">Periodically read an append-only log file and parse newly added data.</h2>
<div class="description">
<p>Periodically read an append-only log file and parse newly added data.</p>
  
   <p>The user controls the interval in msec how often to check for file   
modifications. When new data is appended to file it triggers invocation of   
the user-defined parsing function that deliminates the file, and the result   
is delivered to the consumer by calling the consumer callback function.</p>
  
   The log reader can be started as a <code>gen_server</code> or can be controlled
   synchronously by using <code>init/3</code>, <code>run/1</code>, and <code>close/1</code> methods.
  </div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-consumer">consumer() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((Msg :: any()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {'$end_of_file',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Res :: ok<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {error | throw | exit,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reason :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stacktrace :: list()}},<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pos :: integer(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;State :: any()) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewState :: any())</h3></div>
    <div class="type"><h3 id="type-options">options() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[{pos, StartPos :: integer()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{end_pos, ReadUntilPos :: integer() | eof} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{max_size, MaxReadSize :: integer() | eof} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{timeout, MSec :: integer()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{retry_sec, Sec :: integer()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{parser,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((Data :: binary(), ParserState :: any()) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ok,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Msg :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tail :: binary(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewParserState :: any()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{incomplete, NewParserState :: any()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{skip, Tail :: binary(), NewParserState :: any()}) |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Mod :: atom(), Fun :: atom()}} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pstate,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((File :: string(), <a href="#type-consumer" class="seealso">consumer()</a>, Options :: list()) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any()) |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pstate_update,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((Option :: atom(), Value :: any(), PState :: any()) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ok, NewPState :: any()} | {error, any()})}]</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/1">start_link(RegName::atom(), File::string(), Consumer::consumer(), Options::options()) -&gt; {ok, pid()} | ignore | {error, any()}</h3>


<div class="description">

<p>To be called by the supervisor in order to start the server.
       If init/1 fails with Reason, the function returns <code>{error,Reason}</code>.
       If init/1 returns <code>{stop,Reason}</code> or ignore, the process is
       terminated and the function returns <code>{error,Reason}</code> or ignore,
       respectively.</p>
<p><em>See also:</em> <a href="#start_link/3" class="seealso">start_link/3</a>.</p>
</div></div>
<div class="function">
<h3 id="start_link/1-1">start_link(File::string(), Consumer::consumer(), Options::options()) -&gt; {ok, pid()} | ignore | {error, any()}</h3>


<div class="description">

<p>Process <code>File</code> by calling <code>Consumer</code> callback on every delimited
       message. Message delimination is handled by the <code>{parser, Parser}</code>
       option. <code>Consumer</code> function gets called iteratively with the following
       arguments:
       </p><taglist>
           <dt>(Msg, Pos::integer(), State)</dt>
           <item><p><code>Msg</code> is what the parser function returned. <code>Pos</code> is current
               file position following the <code>Msg</code>. <code>State</code> is current value
               of parser state that is initialized by <code>{pstate, PState}</code>
               option given to the <code>start_link/{3,4}</code> function</p></item>
           <dt>({'$end_of_file', Filename::string(), Result}, Pos::integer(), PState)</dt>
           <item><p>This call happens when end of file condition is reached (see
               definition of <code>consumer()</code> type)</p></item>
       </taglist><p>
       <code>Consumer</code> can end processing normally without reaching the end
       of file by throwing <code>{eof, PState}</code> exception.</p>
</div></div>
<div class="function">
<h3 id="start/1">start(RegName::atom(), File::string(), Consumer::consumer(), Options::options()) -&gt; {ok, pid()} | {error, any()}</h3>


<div class="description">

<p>Start the server outside of supervision tree.</p>
</div></div>
<div class="function">
<h3 id="start/1-1">start(File::string(), Consumer::consumer(), Options::options()) -&gt; {ok, pid()} | {error, any()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="position/1">position(Pid::pid() | atom()) -&gt; {ok, Position::integer()}</h3>


<div class="description">

<p>Report last processed file position/size.</p>
</div></div>
<div class="function">
<h3 id="pstate/1">pstate(Pid::pid() | atom()) -&gt; {ok, any()}</h3>


<div class="description">

<p>Return current parser state (<code>{pstate, any()}</code> initialization option).</p>
</div></div>
<div class="function">
<h3 id="update_pstate/1">update_pstate(Pid::pid(), Option::atom(), Value::any()) -&gt; {ok, State::any()}</h3>


<div class="description">

<p>Update parser state.</p>
</div></div>
<div class="function">
<h3 id="stop/1">stop(Pid::pid() | atom()) -&gt; ok</h3>


<div class="description">

<p>Stop the server.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(File::string(), Consumer::consumer(), Options::options()) -&gt; {ok, #state{consumer=undefined | consumer(), tref=undefined | reference(), fd=undefined | port(), file=undefined | string(), pos=integer() | eof, end_pos=integer() | eof | undefined, max_size=undefined | integer(), timeout=undefined | integer(), parser=undefined | {atom(), atom()} | (binary(), any()) -&gt; {any(), binary(), any()}, pstate=undefined | any(), pstate_update=undefined | (any()) -&gt; any(), part_size=integer(), done=false | ok | {error | exception | exit, Reason::any(), Stacktrace::any()}, incompl_count=undefined | integer()}}</h3>


<div class="description">

<p>When using file processor without gen_server, use this function to
       initialize the state, and then call run/1.</p>
</div></div>
<div class="function">
<h3 id="run/1">run(State::#state{consumer=undefined | consumer(), tref=undefined | reference(), fd=undefined | port(), file=undefined | string(), pos=integer() | eof, end_pos=integer() | eof | undefined, max_size=undefined | integer(), timeout=undefined | integer(), parser=undefined | {atom(), atom()} | (binary(), any()) -&gt; {any(), binary(), any()}, pstate=undefined | any(), pstate_update=undefined | (any()) -&gt; any(), part_size=integer(), done=false | ok | {error | exception | exit, Reason::any(), Stacktrace::any()}, incompl_count=undefined | integer()}) -&gt; #state{consumer=undefined | consumer(), tref=undefined | reference(), fd=undefined | port(), file=undefined | string(), pos=integer() | eof, end_pos=integer() | eof | undefined, max_size=undefined | integer(), timeout=undefined | integer(), parser=undefined | {atom(), atom()} | (binary(), any()) -&gt; {any(), binary(), any()}, pstate=undefined | any(), pstate_update=undefined | (any()) -&gt; any(), part_size=integer(), done=false | ok | {error | exception | exit, Reason::any(), Stacktrace::any()}, incompl_count=undefined | integer()}</h3>


<div class="description">

<p>Process file from given position <code>Pos</code> to <code>EndPos</code> (or <code>eof</code>).</p>
</div></div>
<div class="function">
<h3 id="close/1">close(State) -&gt; term()
</h3>


<div class="description">

<p>Close file processor (use this method when not using gen_server)</p>
</div></div></div>

<authors>

<aname>Serge Aleynikov</aname>
<email>saleyn@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
