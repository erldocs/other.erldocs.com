<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>lama_alarm_h (lama) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>lama_alarm_h</h1>
<h2 class="modsummary">This module implements a replacement for SASL's alarm_handler.</h2>
<div class="description">
<p>This module implements a replacement for SASL's alarm_handler.
   It offers two features:
   </p><list>
   <item><p>Setting and clearing alarms that are not duplicated (in contrast
       to SASL's alarm_handler) and that are logged to syslog using
       lama_log_handler)</p></item>
   <item><p>Defining map between alarms and SNMP traps, so that when
       an alarm is set/cleared, it will cause an associated SNMP
       trap to be sent to a configured SNMP manager.</p></item>
   </list><p>
   This handler is fault tolegant as it is guarded by the
   <code>lama_guard</code> process.  In case of a handler crash the
   process will receive a notification sent by <code>gen_event</code>
   exit, and will be restarted by the parent <code>lama_sup_safe</code>
   supervisor defined in the <code>lama</code> module.</p><p /></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-alarm">alarm() = {AlarmId::alarm_id(), Description::term()}</h3></div>
    <div class="type"><h3 id="type-alarm_id">alarm_id() = atom() | {atom(), Data::term()}</h3></div>
    <div class="type"><h3 id="type-varbinds">varbinds() = list() | Fun</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/1">start_link(Options) -&gt; ok | already_started | throw({error, Reason})</h3>

<ul class="type">
<li><code>Options = [Option]</code></li><li><code>Option = {notify_name, NotifyName::string()} | {alarm_traps, AlarmTraps::list()}</code></li><li><code>AlarmTraps = os_mon | {AlarmID::atom(), Trap::atom(), Varbinds::varbinds()}</code></li></ul>
<div class="description">

<p>Installs the new alarm handler.  It should be called from
  the lama_guard's process.<br />
  Options:
  </p><list>
  <item><p><code>NotifyName</code> - Defines the key from the SNMP's
      <code>notify.config</code> configuration file that indicates
      the destination SNMP managers that will be receiving
      SNMP traps</p></item>
  <item><p><code>AlarmTraps</code> - Defines alarm to trap mappings that
      should generate SNMP alarms when corresponding AlarmID's a
      set/cleared.  <code>os_mon</code> value adds standard alarms and
      traps defined in OTP-OS-MON-MIB.mib.  When adding
      {AlarmID, Trap, Varbinds::varbinds()} option, Trap must be known to
      the SNMP agent by loading some MIB file containing its definition.
      Varbinds contains a list of additional values that will be sent
      along with the trap, or a function returning such a list.
      Refer to SNMP agen't guide for the use of this feature</p></item>
  </list><p>
  Note: Internal store of alarms is a list, and this implementation
  is not efficient for handling a large number of distinct alarms.</p>
</div></div>
<div class="function">
<h3 id="stop/0">stop() -&gt; ok | {error, Reason}</h3>


<div class="description">

<p>Remore alarm handler.</p>
</div></div>
<div class="function">
<h3 id="set_alarm/1">set_alarm(Alarm::alarm()) -&gt; ok | {error, Reason}</h3>


<div class="description">

<p>Set alarm.</p>
<p><em>See also:</em> <a href="#check_alarm/2" class="seealso">check_alarm/2</a>, <a href="#clear_alarm/1" class="seealso">clear_alarm/1</a>, <a href="#set_alarm/2" class="seealso">set_alarm/2</a>.</p>
</div></div>
<div class="function">
<h3 id="set_alarm/1-1">set_alarm(Alarm::alarm(), Varbinds::list()) -&gt; ok | {error, Reason}</h3>


<div class="description">

<p>Set alarm.  Multiple invocations of this function with the
  same <code>AlarmId</code> will not cause duplicate alarms to
  to be set. Error is returned if the alarm is mapped to an SNMP trap,
  and notification couldn't be sent (in this case the alarm will still
  be added to the internal alarm list).  See SNMP documentation for
  description of Varbinds.</p>
<p><em>See also:</em> <a href="#check_alarm/2" class="seealso">check_alarm/2</a>, <a href="#clear_alarm/1" class="seealso">clear_alarm/1</a>.</p>
</div></div>
<div class="function">
<h3 id="set_alarm/3">set_alarm(Alarm, Varbinds, Location) -&gt; term()
</h3>


<div class="description">

<p>For use by the ?ALARM_SET/2 macro in logger.hrl</p>
</div></div>
<div class="function">
<h3 id="clear_alarm/1">clear_alarm(AlarmId::alarm_id()) -&gt; ok | {error, Reason}</h3>


<div class="description">

<p>Clear alarm that was previously set by set_alarm/1.
  Error is returned if the alarm is mapped to an SNMP trap,
  and notification couldn't be sent (in this case the alarm will still
  be added to the internal alarm list).</p>
<p><em>See also:</em> <a href="#check_alarm/2" class="seealso">check_alarm/2</a>, <a href="#set_alarm/1" class="seealso">set_alarm/1</a>.</p>
</div></div>
<div class="function">
<h3 id="clear_alarm/2">clear_alarm(AlarmId, Location) -&gt; term()
</h3>


<div class="description">

<p>For use by the ?ALARM_CLEAR/1 macro in logger.hrl</p>
</div></div>
<div class="function">
<h3 id="get_alarms/0">get_alarms() -&gt; Alarms</h3>

<ul class="type">
<li><code>Alarms = [Alarm::alarm()]</code></li></ul>
<div class="description">

<p>Get currently active alarms.</p>
</div></div>
<div class="function">
<h3 id="get_alarm_map/0">get_alarm_map() -&gt; AlarmMap</h3>

<ul class="type">
<li><code>AlarmMap = [{AlarmId::alarm_id(), Trap::atom(), Varbinds::varbinds()}]</code></li></ul>
<div class="description">

<p>Get currently active alarms.</p>
</div></div>
<div class="function">
<h3 id="add_alarm_trap/1">add_alarm_trap(AlarmID::atom(), Trap::atom(), Varbinds::varbinds()) -&gt; ok</h3>


<div class="description">

<p>Add an alarm to trap mapping to the internal #state.alarm_map list.
  Note: when Alarm key is a tuple of ::alarm_id() type, use the first element
  of the tuple as the AlarmID parameter to this function.<br />
  <code>Example:
        {{AlarmID, _}, _} = {{disk_almost_full, "/usr"}, "Low disk space"}
        add_alarm_trap(AlarmID, diskAlmostFullAlarm, []).</code></p>
</div></div>
<div class="function">
<h3 id="delete_alarm_trap/1">delete_alarm_trap(AlarmID::atom()) -&gt; ok</h3>


<div class="description">

<p>Delete an alarm to trap mapping.</p>
</div></div>
<div class="function">
<h3 id="get_def_options/0">get_def_options() -&gt; TypedOptions::typed_options()</h3>

<ul class="type">
<li><code>typed_options() (see module lama)</code></li></ul>
<div class="description">

<p>Gets default module's options.</p>
</div></div>
<div class="function">
<h3 id="handle_call/2">handle_call(Query, State) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>

<aname>Serge Aleynikov</aname>
<email>saleyn@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
