<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_core_node_watcher (riak_core) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_core_node_watcher</h1>
<h2 class="modsummary">Process that monitors connectivity to other nodes in the cluster
  using Erlang's built-in facilities and keeps a tab of the status of
  various application services and optionaly performs periodic health checks
  on them.</h2>
<div class="description">
<p>Process that monitors connectivity to other nodes in the cluster
  using Erlang's built-in facilities and keeps a tab of the status of
  various application services and optionaly performs periodic health checks
  on them.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-hc_check_interval_opt">hc_check_interval_opt() = {check_interval, timeout()}</h3></div>
    <div class="type"><h3 id="type-hc_max_callback_fails_opt">hc_max_callback_fails_opt() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{max_callback_failures, integer() >= 0}</h3></div>
    <div class="type"><h3 id="type-hc_max_health_fails_opt">hc_max_health_fails_opt() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{max_health_failures, integer() >= 0}</h3></div>
    <div class="type"><h3 id="type-health_opt">health_opt() = <a href="#type-hc_check_interval_opt" class="seealso">hc_check_interval_opt()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="#type-hc_max_callback_fails_opt" class="seealso">hc_max_callback_fails_opt()</a><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="#type-hc_max_health_fails_opt" class="seealso">hc_max_health_fails_opt()</a></h3></div>
    <div class="type"><h3 id="type-health_opts">health_opts() = [<a href="#type-health_opt" class="seealso">health_opt()</a>]</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/0">start_link() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="service_up/2">service_up(Id, Pid) -&gt; term()
</h3>


<div class="description">

<p>Mark service as up. If previously registered with health checks,
  those are removed.</p>
</div></div>
<div class="function">
<h3 id="service_up/1">service_up(Id::atom(), Pid::pid(), MFA::mfa()) -&gt; ok</h3>


<div class="description">

<p><a href="#service_up/4" class="seealso">service_up/4</a> with default options.</p>
<p><em>See also:</em> <a href="#service_up/4" class="seealso">service_up/4</a>.</p>
</div></div>
<div class="function">
<h3 id="service_up/1-1">service_up(Id::atom(), Pid::pid(), Callback::mfa(), Options::health_opts()) -&gt; ok</h3>


<div class="description">

<p>Create a service that can be declared up or down based on the
  result of a function in addition to usual monitoring. The function can
  be set to be called automatically every interval, or only explicitly.
  An explicit health check can be done using <a href="#check_health/1" class="seealso">check_health/1</a>. The
  check interval is expressed in milliseconds. If <code>infinity</code> is passed
  in, a check is never done automatically. The function used to check for
  health must return a boolean; if it does not, it is considered an error.
  A check has a default maximum health failures as 1, and maximum number
  of other callback errors as 3. Either of those being reached will cause
  the service to be marked as down. In the case of a health failure, the
  health function will continue to be called at increasing intervals.  In
  the case of a callback error, the automatic health check is disabled.
  The callback function will have the pid of the service prepended to its
  list of args, so the actual arity of the function must be 1 + the length
  of the argument list provided. A service added this way is removed like
  any other, using <a href="#service_down/1" class="seealso">service_down/1</a>.</p>
<p><em>See also:</em> <a href="#service_up/2" class="seealso">service_up/2</a>.</p>
</div></div>
<div class="function">
<h3 id="check_health/1">check_health(Service::atom()) -&gt; ok</h3>


<div class="description">

<p>Force a health check for the given service.  If the service does
  not have a health check associated with it, this is ignored.  Resets the
  automatic health check timer if there is one.</p>
<p><em>See also:</em> <a href="#service_up/4" class="seealso">service_up/4</a>.</p>
</div></div>
<div class="function">
<h3 id="suspend_health_checks/0">suspend_health_checks() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="resume_health_checks/0">resume_health_checks() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="service_down/1">service_down(Id) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="node_up/0">node_up() -&gt; ok</h3>


<div class="description">

<p>Put this node in UP state, which would re-enable health checks
  if currently in the DOWN state.</p>
</div></div>
<div class="function">
<h3 id="node_down/0">node_down() -&gt; ok</h3>


<div class="description">

<p>Put this node in the DOWN state, which would suspend all health checks.</p>
</div></div>
<div class="function">
<h3 id="services/0">services() -&gt; [term()]</h3>


<div class="description">

<p>Returns a list of all services registered.</p>
</div></div>
<div class="function">
<h3 id="services/1">services(Node::node()) -&gt; [term()]</h3>


<div class="description">

<p>Returns a list of all services registered on the given node.</p>
</div></div>
<div class="function">
<h3 id="nodes/1">nodes(Service::term()) -&gt; [node()]</h3>


<div class="description">

<p>Returns a list of nodes which have registered the given service.</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
