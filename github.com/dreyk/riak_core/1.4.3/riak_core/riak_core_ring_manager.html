<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_core_ring_manager (riak_core) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_core_ring_manager</h1>
<h2 class="modsummary">the local view of the cluster's ring configuration.</h2>
<div class="description">
<p>the local view of the cluster's ring configuration</p>
 
  <p>Numerous processes concurrently read and access the ring in a
  variety of time sensitive code paths. To make this efficient,
  <code>riak_core</code> uses <code>mochiglobal</code> which exploits the Erlang constant  
pool to provide constant-time access to the ring without needing  
to copy data into individual process heaps.</p>
 
  <p>However, updating a <code>mochiglobal</code> value is very slow, and becomes slower  
the larger the item being stored. With large rings, the delay can  
become too long during periods of high ring churn, where hundreds of  
ring events are being triggered a second.</p>
 
  <p>As of Riak 1.4, <code>riak_core</code> uses a hybrid approach to solve this
  problem. When a ring is first written, it is written to a shared ETS
  table. If no ring events have occurred for 90 seconds, the ring is
  then promoted to <code>mochiglobal</code>.  This provides fast updates during
  periods of ring churn, while eventually providing very fast reads
  after the ring stabilizes. The downside is that reading from the ETS
  table before promotion is slower than <code>mochiglobal</code>, and requires  
copying the ring into individual process heaps.</p>
 
  <p>To alleviate the slow down while in the ETS phase, <code>riak_core</code>
  exploits the fact that most time sensitive operations access the ring
  in order to read only a subset of its data: bucket properties and
  partition ownership. Therefore, these pieces of information are
  extracted from the ring and stored in the ETS table as well to
  minimize copying overhead. Furthermore, the partition ownership
  information (represented by the <a href="chash.html" class="seealso">chash</a> structure) is converted
  into a binary <a href="chashbin.html" class="seealso">chashbin</a> structure before being stored in the
  ETS table. This <code>chashbin</code> structure is fast to copy between processes
  due to off-heap binary sharing. Furthermore, this structure provides a
  secondary benefit of being much faster than the traditional <code>chash</code>  
structure for normal operations.</p>
 
  <p>As of Riak 1.4, it is therefore recommended that operations that
  can be performed by directly using the bucket properties API or
  <code>chashbin</code> structure do so using those methods rather than
  retrieving the ring via <code>get_my_ring/0</code> or <code>get_raw_ring/0</code>.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/0">start_link() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="start_link/1">start_link(X1) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_my_ring/0">get_my_ring() -&gt; {ok, riak_core_ring() (see module riak_core_ring)} | {error, Reason}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_raw_ring/0">get_raw_ring() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_raw_ring_chashbin/0">get_raw_ring_chashbin() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="refresh_my_ring/0">refresh_my_ring() -&gt; ok</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="refresh_ring/2">refresh_ring(Node, ClusterName) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set_my_ring/1">set_my_ring(Ring::riak_core_ring() (see module riak_core_ring)) -&gt; ok</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_ring_id/0">get_ring_id() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_bucket_meta/1">get_bucket_meta(Bucket) -&gt; term()
</h3>


<div class="description">

<p>Return metadata for the given bucket</p>
</div></div>
<div class="function">
<h3 id="get_chash_bin/0">get_chash_bin() -&gt; term()
</h3>


<div class="description">

<p>Return the <a href="chashbin.html" class="seealso">chashbin</a> generated from the current ring</p>
</div></div>
<div class="function">
<h3 id="write_ringfile/0">write_ringfile() -&gt; ok</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="ring_trans/2">ring_trans(Fun, Args) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set_cluster_name/1">set_cluster_name(Name) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="force_update/0">force_update() -&gt; term()
</h3>


<div class="description">

<p>Exposed for support/debug purposes. Forces the node to change its
       ring in a manner that will trigger reconciliation on gossip.</p>
</div></div>
<div class="function">
<h3 id="do_write_ringfile/1">do_write_ringfile(Ring) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="find_latest_ringfile/0">find_latest_ringfile() -&gt; string()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="read_ringfile/1">read_ringfile(RingFile::string()) -&gt; riak_core_ring() (see module riak_core_ring) | {error, any()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="prune_ringfiles/0">prune_ringfiles() -&gt; ok | {error, Reason}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="init/1">init(X1) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_call/3">handle_call(X1, From, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_cast/2">handle_cast(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_info/2">handle_info(Info, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="setup_ets/1">setup_ets(Mode) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="cleanup_ets/1">cleanup_ets(X1) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set_ring_global/1">set_ring_global(Ring) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
