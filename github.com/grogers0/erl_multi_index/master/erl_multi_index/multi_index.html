<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>multi_index (erl_multi_index) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>multi_index</h1>
<h2 class="modsummary">Multi index implements a key - value dictionary which stores values  
based on multiple keys.</h2>
<div class="description">
<p>Multi index implements a key - value dictionary which stores values  
based on multiple keys. Multi index only stores values, the keys used for  
indices are derived from the values by user defined key functions. There can  
be multiple indices, and it is possible to look up values based on any of  
these indices. A common use case is to store tuples, which can be looked up  
by each of their elements.</p>
 
  <p>When creating indices, an <i>index type</i> and a <i>key function</i> are
  needed. The key function takes a value and generates a key from it to be
  used in indexing the values.  There are two types of indices available -
  <i>ordered_unique</i> and <i>ordered_non_unique</i>.  Both of these indices
  store values in order based on the key. With an ordered_unique index, keys
  derived from values cannot compare the same as any other key for that index,
  this comparison is done with <code>==</code> operator. When calling
  functions that take an <i>IndexNum</i>, the index num is the position in the
  list of indices given to <a href="#new/1" class="seealso">new/1</a>, for example in the multi index
  <code>MI = multi_index:new([{ordered_non_unique, fun x/1}, {ordered_unique,
  fun y/1}])</code> the non-unique index with function x is index 1, and the  
unique index with function y is index 2.</p>
 
  <p><em><marker id="EXAMPLES">EXAMPLES</marker></em>
  Example of an employee list using a multi index to look up employees by
  various fields.
  <code>
  -module(employee_list).
 
  -define(BY_NAME, 1).
  -define(BY_JOB, 2).
 
  -export([new/0, hire/3, fire/2, department_list/2]).
 
  new() -&gt;
      multi_index:new([{ordered_unique, fun(X) -&gt; element(1, X) end},
              {ordered_non_unique, fun(X) -&gt; element(2, X) end}]).
 
  hire(Name, Job, Employees) -&gt;
      case multi_index:try_insert({Name, Job}, Employees) of
          {ok, NewEmployees} -&gt; {ok, NewEmployees};
          error -&gt; {error, "This employee already works here"}
      end.
 
  fire(Name, Employees) -&gt;
      case multi_index:fetch_all(Name, ?BY_NAME, Employees) of
          [_Emp] -&gt; {ok, multi_index:erase(Name, ?BY_NAME, Employees)};
          _ -&gt; {error, "This employee does not work here"}
      end.
 
  department_list(Job, Employees) -&gt;
      multi_index:fetch_all(Job, ?BY_JOB, Employees).
  </code></p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-index">index() = {ordered_unique, <a href="#type-key_function" class="seealso">key_function()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {ordered_non_unique, <a href="#type-key_function" class="seealso">key_function()</a>}</h3></div>
    <div class="type"><h3 id="type-key_function">key_function() = fun((term()) -&gt; term())</h3></div>
    <div class="type"><h3 id="type-multi_index">multi_index() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#multi_index{n = integer(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indices = [<a href="#type-index" class="seealso">index()</a>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_val_stores = [<a href="#type-ordered_index" class="seealso">ordered_index()</a>]}</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="erase/3">erase(Key, IndexNum, MI) -&gt; multi_index()</h3>

<ul class="type">
<li><code>Key = term()</code></li><li><code>IndexNum = integer()</code></li><li><code>MI = multi_index()</code></li></ul>
<div class="description">

<p>Erases all elements, if any, from the multi index <code>MI</code> whose
  key for index number <code>IndexNum</code> matches <code>Key</code>. The
  resulting multi index is returned.</p>
</div></div>
<div class="function">
<h3 id="fetch/3">fetch(Key, IndexNum, MI) -&gt; Value</h3>

<ul class="type">
<li><code>Key = term()</code></li><li><code>IndexNum = integer()</code></li><li><code>MI = multi_index()</code></li><li><code>Value = term()</code></li></ul>
<div class="description">

<p>Fetches and returns a single element from the multi index
  <code>MI</code> whose key for index number <code>IndexNum</code> matches
  <code>Key</code>.  Assumes that a matching value is present, crashes
  otherwise. If this can happen, use <a href="#fetch_all/2" class="seealso">fetch_all/2</a> instead. If
  <code>IndexNum</code> is a non-unique index and more than one matching value
  is found, it is unspecified which one is returned.</p>
</div></div>
<div class="function">
<h3 id="fetch_all/3">fetch_all(Key, IndexNum, MI) -&gt; [Value]</h3>

<ul class="type">
<li><code>Key = term()</code></li><li><code>IndexNum = integer()</code></li><li><code>MI = multi_index()</code></li><li><code>Value = term()</code></li></ul>
<div class="description">

<p>Looks up and returns a possibly empty list of all values in the multi
  index <code>MI</code> and whose key for index number <code>IndexNum</code>
  matches <code>Key</code>. If <code>IndexNum</code> is a non-unique index and
  more than one matching value is found, it is unspecified which order the
  values are returned in.</p>
</div></div>
<div class="function">
<h3 id="from_list/2">from_list(Values, Indices) -&gt; multi_index()</h3>

<ul class="type">
<li><code>Values = [term()]</code></li><li><code>Indices = [index()]</code></li></ul>
<div class="description">

<p>Returns a new multi index whose elements are the elements in
  <code>Values</code>, and with indicse <code>Indices</code>. Assumes that no
  value in <code>Values</code> contains a key conflict with any other value in
  <code>Values</code>, crashes if this happens.  If a different behavior is
  needed, <code>lists:foldl</code> should be used to build up a new multi
  index instead.</p>
<p><em>See also:</em> <a href="#new/1" class="seealso">new/1</a>.</p>
</div></div>
<div class="function">
<h3 id="insert/2">insert(Value, MI) -&gt; multi_index()</h3>

<ul class="type">
<li><code>Value = term()</code></li><li><code>MI = multi_index()</code></li></ul>
<div class="description">

<p>Inserts the element <code>Value</code> into the multi index
  <code>MI</code> and returns the resulting multi index.  Assumes that
  <code>Value</code> does not contain a key conflict with any value in
  <code>MI</code>, crashes otherwise. If this can happen, use <a href="#try_insert/2" class="seealso">try_insert/2</a> instead.</p>
</div></div>
<div class="function">
<h3 id="indices/1">indices(MI) -&gt; [index()]</h3>

<ul class="type">
<li><code>MI = multi_index()</code></li></ul>
<div class="description">

<p>Returns the indices used in the multi index <code>MI</code>.</p>
</div></div>
<div class="function">
<h3 id="new/1">new(Indices) -&gt; multi_index()</h3>

<ul class="type">
<li><code>Indices = [index()]</code></li></ul>
<div class="description">

<p>Returns an empty multi index with indices <code>Indices</code>.</p>
 
  <p>When passing indices, the first element in the list of indices is the first
  index, the second element (if any) is the second index, and so on. There
  must be at least one index given.</p>
</div></div>
<div class="function">
<h3 id="replace/3">replace(Value1, Value2, MI) -&gt; multi_index()</h3>

<ul class="type">
<li><code>Value1 = term()</code></li><li><code>Value2 = term()</code></li><li><code>MI = multi_index()</code></li></ul>
<div class="description">

<p>Replaces all instances of <code>Value1</code> with <code>Value2</code>
  in the multi index <code>MI</code> and returns the resulting multi index.
  Assumes at least one <code>Value1</code> exists in <code>MI</code>, crashes
  otherwise.</p>
</div></div>
<div class="function">
<h3 id="size/1">size(MI) -&gt; integer()</h3>

<ul class="type">
<li><code>MI = multi_index()</code></li></ul>
<div class="description">

<p>Returns the number of elements stored in the multi index
  <code>MI</code>.</p>
</div></div>
<div class="function">
<h3 id="to_list/2">to_list(IndexNum, MI) -&gt; [Value]</h3>

<ul class="type">
<li><code>IndexNum = integer()</code></li><li><code>MI = multi_index()</code></li><li><code>Value = term()</code></li></ul>
<div class="description">

<p>Returns a list of all values in the multi index <code>MI</code>, in the
  order of their keys for index number <code>IndexNum</code>. If
  <code>IndexNum</code> is a non-unique index and multiple values with the
  same key are found, it is unspecified which order the equal keyed values are
  placed in the list relative to each other.</p>
</div></div>
<div class="function">
<h3 id="try_insert/2">try_insert(Value, MI1) -&gt; {ok, MI2} | error</h3>

<ul class="type">
<li><code>Value = term()</code></li><li><code>MI1 = multi_index()</code></li><li><code>MI2 = multi_index()</code></li></ul>
<div class="description">

<p>Attempt to insert the element <code>Value</code> into the multi index
  <code>MI1</code>. If the element can be inserted, multi index
  <code>MI2</code> is created with that element inserted and <code>{ok,
  MI2}</code> is returned. If the element cannot be inserted because it
  violates a unique key constraint in <code>MI1</code>, then
  <code>error</code> is returned.</p>
</div></div></div>

<authors>

<aname>Gregory Rogers</aname>
<email>greg.r.rogers@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
