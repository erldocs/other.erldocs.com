<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>db (db) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>db</h1>
<h2 class="modsummary">DB wrapper, that handles all DB requests.</h2>
<div class="description">
<p>DB wrapper, that handles all DB requests.</p>
  
   Each riak node has a limited amount of supported connections,
   Therefore the DB is a service with workers. The db workers perform
   all the requests and abstract away the DB connection.
   Thus the amount of workers equals the amount of open connections.</div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="ping_riak/0">ping_riak() -&gt; pong | pang</h3>


<div class="description">

<p>
  Ping riak.
 </p>
</div></div>
<div class="function">
<h3 id="get/1">get(Bucket::binary(), Key::binary()) -&gt; {ok, db_obj()} | {error, notfound}</h3>


<div class="description">

<p>
  Gets a value from the DB.
 </p>
</div></div>
<div class="function">
<h3 id="get/1-1">get(Bucket::binary(), Key::binary(), Options::list()) -&gt; {ok, db_obj()} | {error, notfound}</h3>


<div class="description">

<p>
  Gets a value from the DB, supplying options.
  Options:
       [{r, 1}] would set r=1 for the request
       [{if_modified, VClock}] will return unchanged if the object's vclock matches
       [head] only return the object's metadata, the value is set to binary
       [deletedvclock] return a vclock if a tombstone is encountered
 </p>
</div></div>
<div class="function">
<h3 id="get_resolve/1">get_resolve(Bucket::binary(), Key::binary(), Hist::#session_history{}, Field::integer()) -&gt; {ok, db_obj()} | {error, notfound}</h3>


<div class="description">

<p>
  Same as get/2, but tries to resolve siblings with the session
  history, if any. Where Field is the position where the session is
  stored in the record.
 </p>
</div></div>
<div class="function">
<h3 id="get_resolve/5">get_resolve(Bucket, Key, Options, Hist, Field) -&gt; term()
</h3>


<div class="description">

<p>
  Same as get/3, but tries to resolve siblings with the session
  history, if any.
 </p>
</div></div>
<div class="function">
<h3 id="get_values/1">get_values(Bucket::binary(), Keys::[binary()]) -&gt; {ok, [any()]} | {error, any()}</h3>


<div class="description">

<p>
  Gets a list of values from the DB.
 </p>
</div></div>
<div class="function">
<h3 id="get_values/1-1">get_values(Bucket::binary(), Keys::[binary()], Timeout::integer()) -&gt; {ok, [any()]} | {error, any()}</h3>


<div class="description">

<p>
  Gets a list of values from the DB.
 </p>
</div></div>
<div class="function">
<h3 id="get_key_filter/1">get_key_filter(Bucket::binary(), KeyFilter::Query) -&gt; {ok, [list()]} | {error, term()}</h3>


<div class="description">

<p>
  Returns a list of values according to a key filter, example:
  get_key_filter( <code>&lt;&lt;"message_unread"&gt;&gt;</code>,
                 [[<code>&lt;&lt; "ends_with" &gt;&gt;</code>, db:int_to_bin(UserId)]]).
  This would return all object values in the bucket "message_unread",
  where the key ends with the UserId.
  More information: http://wiki.basho.com/Key-Filters.html
 </p>
</div></div>
<div class="function">
<h3 id="put/1">put(Obj::db_obj()) -&gt; ok | {ok, key()} | {error, term()}</h3>


<div class="description">

<p>
  Stores an object in the database.
 </p>
</div></div>
<div class="function">
<h3 id="put/1-1">put(Obj::db_obj(), Options::list()) -&gt; ok | {ok, key()} | {error, term()}</h3>


<div class="description">

<p>
  Stores an object in the database, supplying options.
  Options:
       [{w,2}] sets w=2,
       [{dw,1}] set dw=1,
       [{pw,1}] set pw=1,
       [return_body] returns the updated metadata/value
       [return_head] returns the updated metadata with the values set as binary
       [if_not_modified] the put fails unless riakc_obj and database vclocks match
       [if_none_match] the put fails if the key already exist
  There is a special case for the options: we extended the options to
  also understand <code>{w,0}</code>, this works only if <code>{w,0}</code> is the FIRST item
  in the option-list (for performance reasons). <code>{w,0}</code> means that a process
  will be spawned that does the write, <code>put/2</code> will return immediately.</p>
</div></div>
<div class="function">
<h3 id="delete/1">delete(Bucket::binary(), Key::binary()) -&gt; ok | {error, term()}</h3>


<div class="description">

<p>
  Deletes a value from the database.
 </p>
</div></div>
<div class="function">
<h3 id="delete/1-1">delete(Bucket::binary(), Key::binary(), Options::list()) -&gt; ok | {error, term()}</h3>


<div class="description">

<p>
  Deletes a value from the database, supplying options.
  Options:
       [{rw,2}] sets rw=2 - this is deprecated
       [{r,1}] sets r=1
       [{w,all}] sets w=all
       [{pr,quorum}] sets pr=quorum
       [{pw,2}] sets pw=2
       [{dw,2}] sets dw=2
 </p>
</div></div>
<div class="function">
<h3 id="empty_bucket/1">empty_bucket(Bucket::binary()) -&gt; ok | {error, Error}</h3>


<div class="description">

<p>
   Deletes all documents in given bucket.
 </p>
</div></div>
<div class="function">
<h3 id="empty_db/0">empty_db() -&gt; ok</h3>


<div class="description">

<p>
   Deletes all documents in all buckets.</p>
</div></div>
<div class="function">
<h3 id="list_buckets/0">list_buckets() -&gt; {ok, [binary()]} | {error, term()}</h3>


<div class="description">

<p>
  Lists all the buckets in the riak cluster.
 </p>
</div></div>
<div class="function">
<h3 id="list_keys/1">list_keys(Bucket::binary()) -&gt; {ok, [binary()]}</h3>


<div class="description">

<p>
  Lists all keys for a given bucket.
  WARNING: To be used only for debugging and not for regular use
 </p>
</div></div>
<div class="function">
<h3 id="get_bucket/1">get_bucket(Bucket::binary()) -&gt; {ok, bucket_props()} | {error, term()}</h3>


<div class="description">

<p>
  Gets the bucket properties.
 </p>
</div></div>
<div class="function">
<h3 id="set_bucket/1">set_bucket(Bucket::binary(), BucketProps::bucket_props()) -&gt; ok | {error, term()}</h3>


<div class="description">

<p>
  Sets the bucket properties.
 </p>
</div></div>
<div class="function">
<h3 id="mapred/1">mapred(Inputs::[{Bucket::binary(), Key::binary()}], Query::[MAGIC]) -&gt; {ok, list()} | {error, term()}</h3>


<div class="description">

<p>
  Perform a map/reduce on the given Inputs.
 </p>
</div></div>
<div class="function">
<h3 id="mapred/3">mapred(Inputs, Query, Timeout) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="mapred_bucket/1">mapred_bucket(Bucket::binary(), Query::[MAGIC]) -&gt; {ok, list()} | {error, term()}</h3>


<div class="description">

<p>
  Perform a map/reduce on the given bucket.
 </p>
</div></div>
<div class="function">
<h3 id="mapred_bucket/3">mapred_bucket(Bucket, Query, Timeout) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="search/1">search(Bucket::binary(), Query::[MAGIC]) -&gt; {ok, list()} | {error, term()}</h3>


<div class="description">

<p>
  Perform a search on the given bucket.
 </p>
</div></div>
<div class="function">
<h3 id="search_values/1">search_values(Bucket::binary(), Query::[MAGIC]) -&gt; {ok, list()} | {error, term()}</h3>


<div class="description">

<p>
  Perform a search on the given bucket and returns the values of all
  results
 </p>
</div></div>
<div class="function">
<h3 id="get_db_stats/0">get_db_stats() -&gt; term()
</h3>


<div class="description">

<p>
  Allow operator to view database system status
 </p>
</div></div>
<div class="function">
<h3 id="get_unique_id/0">get_unique_id() -&gt; integer()</h3>


<div class="description">

<p>
  Returns a unique id.
 </p>
</div></div>
<div class="function">
<h3 id="int_to_bin/1">int_to_bin(Id::integer()) -&gt; binary()</h3>


<div class="description">

<p>
  Converts an integer id to the expected binary format.
 </p>
</div></div>
<div class="function">
<h3 id="int_to_bin/1-1">int_to_bin(Id::integer(), Suffix::string()) -&gt; binary()</h3>


<div class="description">

<p>
  Converts an integer id to the expected binary format with a given
  suffix.
 </p>
</div></div></div>

<authors>

<aname>Andre Hilsendeger</aname>
<email>Andre.Hilsendeger@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
