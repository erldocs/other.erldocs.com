<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>egtm_util (egtm) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>egtm_util</h1>
<h2 class="modsummary">EGTM Utilities.</h2>
<div class="description">
<p>EGTM Utilities.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-global_name">global_name() = string()</h3></div>
    <div class="type"><h3 id="type-subscripts">subscripts() = list()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="stringify/1">stringify(Data::any()) -&gt; Result::string()</h3>


<div class="description">

<p>Convert any datatype to string.</p>
</div></div>
<div class="function">
<h3 id="set_term/1">set_term(Flag::nocenable) -&gt; ok</h3>


<div class="description">

<p>Sets terminal characteristics. At the moment,
  only <code>NOCENABLE</code> is currently supported. (= <code>U $P:NOCENABLE</code>).</p>
</div></div>
<div class="function">
<h3 id="foreach/1">foreach(Gvn::global_name(), Subs::subscripts()) -&gt; nomatch | {ok, AccumulatedData::list()}</h3>


<div class="description">

<p>Foreach implementation based on <code>egtm:order()</code>
  and <code>egtm:get()</code>.
  <code>Gvn</code> is a name of MUMPS global array.
  <code>Subs</code> is a list of keys (subscripts) <code>[S1,...,SN]
  so that S(N+1) will be used to `egtm:order()</code> over.
  <code>Fun</code> argument is function of arity 2 (Gvn, Subs)
  or arity 3 (Gvn, Subs, ResultAccumulator).
  If the <code>Fun</code> argument is not specified, all the
  records will be written on standard output via
  <code>io:format()</code>.</p>
 
  <p>Example:
  </p><pre class="sh_erlang">  egtm_util:foreach ("^Foo", [1,2,3], fun (G, S) -&gt;
    io:format ("~p ~p -&gt; ~p", [G, S, egtm:get (G, S)]) end).</pre><p>
  ...is equivalent of MUMPS code similar to this:
  </p><pre class="sh_erlang">  N X S X="" F  S X=$O(^Foo(1,2,3,X)) Q:X=""  D
  . W $NA(^(X)),"=",$G(^(X)),!</pre>
</div></div>
<div class="function">
<h3 id="foreach/1-1">foreach(Gvn::global_name(), Subs::subscripts(), Fun::function()) -&gt; nomatch | {ok, AccumulatedData::list()}</h3>


<div class="description">
<p>Equivalent to <a href="#foreach/2" class="seealso">foreach(Gvn, Subs)</a>.</p>
</div></div>
<div class="function">
<h3 id="gforeach/0">gforeach() -&gt; term()
</h3>


<div class="description">
<p>Equivalent to <a href="#gforeach/1" class="seealso">gforeach(PrintAllGvnsFunction)</a>.</p>
</div></div>
<div class="function">
<h3 id="gforeach/1">gforeach(Fun) -&gt; term()
</h3>


<div class="description">

<p>Global Variable Name Foreach.
  Uses special case of MUMPS <code>$Order</code>  
(GT.M-specific trick!) to iterate over  
all global variables available.</p>
 
  <p><code>Fun</code> is function of arity one or two.
  First argument passed to <code>Fun</code> is the  
name of global variable and the second  
(optional) is result accumulator variable.</p>
 
  <p>When used with the <code>Fun</code> of arity of one,
  the accumulator is automatically collected
  as the list of all the results of each
  <code>Fun</code> call.</p>
 
  <p>Examples:
  </p><pre class="sh_erlang">  erl&gt; egtm_util:gforeach ().
  ^%EUnit=[]
  ^ZFOO="1"
  ^ZTMR="1"
  {ok,["^%EUnit","^ZFOO","^ZTMR"]}
 
  erl&gt; egtm_util:gforeach (fun (G) -&gt; G end).
  {ok,["^%EUnit","^ZFOO","^ZTMR"]}
 
  erl&gt; egtm_util:gforeach (fun (G) -&gt; egtm:data (G) end).
  {ok,[10,1,11]}
 
  erl&gt; egtm_util:gforeach (fun (G, Res) -&gt; {ok, R} = egtm_util:foreach (G, []), Res end).
  ^%EUnit["perf"]=[]
  ^ZTMR["1"]="2"
  ^ZTMR["2"]="3"
  ^ZTMR["3"]="4"
  {ok,[]}
 
  erl&gt; egtm_util:gforeach (fun (G, Res) -&gt;
         {ok, R} = egtm_util:foreach (G, [],
           fun (G, S, A) -&gt; [{S,egtm:get (G, S)}|A] end),
         [{G,R}|Res] end).
  {ok,[{"^ZTMR",[{["3"],"4"},{["2"],"3"},{["1"],"2"}]},
       {"^ZFOO",[]},
       {"^%EUnit",[{["perf"],[]}]}]}</pre>
</div></div>
<div class="function">
<h3 id="transaction/1">transaction(Fun::function()) -&gt; {ok, commit | rollback, Status::any()}</h3>


<div class="description">

<p>Transaction processing (TP) support.
  The only parameter of <code>Fun</code> is function  
that is to be run within a transaction  
block.</p>
 
  <p>Example:
  </p><pre class="sh_erlang">  case transaction (fun () -&gt;
      egtm:lock (Gvn, Subs),
      egtm:kill (Gvn, Subs),
      egtm:set (Gvn, Subs, Value),
      egtm:unlock (Gvn, Subs)
    end) of
 
    {ok, commit, Res} -&gt; {ok, Res};
    Whatever          -&gt; {error, Whatever}
  end</pre><p>
  ...is a Erlang equivalent of MUMPS code similar to
  (if <code>Gvn="^Foo"</code>, <code>Subs=[1,2,3]</code> and <code>Value="abc"</code>):
  </p><pre class="sh_erlang">     TS  L +^Foo(1,2,3) K ^Foo(1,2,3) S ^Foo(1,2,3)="abc" L -^Foo(1,2,3) TC</pre>
</div></div>
<div class="function">
<h3 id="lock/1">lock(Gvn::global_name(), Subs::subscripts(), Fun::function()) -&gt; Result::any()</h3>


<div class="description">

<p>Run a function <code>Fun</code> within a lock-block
  on <code>Gvn</code> global with <code>Subs</code> subscripts.</p>
</div></div>
<div class="function">
<h3 id="lock/1-1">lock(Gvn::global_name(), Fun::function()) -&gt; Result::any()</h3>


<div class="description">
<p>Equivalent to <a href="#lock/3" class="seealso">lock(Gvn, Subs, Fun)</a>.</p>
</div></div>
<div class="function">
<h3 id="longstring_set/1">longstring_set(Gvn::global_name(), Subs::subscripts(), Text::string(), BlockSize::integer()) -&gt; {ok, Result::any()} | {error, Reason::any()}</h3>


<div class="description">

<p>Longstring get/set support.
  <code>longstring_set</code> and <code>longstring_get</code> usually operates
  on strings with sizes larger than maximal GT.M string
  (1MB) limit.
  The mechanism is based on cutting strings into chunks
  of (optionally) specified length <code>BlockSize</code> and putting
  them into subindex of <code>Subs</code> subscripts in <code>Gvn</code> global.</p>
 
  <p><code>BlockSize</code> cannot be less than 1 and if specified  
incorrectly or completely missing, it is expected  
to be 4000 by default.</p>
 
  <p>Example (<code>BlockSize=5</code>):
  </p><pre class="sh_erlang">  erl&gt; egtm_util:longstring_set ("^Foo", ["a","b"], "hello world from erlang and gt.m!", 5).
  {ok,done}
 
  erl&gt; egtm_util:longstring_get ("^Foo", ["a","b"]).
  "hello world from erlang and gt.m!"
 
  erl&gt; egtm_util:foreach ("^Foo", ["a","b"]).
  ^Foo["a","b","1"]="hello"
  ^Foo["a","b","2"]=" worl"
  ^Foo["a","b","3"]="d fro"
  ^Foo["a","b","4"]="m erl"
  ^Foo["a","b","5"]="ang a"
  ^Foo["a","b","6"]="nd gt"
  ^Foo["a","b","7"]=".m!"</pre>
</div></div>
<div class="function">
<h3 id="longstring_set/1-1">longstring_set(Gvn::global_name(), Subs::subscripts(), Text::string()) -&gt; {ok, Result::any()} | {error, Reason::any()}</h3>


<div class="description">
<p>Equivalent to <a href="#longstring_set/4" class="seealso">longstring_set(Gvn, Subs, Text, 4000)</a>.</p>
</div></div>
<div class="function">
<h3 id="longstring_get/1">longstring_get(Gvn::global_name(), Subs::subscripts()) -&gt; Result::string()</h3>


<div class="description">
<p>Equivalent to <a href="#longstring_set/3" class="seealso">longstring_set(Gvn, Subs, Text)</a>.</p>
</div></div>
<div class="function">
<h3 id="longstring_kill/1">longstring_kill(Gvn::global_name(), Subs::subscripts()) -&gt; {ok, Result::any()} | {error, Reason::any()}</h3>


<div class="description">
<p>Equivalent to <a href="#longstring_set/3" class="seealso">longstring_set(Gvn, Subs, [])</a>.</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
