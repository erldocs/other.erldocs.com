<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>jc_store (j_cache) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>jc_store</h1>
<h2 class="modsummary">This module manages the mapping of a Map and
   Key to a Value,.</h2>
<div class="description">
<p>This module manages the mapping of a <a href="#type-map_name" class="seealso">Map</a> and
   <a href="#type-key" class="seealso">Key</a> to a <a href="#type-value" class="seealso">Value</a>,</p>
  
   <list>
   <item><p>The Mnesia table, key_to_value, stores the Map, Key, Value,
       Create Time, Last Update Time and a unique record
       reference. </p></item>
   <item><p>The time-stamps are unix-style, time-since-epoch, millisecond
       granularity.</p></item>
   <item><p>A table, TTL, maps the unique record reference to a timer_ref so that,
       when the timer goes off, it can find the record that needs to be
       deleted. This is managed by the jc_eviction_manager process </p></item>
   </list>
  
   IT IS UP TO THE CALLER TO WRAP THESE FUNCTIONS IN THE APPROPRIATE MNESIA
   TRANSACTIONS
  </div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-key">key() = any()</h3></div>
    <div class="type"><h3 id="type-key_to_value">key_to_value() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#key_to_value{jc_key = undefined | {<a href="#type-key" class="seealso">key()</a>, <a href="#type-map_name" class="seealso">map_name()</a>},<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map = undefined | <a href="#type-map_name" class="seealso">map_name()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key = undefined | <a href="#type-key" class="seealso">key()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value = undefined | <a href="#type-value" class="seealso">value()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;create_tm = undefined | <a href="#type-time_stamp" class="seealso">time_stamp()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_update = undefined | <a href="#type-time_stamp" class="seealso">time_stamp()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ttl_secs = undefined | <a href="#type-ttl" class="seealso">ttl()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ref = undefined | <a href="#type-rec_ref" class="seealso">rec_ref()</a>}</h3></div>
    <div class="type"><h3 id="type-map_name">map_name() = atom()</h3></div>
    <div class="type"><h3 id="type-rec_ref">rec_ref() = reference()</h3></div>
    <div class="type"><h3 id="type-seconds">seconds() = integer() &gt;= 0</h3></div>
    <div class="type"><h3 id="type-time_stamp">time_stamp() = <a href="#type-seconds" class="seealso">seconds()</a></h3></div>
    <div class="type"><h3 id="type-ttl">ttl() = <a href="#type-seconds" class="seealso">seconds()</a></h3></div>
    <div class="type"><h3 id="type-value">value() = any()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="up_nodes/0">up_nodes() -&gt; [node()]</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="stats/1">stats(X1::size | up) -&gt; {size, [{TableNm::atom(), {records, RecCnt::non_neg_integer()}, {bytes, Words::non_neg_integer()}}]} | {uptime, term()} | {error, not_found | badarg}</h3>


<div class="description">

<p>Return information size and uptime information.
 </p>
</div></div>
<div class="function">
<h3 id="init/0">init() -&gt; ok</h3>


<div class="description">

<p>Either join an existing mnesia cluster or create the tables and start
  one. Notice that this WILL delete any mnesia schema on the node.
 </p>
</div></div>
<div class="function">
<h3 id="clear/1">clear(Map::map_name()) -&gt; ok</h3>


<div class="description">

<p>Clear all data for the given map.
 </p>
</div></div>
<div class="function">
<h3 id="evict/1">evict(Map::map_name(), Key::key()) -&gt; ok</h3>


<div class="description">

<p>Evict Map/Key from the cache
 </p>
</div></div>
<div class="function">
<h3 id="flush/0">flush() -&gt; ok</h3>


<div class="description">

<p>Delete the  entire cache.
 </p>
</div></div>
<div class="function">
<h3 id="get/1">get(Map::map_name(), Key::key()) -&gt; {ok, key_to_value() | jc_miss} | {error, not_found}</h3>


<div class="description">

<p>Return the #key_to_value{} which contains the data associated with
  <a href="#type-map_name" class="seealso">Key</a> and <a href="#type-key" class="seealso">Key</a>.
 </p>
</div></div>
<div class="function">
<h3 id="get_map/1">get_map(Map::map_name()) -&gt; {ok, Results::key_to_value()}</h3>


<div class="description">

<p>Return all the #key_to_value() for a given <a href="#type-map_name" class="seealso">Map</a>.
 </p>
</div></div>
<div class="function">
<h3 id="put/1">put(Map::map_name(), Key::key(), Value::value(), TTL::ttl(), Ref::rec_ref()) -&gt; {ok, {put, rec_ref()}}</h3>


<div class="description">

<p>Put the {link @map_name(). Map} and <a href="#type-key" class="seealso">Key</a> record.
  Return a tuple with a reference to the record so that an eviction timer can
  be created by the caller. IF THE PUT EVICTED AN ENTRY, JC_PSUB WILL DETECT
  THIS, CANCEL THE OLD TIMER AND RAISE THE EVENT TO SUBSCRIBERS.
 </p>
</div></div>
<div class="function">
<h3 id="delete_record_by_ref/1">delete_record_by_ref(RecRef::rec_ref()) -&gt; ok</h3>


<div class="description">

<p>Delete the cache element by its record reference.
 </p>
</div></div>
<div class="function">
<h3 id="fun_match/1">fun_match(Map::map_name(), Paths::tuple(), Test::atom(), Fun::function()) -&gt; [term()]</h3>


<div class="description">

<p>Select those Map items whose JSON value, at the given path, equals Test
  and invoke the supplied function/4 with the Map, Key, Value and
  fold accumulator as parameters. The fn is expected to return the new Acc.
 </p>
</div></div></div>

<authors>

<aname>Jim Rosenblum</aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
