<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>sqerl_adhoc (sqerl) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>sqerl_adhoc</h1>
<h2 class="modsummary">SQL generation library.</h2>
<div class="description">
<p>SQL generation library.  
Copyright 2011-2012 Opscode, Inc. All Rights Reserved.</p>
 
  <p>This file is provided to you under the Apache License,  
Version 2.0 (the "License"); you may not use this file  
except in compliance with the License.  You may obtain  
a copy of the License at</p>
 
    <p>http://www.apache.org/licenses/LICENSE-2.0</p>
 
  <p>Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
 </p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-sqerl_row">sqerl_row() = [{binary(), term()}]</h3></div>
    <div class="type"><h3 id="type-sqerl_sql">sqerl_sql() = string() | binary()</h3></div>
    <div class="type"><h3 id="type-sql_clause">sql_clause() = atom() | tuple()</h3></div>
    <div class="type"><h3 id="type-sql_word">sql_word() = <a href="#type-sqerl_sql" class="seealso">sqerl_sql()</a></h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="select/1">select(Columns::[sql_word()], Table::sql_word(), Clauses::[] | [sql_clause()], ParamStyle::atom()) -&gt; {binary(), list()}</h3>


<div class="description">

<p>Generates SELECT SQL.  
Returns {SQL, ParameterValues} which can be passed on to be executed.  
SQL generated uses parameter place holders so query can be  
prepared.</p>
 
  <p>Note: Validates that parameters are safe.</p>
 
  <pre class="sh_erlang">  Clauses = clause list
  Clause = Where|Order By|Limit
 
 
  Where Clause
  -------------
  Form: {where, Where}
 
  Where = all|undefined
  Does not generate a WHERE clause. Matches all records in table.
 
  1&gt; select([&lt;&lt;"*"&gt;&gt;], &lt;&lt;"users"&gt;&gt;, [], dollarn).
  {&lt;&lt;"SELECT * FROM users"&gt;&gt;, []}
 
  Where = {Field, equals|nequals|gt|gte|lt|lte, Value}
  Generates SELECT ... WHERE Field =|!=|&gt;|&gt;=|&lt;|&lt;= $1
 
  1&gt; select([&lt;&lt;"name"&gt;&gt;], &lt;&lt;"users"&gt;&gt;, [{where, {&lt;&lt;"id"&gt;&gt;, equals, 1}}], dollarn).
  {&lt;&lt;"SELECT name FROM users WHERE id = $1"&gt;&gt;, [1]}
 
  Where = {Field, in|notin, Values}
  Generates SELECT ... IN|NOT IN SQL with parameter strings (not values),
  which can be prepared and executed.
 
  1&gt; select([&lt;&lt;"name"&gt;&gt;], &lt;&lt;"users"&gt;&gt;, [{where, {&lt;&lt;"id"&gt;&gt;, in, [1,2,3]}}], dollarn).
  {&lt;&lt;"SELECT name FROM users WHERE id IN ($1, $2, $3)"&gt;&gt;, [1,2,3]}
 
  Where = {'and'|'or', WhereList}
  Composes WhereList with AND or OR
 
  1&gt; select([&lt;&lt;"id"&gt;&gt;], &lt;&lt;"t"&gt;&gt;, [{where, {'or', [{&lt;&lt;"id"&gt;&gt;, lt, 5}, {&lt;&lt;"id"&gt;&gt;, gt, 10}]}}]).
  {&lt;&lt;"SELECT id FROM t WHERE (id &lt; $1 OR id &gt; $2)"&gt;&gt;, [5,10]}
 
  Group By Clause
  ---------------
  Form: {groupby, Fields}
 
  Order By Clause
  ---------------
  Form: {orderby, Fields | {Fields, asc|desc}}
 
  Limit/Offset Clause
  --------------------
  Form: {limit, Limit} | {limit, {Limit, offset, Offset}}
 
  ParamStyle is dollarn ($1, $2, etc. for e.g. pgsql)</pre>
</div></div>
<div class="function">
<h3 id="update/1">update(Table::sql_word(), Row::sqerl_row(), Where::sql_clause(), ParamStyle::atom()) -&gt; {binary(), list()}</h3>


<div class="description">

<p>Generate UPDATE statement.</p>
 
  <p>Update is given under the form of a Row (proplist).  
Uses the same Where specifications as select/4 except for "all" which is  
not supported.</p>
 
  <pre class="sh_erlang">  1&gt; update(&lt;&lt;"users"&gt;&gt;, [{&lt;&lt;"last_name"&gt;&gt;, &lt;&lt;"Toto"&gt;&gt;}], {&lt;&lt;"id"&gt;&gt;, equals, 1}, dollarn).
  {&lt;&lt;"UPDATE users SET last_name = $1 WHERE id = $2"&gt;&gt;, [&lt;&lt;"Toto"&gt;&gt;, 1]}</pre><p>
  </p>
</div></div>
<div class="function">
<h3 id="delete/1">delete(Table::sql_word(), Where::sql_clause(), ParamStyle::atom()) -&gt; {binary(), [any()]}</h3>


<div class="description">

<p>Generate DELETE statement.</p>
 
  <p>Uses the same Where specifications as select/4.  
See select/4 for details about the "Where" parameter.</p>
 
  <pre class="sh_erlang">  1&gt; delete(&lt;&lt;"users"&gt;&gt;, {&lt;&lt;"id"&gt;&gt;, equals, 1}, dollarn).
  {&lt;&lt;"DELETE FROM users WHERE id = $1"&gt;&gt;, [1]}</pre><p>
 </p>
</div></div>
<div class="function">
<h3 id="insert/1">insert(Table::sql_word(), Columns::[sql_word()], NumRows::integer(), ParamStyle::atom()) -&gt; binary()</h3>


<div class="description">

<p>Generate INSERT statement for N rows.</p>
 
  <pre class="sh_erlang">  1&gt; insert(&lt;&lt;"users"&gt;&gt;, [&lt;&lt;"id"&gt;&gt;, &lt;&lt;"name"&gt;&gt;], 3, dollarn).
  &lt;&lt;"INSERT INTO users (name) VALUES ($1,$2),($3,$4),($5,$6)"&gt;&gt;</pre><p>
 </p>
</div></div></div>

<authors>

<aname>Jean-Philippe Langlois</aname>
<email>jpl@opscode.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
