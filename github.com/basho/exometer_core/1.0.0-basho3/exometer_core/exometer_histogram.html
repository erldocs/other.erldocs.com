<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>exometer_histogram (exometer_core) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>exometer_histogram</h1>
<h2 class="modsummary">Exometer histogram probe behavior  
This module implements histogram metrics.</h2>
<div class="description">
<p>Exometer histogram probe behavior  
This module implements histogram metrics. Each histogram is a sliding  
window, for which the following datapoints are calculated:</p>
 
  <p>* <code>max</code>: the maximum value
  * <code>min</code>: the minimum value
  * <code>mean</code>: the arithmetic mean
  * <code>median</code>: the median
  * <code>50|75|90|95|97|99</code>: percentiles
  * <code>999</code>: the 99.9th percentile
  * <code>n</code>: the number of values used in the calculation (Note)</p>
 
  <p>Two histogram implementations are supported and can be selected using
  the option <code>histogram_module</code>:</p>
 
  <p>* <code>exometer_slide</code> implements a sliding window, which saves all elements  
within the window. Updating the histogram is cheap, but calculating the  
datapoints may be expensive depending on the size of the window.</p>
 
  <p>* <code>exometer_slot_slide</code> (default), aggregates mean, min and max values
  within given time slots, thereby reducing the amount of data kept for
  datapoint calculation. The update overhead should be insignificant.
  However, some loss of precision must be expected. To achieve slightly
  better accuracy of percentiles, 'extra values' are kept (every 4th
  value). For the calculation, extra vaules are included in the set
  until a suitable number has been reached (up to 600). Note that
  <code>n</code> reflects the number of values used in the calculation - not the  
number of updates made within the time window.</p>
 
  <p>Supported options:</p>
 
  <p>* <code>time_span</code> (default: <code>60000</code>) size of the window in milliseconds.
  * <code>slot_period</code> (default: <code>1000</code>) size of the time slots in milliseconds.
  * <code>histogram_module</code> (default: <code>exometer_slot_slide</code>).
  * <code>truncate</code> (default: <code>true</code>) whether to truncate the datapoint values.
      Supported values: <code>true | false | round</code>, where <code>round</code> means to round
      the value rather than truncating it.
  * <code>keep_high</code> (default: <code>0</code>) number of top values to actually keep.</p>
 
  <p>The <code>keep_high</code> option can be used to get better precision for the higher
  percentiles. A bounded buffer (see <url href="/home/pete/wefwefwef/docs/other/61a2e8b25ce4fdcaa1fe25137f731a0b4bd63eea/repo/1.0.0-basho3/.xml/exometer_core/./exometer_shallowtree.xml">exometer_shallowtree</url>) is used
  to store the highest values, and these values are used to calculate the
  exact higher percentiles, as far as they go. For example, if the window
  saw 10,000 values, and the 1000 highest values are kept, these can be used
  to determine the percentiles <code>90</code> and up.
 </p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="behaviour/0">behaviour() -&gt; behaviour() (see module exometer)</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_init/3">probe_init(Name, Type, Options) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_terminate/1">probe_terminate(St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_get_value/2">probe_get_value(DPs, St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_get_datapoints/1">probe_get_datapoints(St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="datapoints/0">datapoints() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_setopts/3">probe_setopts(Entry, Opts, St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_update/2">probe_update(Value, St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_reset/1">probe_reset(St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_sample/1">probe_sample(St) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_handle_msg/2">probe_handle_msg(X1, S) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="probe_code_change/3">probe_code_change(X1, S, X3) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="average_sample/3">average_sample(TS, Val, Sample) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="average_transform/2">average_transform(TS, Sample) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="test_run/1">test_run(Module) -&gt; term()
</h3>


<div class="description">
<p>Equivalent to <a href="#test_run/2" class="seealso">test_run(Module, 1)</a>.</p>
</div></div>
<div class="function">
<h3 id="test_run/2">test_run(Module, Interval) -&gt; term()
</h3>


<div class="description">

<p>Test the performance and accuracy of a histogram callback module.</p>
 
  <p>This function uses a test set (<a href="#test_series/0" class="seealso">test_series/0</a>) and initializes
  and updates a histogram using the callback module <code>Module</code>.</p>
 
  <p>The <code>Module</code> argument can either be the module name, or <code>{ModName, Opts}</code>
  where <code>Opts</code> are options passed on to the histogram module.</p>
 
  <p><code>Interval</code> is the gap in milliseconds between the inserts. The test run  
will not actually wait, but instead manipulate the timestamp.</p>
 
  <p>Return value: <code>[Result1, Result2]</code>, where the results are
  <code>{Time1, Time2, Datapoints}</code>. <code>Time1</code> is the time (in microsecs) it took to
  insert the values. <code>Time2</code> is the time it took to calculate all default  
datapoints. The data set is shuffled between the two runs.</p>
 
  <p>To assess the accuracy of the reported percentiles, use e.g.
  <code>bear:get_statistics(exometer_histogram:test_series())</code> as a reference.</p>
</div></div>
<div class="function">
<h3 id="test_series/0">test_series() -&gt; [integer()]</h3>


<div class="description">

<p>Create a series of values for histogram testing.</p>
 
  <p>These are the properties of the current test set:
  </p><pre lang="erlang">
  1&gt; rp(bear:get_statistics(exometer_histogram:test_series())).
  [{min,3},
   {max,100},
   {arithmetic_mean,6.696},
   {geometric_mean,5.546722009408586},
   {harmonic_mean,5.033909932832006},
   {median,5},
   {variance,63.92468674297564},
   {standard_deviation,7.995291535833802},
   {skewness,7.22743137858698},
   {kurtosis,59.15674033499604},
   {percentile,[{50,5},{75,7},{90,8},{95,9},{99,50},{999,83}]},
   {histogram,[{4,2700},
               {5,1800},
               {6,900},
               {7,1800},
               {8,900},
               {9,720},
               {53,135},
               {83,36},
               {103,9}]},
   {n,9000}]
  </pre>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
