<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_err_app (riak_err) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_err_app</h1>
<h2 class="modsummary">A memory-limited info/error/warning event handler.</h2>
<div class="description">
<p>A memory-limited info/error/warning event handler.</p>
 
  <p>Replace the OTP default error_logger's event handler (which  
can cause memory use problems when handling very large messages)  
with a handler that will use a limited amount of RAM but is  
otherwise equivalent.</p>
 
  <p>Strictly speaking, this library need be a "code only" application,
  i.e. an OTP application without any support processes (like the
  <code>stdlib</code> OTP application).  However, there's one significant
  reason why <code>riak_err</code> would want to have a small monitoring  
server running.  The reason is as follows:</p>
 
  <p>The OTP <code>kernel</code> application's has a gen_event-based process
  with the registered name <code>error_logger</code> that handles all
  system info/error/warning messages, e.g., submitted by
  <code>error_logger:info_msg()</code> and related functions.  If there
  is a problem with an <code>error_logger</code> event handler (e.g.,  
throws an exception), the handler is silently removed from handling  
further events.</p>
 
  <p>We wish to know about all events, good and bad, despite software
  bugs.  Therefore, if there's an error in an event handler, we want
  a monitor process to find out about the error and act to re-install
  the handler.  If we don't re-install the handler, we will
  <em>never</em> see another event logged.  We want happy event  
logging, but we do not want to travel the "Ignorance is bliss" road  
to find that happiness.</p>
 
  <list>
 
  <item> We use a long-lived gen_server-based process (running code in
  this module) to be our monitor. </item>
 
  <item> We install the handler using
  <code>gen_event:add_sup_handler/3</code>.  If the handler exits or
  throws an exception, we'll be sent a <code>{gen_event_EXIT, ...}</code>
  message. </item>
 
  <item> If we receive the <code>{gen_event_EXIT, ...}</code> bad news
  message, we exit.  Our supervisor will restart us, and the
  side-effect of running our <code>init()</code> function is
  re-installing our custom event handler. </item>
 
 </list>
 
  <p><em><marker id="Configuration">Configuration</marker></em></p>
 
  <p>There are two config knobs may be specified on the command line
  via "-riak_err KnobName Integer" on the command line or (in a
  Basho application like Riak) via the same "-riak_err KnobName Integer"
  line in the <code>etc/vm.args</code> file).  Alternatively, these properties  
may be set using application environment variables by the same name.</p>
 
  <list>
  <item> <code>term_max_size</code> For arguments formatted in FormatString &
  ArgList style, if the total size of ArgList is more than term_max_size,
  then we'll ignore FormatString and log the message with a well-known
  (and therefore safe) formatting string.  The default is 10KBytes. </item>
 
  <item> <code>fmt_max_bytes</code> When formatting a log-related term that might
  be "big", limit the term's formatted output to a maximum of
  <code>fmt_max_bytes</code> bytes.  The default is 12KBytes. </item>
 
  <item> <code>console_error_type</code> Defines the
  handler's choices for writing formatted events to the console/tty.
  config values are not quite the same as the <code>sasl</code> application's
  <code>errlog_type</code> parameter: only <code>error</code> and <code>all</code>
  are valid.  The default is <code>all</code>. </item>
 
  <item> <code>console_sasl_reports</code> Defines whether or not SASL
  reports are written to the console/tty.  Valid values are Erlang
  boolean values.  The default is <code>false</code>. </item>
 
  </list>
 
  <p>For example, <code>erl -riak_err term_max_size 8192 fmt_max_bytes 9000</code>.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start/0">start() -&gt; ok | {error, term()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="start/2">start(StartType::normal | {takeover, node()} | {failover, node()}, StartArgs::term()) -&gt; {ok, pid()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="stop/1">stop(State::[]) -&gt; ok</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
