<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_dt_delta_emcntr (riak_dt) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_dt_delta_emcntr</h1>
<h2 class="modsummary">A PN-Counter CRDT.</h2>
<div class="description">
<p>A PN-Counter CRDT. A PN-Counter is essentially two G-Counters:
  one for increments and one for decrements. The value of the counter
  is the difference between the value of the Positive G-Counter and
  the value of the Negative G-Counter. However, this PN-Counter is
  for using embedded in a riak_dt_map. The problem with an embedded
  pn-counter is when the field is removed and added again. PN-Counter
  merge takes the max of P and N as the merged value. In the case
  that a field was removed and re-added P and N maybe be _lower_ than
  their removed values, and when merged with a replica that has not
  seen the remove, the remove is lost. This counter adds some
  causality by storing a <code>dot</code> with P and N. Merge takes the max
  event for each actor, so newer values win over old ones. The rest
  of the mechanics are the same.
 </p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-decrement_op">decrement_op() = decrement | {decrement, integer()}</h3></div>
    <div class="type"><h3 id="type-deferred_delta">deferred_delta() = <a href="#type-entry" class="seealso">entry()</a></h3></div>
    <div class="type"><h3 id="type-deferred_deltas">deferred_deltas() = <a href="ordsets.html#type-ordset" class="seealso">ordsets:ordset</a>(<a href="#type-deferred_delta" class="seealso">deferred_delta()</a>)</h3></div>
    <div class="type"><h3 id="type-emcntr">emcntr() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<a href="riak_dt_vclock.html#type-vclock" class="seealso">riak_dt_vclock:vclock()</a>, [<a href="#type-entry" class="seealso">entry()</a>], <a href="#type-deferred_deltas" class="seealso">deferred_deltas()</a>}</h3></div>
    <div class="type"><h3 id="type-emcntr_op">emcntr_op() = <a href="#type-increment_op" class="seealso">increment_op()</a> | <a href="#type-decrement_op" class="seealso">decrement_op()</a></h3></div>
    <div class="type"><h3 id="type-entry">entry() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Actor :: <a href="riak_dt.html#type-actor" class="seealso">riak_dt:actor()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Event :: integer() >= 1,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Inc :: integer() >= 1,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dec :: integer() >= 1}}</h3></div>
    <div class="type"><h3 id="type-increment_op">increment_op() = increment | {increment, integer()}</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="new/0">new() -&gt; emcntr()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="parent_clock/1">parent_clock(Clock::vclock() (see module riak_dt_vclock), X2::emcntr()) -&gt; emcntr()</h3>


<div class="description">

<p>embedded CRDTs most share a causal context with their parent
  Map, setting the internal clock to the parent clock ensures this</p>
</div></div>
<div class="function">
<h3 id="get_deferred/1">get_deferred(CRDT::emcntr()) -&gt; []</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="value/1">value(X1::emcntr()) -&gt; integer()</h3>


<div class="description">

<p>the current integer value of the counter</p>
</div></div>
<div class="function">
<h3 id="value/1-1">value(X1::term(), Cntr::emcntr()) -&gt; integer()</h3>


<div class="description">

<p>query value, not implemented. Just returns result of <code>value/1</code></p>
</div></div>
<div class="function">
<h3 id="update/1">update(Op::emcntr_op(), Dot::dot() (see module riak_dt), X3::emcntr()) -&gt; {ok, emcntr()}</h3>


<div class="description">

<p>increment/decrement the counter. Op is either a two tuple of
  <code>{increment, By}</code>, <code>{decrement, By}</code> where <code>By</code> is a positive
  integer. Or simply the atoms <code>increment</code> or <code>decrement</code>, which are
  equivalent to <code>{increment | decrement, 1}</code> Returns the updated  
counter.</p>
 
  <p>Note: the second argument must be a <code>riak_dt:dot()</code>, that is a
  2-tuple of <code>{Actor :: term(), Event :: pos_integer()}</code> as this is
  for embedding in a <code>riak_dt_map</code></p>
</div></div>
<div class="function">
<h3 id="update/1-1">update(Op::emcntr_op(), Dot::dot() (see module riak_dt), Cntr::emcntr(), Ctx::vclock() (see module riak_dt_vclock)) -&gt; {ok, emcntr()}</h3>


<div class="description">

<p>update with a context. Contexts have no effect. Same as
  <code>update/3</code></p>
</div></div>
<div class="function">
<h3 id="delta_update/4">delta_update(Op, Dot, Cntr, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="delta_update/3">delta_update(Op, Dot, Cntr0) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="merge/1">merge(Cnt::emcntr(), X2::emcntr()) -&gt; emcntr()</h3>


<div class="description">

<p>takes two <code>emcntr()</code>s and merges them into a single
  <code>emcntr()</code>. This is the Least Upper Bound of the Semi-Lattice/CRDT
  literature. The semantics of the <code>emnctr()</code> merge are explained in
  the module docs. In a nutshell, merges version vectors, and keeps
  only dots that are present on both sides, or concurrent.</p>
</div></div>
<div class="function">
<h3 id="equal/1">equal(X1::emcntr(), X2::emcntr()) -&gt; boolean()</h3>


<div class="description">

<p>equality of two counters internal structure, not the <code>value/1</code>
  they produce.</p>
</div></div>
<div class="function">
<h3 id="stats/1">stats(Emcntr::emcntr()) -&gt; [{actor_count, pos_integer()}]</h3>


<div class="description">

<p>generate stats for this counter. Only <code>actor_count</code> is
  produced at present.</p>
</div></div>
<div class="function">
<h3 id="stat/1">stat(X1::atom(), X2::emcntr()) -&gt; pos_integer() | undefined</h3>


<div class="description">

<p>generate stat for requested stat type at first argument. Only
  <code>actor_count</code> is supported at present.  Return a <code>pos_integer()</code> for
  the stat requested, or <code>undefined</code> if stat type is unsupported.</p>
</div></div>
<div class="function">
<h3 id="to_binary/1">to_binary(Cntr::emcntr()) -&gt; binary()</h3>


<div class="description">

<p>produce a compact binary representation of the counter.
 </p>
<p><em>See also:</em> <a href="#from_binary/1" class="seealso">from_binary/1</a>.</p>
</div></div>
<div class="function">
<h3 id="from_binary/1">from_binary(X1::binary()) -&gt; emcntr()</h3>


<div class="description">

<p>Decode a binary encoded riak_dt_emcntr.
 </p>
<p><em>See also:</em> <a href="#to_binary/1" class="seealso">to_binary/1</a>.</p>
</div></div></div>
<div class="section"><h4>See also</h4><p><a href="riak_kv_gcounter.html" class="seealso">riak_kv_gcounter</a></p></div>
<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
