<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>rt (riak_test) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>rt</h1>
<h2 class="modsummary">
  Implements the base riak_test API, providing the ability to control
  nodes in a Riak cluster as well as perform commonly reused operations.</h2>
<div class="description">
<p>
  Implements the base <code>riak_test</code> API, providing the ability to control
  nodes in a Riak cluster as well as perform commonly reused operations.
  Please extend this module with new functions that prove useful between
  multiple independent tests.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-conn_info">conn_info() = [{node(), <a href="#type-interfaces" class="seealso">interfaces()</a>}]</h3></div>
    <div class="type"><h3 id="type-interface">interface() = {http, tuple()} | {pb, tuple()}</h3></div>
    <div class="type"><h3 id="type-interfaces">interfaces() = [<a href="#type-interface" class="seealso">interface()</a>]</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="priv_dir/0">priv_dir() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_deps/0">get_deps() -&gt; list()</h3>


<div class="description">

<p>gets riak deps from the appropriate harness</p>
</div></div>
<div class="function">
<h3 id="str/1">str(String::string(), Substr::string()) -&gt; boolean()</h3>


<div class="description">

<p>if String contains Substr, return true.</p>
</div></div>
<div class="function">
<h3 id="rpc_get_env/2">rpc_get_env(Node, Others) -&gt; term()
</h3>


<div class="description">

<p>Helper that returns first successful application get_env result,
       used when different versions of Riak use different app vars for
       the same setting.</p>
</div></div>
<div class="function">
<h3 id="connection_info/1">connection_info(Node::node() | [node()]) -&gt; interfaces() | conn_info()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="spawn_cmd/1">spawn_cmd(Cmd) -&gt; term()
</h3>


<div class="description">

<p>Spawn <code>Cmd</code> on the machine running the test harness</p>
</div></div>
<div class="function">
<h3 id="spawn_cmd/2">spawn_cmd(Cmd, Opts) -&gt; term()
</h3>


<div class="description">

<p>Spawn <code>Cmd</code> on the machine running the test harness</p>
</div></div>
<div class="function">
<h3 id="wait_for_cmd/1">wait_for_cmd(CmdHandle) -&gt; term()
</h3>


<div class="description">

<p>Wait for a command spawned by <code>spawn_cmd</code>, returning
       the exit status and result</p>
</div></div>
<div class="function">
<h3 id="cmd/1">cmd(Cmd) -&gt; term()
</h3>


<div class="description">

<p>Spawn <code>Cmd</code> on the machine running the test harness, returning
       the exit status and result</p>
</div></div>
<div class="function">
<h3 id="cmd/2">cmd(Cmd, Opts) -&gt; term()
</h3>


<div class="description">

<p>Spawn <code>Cmd</code> on the machine running the test harness, returning
       the exit status and result</p>
</div></div>
<div class="function">
<h3 id="stream_cmd/1">stream_cmd(Cmd::string()) -&gt; {integer(), string()}</h3>


<div class="description">

<p>pretty much the same as os:cmd/1 but it will stream the output to lager.
       If you're running a long running command, it will dump the output
       once per second, as to not create the impression that nothing is happening.</p>
</div></div>
<div class="function">
<h3 id="stream_cmd/1-1">stream_cmd(Cmd::string(), Opts::string()) -&gt; {integer(), string()}</h3>


<div class="description">

<p>same as rt:stream_cmd/1, but with options, like open_port/2</p>
</div></div>
<div class="function">
<h3 id="load_modules_on_nodes/2">load_modules_on_nodes(MoreModules, Nodes) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="is_mixed_cluster/1">is_mixed_cluster(Nodes) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_until/1">wait_until(Fun) -&gt; term()
</h3>


<div class="description">

<p>Utility function used to construct test predicates. Retries the
       function <code>Fun</code> until it returns <code>true</code>, or until the maximum
       number of retries is reached. The retry limit is based on the
       provided <code>rt_max_wait_time</code> and <code>rt_retry_delay</code> parameters in
       specified <code>riak_test</code> config file.</p>
</div></div>
<div class="function">
<h3 id="wait_until/2">wait_until(Node, Fun) -&gt; term()
</h3>


<div class="description">

<p>Convenience wrapper for wait_until for the myriad functions that
  take a node as single argument.</p>
</div></div>
<div class="function">
<h3 id="wait_until/3">wait_until(Fun, Retry, Delay) -&gt; term()
</h3>


<div class="description">

<p>Retry <code>Fun</code> until it returns <code>Retry</code> times, waiting <code>Delay</code>
  milliseconds between retries. This is our eventual consistency bread
  and butter</p>
</div></div>
<div class="function">
<h3 id="wait_until_ready/1">wait_until_ready(Node) -&gt; term()
</h3>


<div class="description">

<p>Wait until the specified node is considered ready by <code>riak_core</code>.
       As of Riak 1.0, a node is ready if it is in the <code>valid</code> or <code>leaving</code>
       states. A ready node is guaranteed to have current preflist/ownership
       information.</p>
</div></div>
<div class="function">
<h3 id="wait_until_status_ready/1">wait_until_status_ready(Node) -&gt; term()
</h3>


<div class="description">

<p>Wait until status can be read from riak_kv_console</p>
</div></div>
<div class="function">
<h3 id="wait_until_no_pending_changes/1">wait_until_no_pending_changes(Nodes::[node()]) -&gt; ok | fail</h3>


<div class="description">

<p>Given a list of nodes, wait until all nodes believe there are no
  on-going or pending ownership transfers.</p>
</div></div>
<div class="function">
<h3 id="wait_until_transfers_complete/1">wait_until_transfers_complete(X1::[node()]) -&gt; ok | fail</h3>


<div class="description">

<p>Waits until no transfers are in-flight or pending, checked by
  riak_core_status:transfers().</p>
</div></div>
<div class="function">
<h3 id="wait_for_service/2">wait_for_service(Node, Services) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_for_cluster_service/2">wait_for_cluster_service(Nodes, Service) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_until_all_members/1">wait_until_all_members(Nodes) -&gt; term()
</h3>


<div class="description">

<p>Wait until all nodes in the list <code>Nodes</code> believe each other to be
       members of the cluster.</p>
</div></div>
<div class="function">
<h3 id="wait_until_all_members/2">wait_until_all_members(Nodes, ExpectedMembers) -&gt; term()
</h3>


<div class="description">

<p>Wait until all nodes in the list <code>Nodes</code> believes all nodes in the
       list <code>Members</code> are members of the cluster.</p>
</div></div>
<div class="function">
<h3 id="wait_until_ring_converged/1">wait_until_ring_converged(Nodes) -&gt; term()
</h3>


<div class="description">

<p>Given a list of nodes, wait until all nodes believe the ring has
       converged (ie. <code>riak_core_ring:is_ready</code> returns <code>true</code>).</p>
</div></div>
<div class="function">
<h3 id="wait_until_legacy_ringready/1">wait_until_legacy_ringready(Node) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_until_connected/1">wait_until_connected(Nodes) -&gt; term()
</h3>


<div class="description">

<p>wait until each node in Nodes is disterl connected to each.</p>
</div></div>
<div class="function">
<h3 id="wait_until_pingable/1">wait_until_pingable(Node) -&gt; term()
</h3>


<div class="description">

<p>Wait until the specified node is pingable</p>
</div></div>
<div class="function">
<h3 id="wait_until_unpingable/1">wait_until_unpingable(Node) -&gt; term()
</h3>


<div class="description">

<p>Wait until the specified node is no longer pingable</p>
</div></div>
<div class="function">
<h3 id="wait_until_registered/2">wait_until_registered(Node, Name) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="capability/2">capability(Node, Capability) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="capability/3">capability(Node, Capability, Default) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_until_capability/3">wait_until_capability(Node, Capability, Value) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_until_capability/4">wait_until_capability(Node, Capability, Value, Default) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_replica/5">get_replica(Node, Bucket, Key, I, N) -&gt; term()
</h3>


<div class="description">

<p>Reads a single replica of a value. This issues a get command directly
 to the vnode handling the Nth primary partition of the object's preflist.</p>
</div></div>
<div class="function">
<h3 id="enable_search_hook/2">enable_search_hook(Node, Bucket) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_version/0">get_version() -&gt; binary()</h3>


<div class="description">

<p>Gets the current version under test. In the case of an upgrade test
       or something like that, it's the version you're upgrading to.</p>
</div></div>
<div class="function">
<h3 id="whats_up/0">whats_up() -&gt; term()
</h3>


<div class="description">

<p>outputs some useful information about nodes that are up</p>
</div></div>
<div class="function">
<h3 id="get_ip/1">get_ip(Node::node()) -&gt; string()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="log_to_nodes/2">log_to_nodes(Nodes, Fmt) -&gt; term()
</h3>


<div class="description">

<p>Log a message to the console of the specified test nodes.
       Messages are prefixed by the string "---riak_test--- "
       Uses lager:info/1 'Fmt' semantics</p>
</div></div>
<div class="function">
<h3 id="log_to_nodes/3">log_to_nodes(Nodes0, LFmt, LArgs) -&gt; term()
</h3>


<div class="description">

<p>Log a message to the console of the specified test nodes.
       Messages are prefixed by the string "---riak_test--- "
       Uses lager:info/2 'LFmt' and 'LArgs' semantics</p>
</div></div>
<div class="function">
<h3 id="get_node_logs/0">get_node_logs() -&gt; term()
</h3>


<div class="description">

<p>Downloads any extant log files from the harness's running
    nodes.</p>
</div></div>
<div class="function">
<h3 id="check_ibrowse/0">check_ibrowse() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="post_result/2">post_result(TestResult, Rt_webhook) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="setup_log_capture/1">setup_log_capture(Nodes) -&gt; term()
</h3>


<div class="description">

<p>Set up in memory log capture to check contents in a test.</p>
</div></div>
<div class="function">
<h3 id="expect_in_log/2">expect_in_log(Node, Pattern) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="wait_for_control/2">wait_for_control(Vsn, Node) -&gt; term()
</h3>


<div class="description">

<p>Wait for Riak Control to start on a single node.</p>
 
  <p>Non-optimal check, because we're blocking for the gen_server to start
  to ensure that the routes have been added by the supervisor.
 </p>
</div></div>
<div class="function">
<h3 id="wait_for_control/1">wait_for_control(VersionedNodes) -&gt; term()
</h3>


<div class="description">

<p>Wait for Riak Control to start on a series of nodes.</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
