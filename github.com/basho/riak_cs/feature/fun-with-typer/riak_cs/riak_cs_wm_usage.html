<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_cs_wm_usage (riak_cs) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_cs_wm_usage</h1>
<h2 class="modsummary">Webmachine resource for serving usage stats.</h2>
<div class="description">
<p>Webmachine resource for serving usage stats.</p>
 
  <p><code>GET /usage/USER_KEY?s=STARTTIME&e=ENDTIME&a=ACCESS&b=STORAGE</code></p>
 
  <p><code>s3cmd get s3://usage/USER_KEY/ab/STARTTIME/ENDTIME</code></p>
 
  <p>Default <code>s</code> is the beginning of the previous period.  If no <code>e</code> is
  given, the return only includes data for the period containing <code>s</code>.</p>
 
  <p>The <code>a</code> and <code>b</code> parameters default to <code>false</code>. Set <code>a</code> to <code>true</code> to
  get access usage stats.  Set <code>b</code> to <code>true</code> to get storage usage  
stats.  Including each in the s3cmd enables that stat, excluding it  
disables it.</p>
 
  <p>The <code>s3cmd</code> variant also supports <code>x</code> and <code>j</code> in the path segment
  with the <code>a</code> and <code>b</code>.  Including <code>x</code> gets the results in XML
  format; <code>j</code> gets them in JSON.  Default is JSON.</p>
 
  <p>This service is only available if a connection to Riak can be made.</p>
 
  <p>This resource only exists if the user named by the key exists.</p>
 
  <p>Authorization is done the same way as all other authorized
  resources: with the <code>Authorization</code> header, hashed with S3 keys,  
etc.</p>
 
  <p>JSON response looks like:
  </p><pre class="sh_erlang">  {"Access":{
             "Nodes":[{"Node":"riak-cs@127.0.0.1",
                       "Samples":[{"StartTime":"20120113T194510Z",
                                   "EndTime":"20120113T194520Z",
                                   "KeyRead":{"Count":1,
                                              "BytesOut":22},
                                   "KeyWrite":{"Count":2,
                                               "BytesIn":44}},
                                  {"StartTime":"20120113T194520Z",
                                   "EndTime":"20120113T194530Z",
                                   "KeyRead":{"Count":3,
                                              "BytesOut":66},
                                   "KeyWrite":{"Count":4,
                                               "BytesIn":88}}
                                 ]}],
             "Errors":[]
            },
   "Storage":"not_requested"}</pre>
 
  <p>XML response looks like:
  </p><pre class="sh_erlang">  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;Usage&gt;
      &lt;Access&gt;
        &lt;Nodes&gt;
          &lt;Node name="riak-cs@127.0.0.1"&gt;
            &lt;Sample StartTime="20120113T194510Z" EndTime="20120113T194520Z"&gt;
              &lt;Operation type="KeyRead"&gt;
                &lt;Count&gt;1&lt;/Count&gt;
                &lt;BytesOut&gt;22&lt;/BytesOut&gt;
              &lt;/Operation&gt;
              &lt;Operation type="KeyWrite"&gt;
                &lt;Count&gt;2&lt;/Count&gt;
                &lt;BytesIn&gt;44&lt;/BytesIn&gt;
              &lt;/Operation&gt;
            &lt;/Sample&gt;
            &lt;Sample StartTime="20120113T194520Z" EndTime="20120113T194530Z"&gt;
              &lt;Operation type="KeyRead"&gt;
                &lt;Count&gt;3&lt;/Count&gt;
                &lt;BytesOut&gt;66&lt;/BytesOut&gt;
              &lt;/Operation&gt;
              &lt;Operation type="KeyWrite"&gt;
                &lt;Count&gt;4&lt;/Count&gt;
                &lt;BytesIn&gt;88&lt;/BytesIn&gt;
              &lt;/Operation&gt;
            &lt;/Sample&gt;
          &lt;/Node&gt;
        &lt;/Nodes&gt;
        &lt;Errors/&gt;
      &lt;/Access&gt;
    &lt;Storage&gt;not_requested&lt;/Storage&gt;
  &lt;/Usage&gt;</pre></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-acl">acl() = #acl_v1{owner = <a href="#type-acl_owner" class="seealso">acl_owner()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grants = [<a href="#type-acl_grant" class="seealso">acl_grant()</a>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;creation_time = <a href="erlang.html#type-timestamp" class="seealso">erlang:timestamp()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| #acl_v2{owner = <a href="#type-acl_owner" class="seealso">acl_owner()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grants = [<a href="#type-acl_grant" class="seealso">acl_grant()</a>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;creation_time = <a href="erlang.html#type-timestamp" class="seealso">erlang:timestamp()</a>}</h3></div>
    <div class="type"><h3 id="type-acl_grant">acl_grant() = {<a href="#type-acl_grantee" class="seealso">acl_grantee()</a>, <a href="#type-acl_perms" class="seealso">acl_perms()</a>}</h3></div>
    <div class="type"><h3 id="type-acl_grantee">acl_grantee() = {string(), string()} | <a href="#type-group_grant" class="seealso">group_grant()</a></h3></div>
    <div class="type"><h3 id="type-acl_owner">acl_owner() = <a href="#type-acl_owner/2" class="seealso">acl_owner2()</a> | <a href="#type-acl_owner/3" class="seealso">acl_owner3()</a></h3></div>
    <div class="type"><h3 id="type-acl_owner2">acl_owner2() = {string(), string()}</h3></div>
    <div class="type"><h3 id="type-acl_owner3">acl_owner3() = {string(), string(), string()}</h3></div>
    <div class="type"><h3 id="type-acl_perm">acl_perm() = 'READ'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 'WRITE'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 'READ_ACP'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 'WRITE_ACP'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 'FULL_CONTROL'</h3></div>
    <div class="type"><h3 id="type-acl_perms">acl_perms() = [<a href="#type-acl_perm" class="seealso">acl_perm()</a>]</h3></div>
    <div class="type"><h3 id="type-cs_bucket">cs_bucket() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#moss_bucket_v1{name = undefined | string() | binary(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last_action = undefined | created | deleted,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;creation_date = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;modification_time = undefined<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a href="erlang.html#type-timestamp" class="seealso">erlang:timestamp()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl = undefined | <a href="#type-acl" class="seealso">acl()</a>}</h3></div>
    <div class="type"><h3 id="type-group_grant">group_grant() = 'AllUsers' | 'AuthUsers'</h3></div>
    <div class="type"><h3 id="type-rcs_user">rcs_user() = #rcs_user_v2{name = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display_name = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_id = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_secret = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;canonical_id = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buckets = [<a href="#type-cs_bucket" class="seealso">cs_bucket()</a>],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status = enabled | disabled}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| #moss_user_v1{name = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display_name = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_id = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_secret = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;canonical_id = undefined | string(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buckets = [<a href="#type-cs_bucket" class="seealso">cs_bucket()</a>]}</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="ping/2">ping(ReqData, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="init/1">init(Config::[any()]) -&gt; {ok, #ctx{auth_bypass=boolean(), riak=undefined | pid(), user=undefined | rcs_user(), start_time=undefined | datetime() (see module calendar), end_time=undefined | datetime() (see module calendar), body=undefined | iodata(), etag=undefined | iolist()}}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="service_available/2">service_available(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="malformed_request/2">malformed_request(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="resource_exists/2">resource_exists(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="content_types_provided/1">content_types_provided(RD::term(), Ctx::term()) -&gt; {[{[any(), ...], produce_json | produce_xml}, ...], term(), term()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="generate_etag/2">generate_etag(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="forbidden/2">forbidden(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="finish_request/2">finish_request(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="produce_json/2">produce_json(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="produce_xml/2">produce_xml(RD, Ctx) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
