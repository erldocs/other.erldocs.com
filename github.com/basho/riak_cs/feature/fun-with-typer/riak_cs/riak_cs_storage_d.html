<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_cs_storage_d (riak_cs) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_cs_storage_d</h1>
<h2 class="modsummary">The daemon that calculates Riak CS storage on the configured
  schedule.</h2>
<div class="description">
<p>The daemon that calculates Riak CS storage on the configured
  schedule.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/0">start_link() -&gt; ignore | {error, term()} | {ok, pid()}</h3>


<div class="description">

<p>Starting the server also verifies the storage schedule.  If
  the schedule contains invalid elements, an error will be printed in
  the logs.</p>
</div></div>
<div class="function">
<h3 id="status/0">status() -&gt; any()</h3>


<div class="description">

<p>Status is returned as a 2-tuple of <code>{State, Details}</code>.  State
  should be <code>idle</code>, <code>calculating</code>, or <code>paused</code>.  When <code>idle</code> the
  details (a proplist) will include the schedule, as well as the
  times of the last calculation and the next planned calculation.
  When <code>calculating</code> or <code>paused</code> details also the scheduled time of
  the active calculation, the number of seconds the process has been
  calculating so far, and counts of how many users have been
  processed and how many are left.</p>
</div></div>
<div class="function">
<h3 id="start_batch/1">start_batch(Options::term()) -&gt; any()</h3>


<div class="description">

<p>Force a calculation and archival manually.  The <code>current</code>
  property returned from a <a href="#status/0" class="seealso">status/0</a> call will show the most  
recently passed schedule time, but calculations will be stored with  
the time at which they happen, as expected.</p>
 
  <p>Allowed options are:
  </p><taglist>
    <dt><code>recalc</code></dt>
    <item><p>Recalculate the storage for each user, even if that user
    already has a calculation stored for this time period. Default is
    <code>false</code>, such that restarting a canceled batch does not require
    redoing the work that happened before cancellation.</p></item>
  </taglist>
</div></div>
<div class="function">
<h3 id="cancel_batch/0">cancel_batch() -&gt; any()</h3>


<div class="description">

<p>Cancel the calculation currently in progress.  Returns <code>ok</code> if
  a batch was canceled, or <code>{error, no_batch}</code> if there was no batch
  in progress.</p>
</div></div>
<div class="function">
<h3 id="pause_batch/0">pause_batch() -&gt; any()</h3>


<div class="description">

<p>Pause the calculation currently in progress.  Returns <code>ok</code> if
  a batch was paused, or <code>{error, no_batch}</code> if there was no batch in
  progress.  Also returns <code>ok</code> if there was a batch in progress that
  was already paused.</p>
</div></div>
<div class="function">
<h3 id="resume_batch/0">resume_batch() -&gt; any()</h3>


<div class="description">

<p>Resume the batch currently in progress.  Returns <code>ok</code> if a
  batch was resumed, or <code>{error, no_batch}</code> if there was no batch in
  progress.  Also returns <code>ok</code> if there was a batch in progress that
  was not paused.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(X1::[]) -&gt; {ok, prepare, #state{batch_count=0, batch_skips=0, batch=[]}, 0}</h3>


<div class="description">

<p>Read the storage schedule and go to idle.</p>
</div></div>
<div class="function">
<h3 id="prepare/2">prepare(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="idle/2">idle(X1, State) -&gt; term()
</h3>


<div class="description">

<p>Transitions out of idle are all synchronous events</p>
</div></div>
<div class="function">
<h3 id="calculating/2">calculating(X1, State) -&gt; term()
</h3>


<div class="description">

<p>Async transitions from calculating are all due to messages the
  FSM sends itself, in order to have opportunities to handle messages
  from the outside world (like <code>status</code>).</p>
</div></div>
<div class="function">
<h3 id="paused/2">paused(X1, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="idle/1">idle(X1::term(), From::term(), State::term()) -&gt; {reply, ok | {error, no_batch} | {ok, {idle, [any(), ...]}}, calculating | idle, term()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="calculating/1">calculating(X1::term(), From::term(), State::term()) -&gt; {reply, ok | {error, already_calculating} | {ok, {calculating, [any(), ...]}}, calculating | idle | paused, term()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="paused/1">paused(X1::term(), From::term(), State::term()) -&gt; {reply, ok | {error, already_calculating} | {ok, {calculating, [any(), ...]} | {paused, [any(), ...]}}, calculating | idle | paused, term()}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_event/3">handle_event(Event, StateName, State) -&gt; term()
</h3>


<div class="description">

<p>there are no all-state events for this fsm</p>
</div></div>
<div class="function">
<h3 id="handle_sync_event/4">handle_sync_event(Event, From, StateName, State) -&gt; term()
</h3>


<div class="description">

<p>there are no all-state events for this fsm</p>
</div></div>
<div class="function">
<h3 id="handle_info/3">handle_info(Info, InBatch, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="terminate/1">terminate(Reason::term(), StateName::term(), State::term()) -&gt; ok</h3>


<div class="description">

<p>TODO: log warnings if this fsm is asked to terminate in the
  middle of running a calculation</p>
</div></div>
<div class="function">
<h3 id="code_change/4">code_change(OldVsn, StateName, State, Extra) -&gt; term()
</h3>


<div class="description">

<p>this fsm has no special upgrade process</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
