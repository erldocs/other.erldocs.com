<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>krc_server (krc) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>krc_server</h1>
<h2 class="modsummary">K Riak Client.</h2>
<div class="description">
<p>K Riak Client.   
The K Riak Client adds a higher-level API and a connection pool to the   
official Riak protobuf client. KRC does not pretend to be a generic client   
library but rather the simplest thing which works for us - our setup is   
described below.</p>
  
   <p>We have a cluster of N machines. Each machine hosts two BEAM emulators, one   
runs our application server and the other runs a Riak server. The Riak   
servers form a Riak cluster.   
Load-balancers distribute incoming requests amongst those application   
servers which are currently up.</p>
  
   <p>Each application server runs one instance of the gen_server defined in this   
file (globally registered name). The KRC gen_server maintains a number of   
TCP/IP connections to the Riak node co-located on its machine (localhost).</p>
  
   <p>The message flow is depicted below.</p>
  
  
   <p>application    ------------------------------------                  
\        |   
krc_server     ---------+--------------------------                    
\      |   
connection     ------------------------------------                      
\   /   
riak_pb_socket ------------------------------------                        
\/   
riak server    ------------------------------------</p>
  
  
   <p>The application makes a request to the krc_server, which the krc_server   
forwards to one of its connection processes.   
Requests are buffered in the connection processes' message queues.   
Each connection talks to a riak_pb_socket process, which talks to the Riak   
server over TCP/IP.</p>
  
   The failure modes are handled as follows:
     - If an application process crashes, we drop any queued requests so as
       not to send buffered write requests to the Riak server.
     - If krc_server cannot reach its local Riak node, it crashes and the
       application server goes down (this is mainly to avoid having to
       maintain knowledge of the state of the Riak cluster locally, and may be
       changed in a future release).
     - The connection and riak_pb_socket processes are linked, so if either
       dies, the other will be killed as well and all requests in the
       connection's message queue will time out.
  </div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="delete/3">delete(GS, B, K) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get/3">get(GS, B, K) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_index/4">get_index(GS, B, I, K) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="put/2">put(GS, O) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="start/1">start(A) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="start/2">start(Name, A) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="start_link/1">start_link(A) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="start_link/2">start_link(Name, A) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="stop/1">stop(GS) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="init/1">init(Args) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="terminate/2">terminate(X1, S) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="code_change/3">code_change(X1, S, X3) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_call/3">handle_call(Req, From, S) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_cast/2">handle_cast(Msg, S) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_info/2">handle_info(Msg, S) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="connection/2">connection(Client, Pid) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
