<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>meck (meck) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>meck</h1>
<h2 class="modsummary">Module mocking library for Erlang.</h2>
<div class="description">
<p>Module mocking library for Erlang.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-args_spec">args_spec() = [any() | '_']</h3></div>
    <div class="type"><h3 id="type-func_clause_spec">func_clause_spec() = {<a href="#type-args_spec" class="seealso">args_spec()</a>, <a href="#type-ret_spec" class="seealso">ret_spec()</a>}</h3></div>
    <div class="type"><h3 id="type-history">history() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[{CallerPid :: pid(), <a href="#type-meck_mfa" class="seealso">meck_mfa()</a>, Result :: any()} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{CallerPid :: pid(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#type-meck_mfa" class="seealso">meck_mfa()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Class :: throw | error | exit,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reason :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#type-stack_trace" class="seealso">stack_trace()</a>}]</h3></div>
    <div class="type"><h3 id="type-meck_mfa">meck_mfa() = {Mod :: atom(), Func :: atom(), Args :: [any()]}</h3></div>
    <div class="type"><h3 id="type-ret_spec">ret_spec()</h3></div>
    <div class="type"><h3 id="type-stack_trace">stack_trace() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[{Mod :: atom(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func :: atom(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AriOrArgs :: byte() | [any()]} |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Mod :: atom(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func :: atom(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AriOrArgs :: byte() | [any()],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Location :: [{atom(), any()}]}]</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="new/1">new(Mods) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#new/2" class="seealso">new(Mod, [])</a>.</p>
</div></div>
<div class="function">
<h3 id="new/2">new(Mods, Options) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li><li><code>Options = [property() (see module proplists)]</code></li></ul>
<div class="description">

<p>Creates new mocked module(s).</p>
 
  <p>This replaces the current version (if any) of the modules in <code>Mod</code>  
with an empty module.</p>
 
  <p>Since this library is intended to use from test code, this  
function links a process for each mock to the calling process.</p>
 
  <p>The valid options are:
  </p><taglist>
    <dt><code>passthrough</code></dt>
    <item><p>Retains the original functions, if not mocked by meck. If used along
        with <code>stub_all</code> then <code>stub_all</code> is ignored.</p></item>
 
    <dt><code>no_link</code></dt>
    <item><p>Does not link the meck process to the caller process (needed for using
        meck in rpc calls).</p></item>
 
    <dt><code>unstick</code></dt>
    <item><p>Unstick the module to be mocked (e.g. needed for using meck with
        kernel and stdlib modules).</p></item>
 
    <dt><code>no_passthrough_cover</code></dt>
    <item><p>If cover is enabled on the module to be mocked then meck will continue
        to capture coverage on passthrough calls. This option allows you to
        disable that feature if it causes problems.</p></item>
 
    <dt><code>{spawn_opt, list()}</code></dt>
    <item><p>Specify Erlang process spawn options. Typically used to specify
        non-default, garbage collection options.</p></item>
 
    <dt><code>no_history</code></dt>
    <item><p>Do not store history of meck calls.</p></item>
 
    <dt><code>non_strict</code></dt>
    <item><p>A mock created with this option will allow setting expectations on
        functions that are not exported from the mocked module. With this
        option on it is even possible to mock non existing modules.</p></item>
 
    <dt><code>{stub_all,</code><a href="#type-ret_spec" class="seealso">ret_spec()</a><code>}</code></dt>
    <item><p>Stubs all functions exported from the mocked module. The stubs will
        return whatever defined by <a href="#type-ret_spec" class="seealso">ret_spec()</a> regardless of arguments
        passed in. It is possible to specify this option as just <code>stub_all</code>
        then stubs will return atom <code>ok</code>. If used along with <code>passthrough</code>
        then <code>stub_all</code> is ignored. </p></item>
  </taglist>
</div></div>
<div class="function">
<h3 id="expect/3">expect(Mods, Func, Expectation) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li><li><code>Func = atom()</code></li><li><code>Expectation = function() | [func_clause_spec()]</code></li></ul>
<div class="description">

<p>Add expectation for a function <code>Func</code> to the mocked modules <code>Mod</code>.</p>
 
  <p>An expectation is either of the following:
  </p><taglist>
  <dt><code>function()</code></dt><item><p>a stub function that is executed whenever the
  function <code>Func</code> is called. The arity of <code>function()</code> identifies for which
  particular <code>Func</code> variant an expectation is created for (that is, a function
  with arity 2 will generate an expectation for <code>Func/2</code>).</p></item>
  <dt><code>[</code><a href="#type-func_clause_spec" class="seealso">func_clause_spec()</a><code>]</code></dt><item><p>a list of <a href="#type-arg_spec" class="seealso">arg_spec()</a>/<a href="#type-ret_spec" class="seealso">ret_spec()</a> pairs. Whenever the function <code>Func</code> is called
  the arguments are matched against the <a href="#type-arg_spec" class="seealso">arg_spec()</a> in the list. As
  soon as the first match is found then a value defined by the corresponding
  <a href="#type-ret_spec" class="seealso">ret_spec()</a> is returned.</p></item>
  </taglist>
 
  <p>It affects the validation status of the mocked module(s). If an
  expectation is called with the wrong number of arguments or invalid
  arguments the mock module(s) is invalidated. It is also invalidated if
  an unexpected exception occurs.</p>
</div></div>
<div class="function">
<h3 id="expect/4">expect(Mods, Func, AriOrArgs, RetSpec) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li><li><code>Func = atom()</code></li><li><code>AriOrArgs = byte() | args_spec()</code></li><li><code>RetSpec = ret_spec()</code></li></ul>
<div class="description">

<p>Adds an expectation with the supplied arity and return value.</p>
 
  <p>This creates an expectation which takes <code>Arity</code> number of functions
  and always returns <code>Result</code>.
 </p>
<p><em>See also:</em> <a href="#expect/3" class="seealso">expect/3</a>.</p>
</div></div>
<div class="function">
<h3 id="sequence/4">sequence(Mods, Func, Ari, Sequence) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li><li><code>Func = atom()</code></li><li><code>Ari = byte()</code></li><li><code>Sequence = [any()]</code></li></ul>
<div class="description">
<p><em>This function is deprecated: </em>Please use <a href="#expect/3" class="seealso">expect/3</a> or <a href="#expect/4" class="seealso">expect/4</a> along with
  <a href="#type-ret_spec" class="seealso">ret_spec()</a> generated by <a href="#seq/1" class="seealso">seq/1</a>.</p>
<p>Equivalent to <a href="#expect/4" class="seealso">expect(Mod, Func, Ari, seq(Sequence))</a>.</p>
</div></div>
<div class="function">
<h3 id="loop/4">loop(Mods, Func, Ari, Loop) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li><li><code>Func = atom()</code></li><li><code>Ari = byte()</code></li><li><code>Loop = [any()]</code></li></ul>
<div class="description">
<p><em>This function is deprecated: </em>Please use <a href="#expect/3" class="seealso">expect/3</a> or <a href="#expect/4" class="seealso">expect/4</a> along with
  <a href="#type-ret_spec" class="seealso">ret_spec()</a> generated by <a href="#loop/1" class="seealso">loop/1</a>.</p>
<p>Equivalent to <a href="#expect/4" class="seealso">expect(Mod, Func, Ari, loop(Loop))</a>.</p>
</div></div>
<div class="function">
<h3 id="delete/3">delete(Mods, Func, Ari) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li><li><code>Func = atom()</code></li><li><code>Ari = byte()</code></li></ul>
<div class="description">

<p>Deletes an expectation.</p>
 
  <p>Deletes the expectation for the function <code>Func</code> with the matching
  arity <code>Arity</code>.</p>
</div></div>
<div class="function">
<h3 id="exception/2">exception(Class, Reason) -&gt; no_return()</h3>

<ul class="type">
<li><code>Class = throw | error | exit</code></li><li><code>Reason = any()</code></li></ul>
<div class="description">

<p>Throws an expected exception inside an expect fun.</p>
 
  <p>This exception will get thrown without invalidating the mocked  
module. That is, the code using the mocked module is expected to  
handle this exception.</p>
 
  <p><em>Note: this code should only be used inside an expect fun.</em></p>
</div></div>
<div class="function">
<h3 id="passthrough/1">passthrough(Args) -&gt; Result</h3>

<ul class="type">
<li><code>Args = [any()]</code></li><li><code>Result = any()</code></li></ul>
<div class="description">

<p>Calls the original function (if existing) inside an expectation fun.</p>
 
  <p><em>Note: this code should only be used inside an expect fun.</em></p>
</div></div>
<div class="function">
<h3 id="validate/1">validate(Mods) -&gt; boolean()</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li></ul>
<div class="description">

<p>Validate the state of the mock module(s).</p>
 
  <p>The function returns <code>true</code> if the mocked module(s) has been used
  according to its expectations. It returns <code>false</code> if a call has  
failed in some way. Reasons for failure are wrong number of  
arguments or non-existing function (undef), wrong arguments  
(function clause) or unexpected exceptions.</p>
 
  <p>Use the <a href="#history/1" class="seealso">history/1</a> or <a href="#history/2" class="seealso">history/2</a> function to analyze errors.</p>
</div></div>
<div class="function">
<h3 id="history/1">history(Mod) -&gt; history()</h3>

<ul class="type">
<li><code>Mod = atom()</code></li></ul>
<div class="description">

<p>Return the call history of the mocked module for all processes.
 </p>
</div></div>
<div class="function">
<h3 id="history/2">history(Mod, OptCallerPid) -&gt; history()</h3>

<ul class="type">
<li><code>Mod = atom()</code></li><li><code>OptCallerPid = '_' | pid()</code></li></ul>
<div class="description">

<p>Return the call history of the mocked module for the specified process.</p>
 
  <p>Returns a list of calls to the mocked module and their results for
  the specified <code>Pid</code>.  Results can be either normal Erlang terms or
  exceptions that occurred.
 </p>
<p><em>See also:</em> <a href="#called/3" class="seealso">called/3</a>, <a href="#called/4" class="seealso">called/4</a>, <a href="#history/1" class="seealso">history/1</a>, <a href="#num_calls/3" class="seealso">num_calls/3</a>, <a href="#num_calls/4" class="seealso">num_calls/4</a>.</p>
</div></div>
<div class="function">
<h3 id="unload/0">unload() -&gt; Unloaded</h3>

<ul class="type">
<li><code>Unloaded = [Mod]</code></li><li><code>Mod = atom()</code></li></ul>
<div class="description">

<p>Unloads all mocked modules from memory.</p>
 
  <p>The function returns the list of mocked modules that were unloaded
  in the process.</p>
</div></div>
<div class="function">
<h3 id="unload/1">unload(Mods) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li></ul>
<div class="description">

<p>Unload a mocked module or a list of mocked modules.</p>
 
  <p>This will purge and delete the module(s) from the Erlang virtual
  machine. If the mocked module(s) replaced an existing module, this
  module will still be in the Erlang load path and can be loaded
  manually or when called.</p>
</div></div>
<div class="function">
<h3 id="called/3">called(OptMod, OptFun, OptArgs) -&gt; boolean()</h3>

<ul class="type">
<li><code>OptMod = '_' | atom()</code></li><li><code>OptFun = '_' | atom()</code></li><li><code>OptArgs = '_' | args_spec()</code></li></ul>
<div class="description">

<p>Returns whether <code>Mod:Func</code> has been called with <code>Args</code>.
 </p>
</div></div>
<div class="function">
<h3 id="called/4">called(OptMod, OptFun, OptArgs, OptCallerPid) -&gt; boolean()</h3>

<ul class="type">
<li><code>OptMod = '_' | atom()</code></li><li><code>OptFun = '_' | atom()</code></li><li><code>OptArgs = '_' | args_spec()</code></li><li><code>OptCallerPid = '_' | pid()</code></li></ul>
<div class="description">

<p>Returns whether <code>Pid</code> has called <code>Mod:Func</code> with <code>Args</code>.</p>
 
  <p>This will check the history for the module, <code>Mod</code>, to determine
  whether process <code>Pid</code> call the function, <code>Fun</code>, with arguments, <code>Args</code>. If  
so, this function returns true, otherwise false.</p>
 
  <p>Wildcards can be used, at any level in any term, by using the underscore
  atom: <code>'_'</code>
 </p>
<p><em>See also:</em> <a href="#called/3" class="seealso">called/3</a>.</p>
</div></div>
<div class="function">
<h3 id="num_calls/3">num_calls(OptMod, OptFun, OptArgs) -&gt; non_neg_integer()</h3>

<ul class="type">
<li><code>OptMod = '_' | atom()</code></li><li><code>OptFun = '_' | atom()</code></li><li><code>OptArgs = '_' | args_spec()</code></li></ul>
<div class="description">

<p>Returns the number of times <code>Mod:Func</code> has been called with <code>Args</code>.
 </p>
</div></div>
<div class="function">
<h3 id="num_calls/4">num_calls(OptMod, OptFun, OptArgs, OptCallerPid) -&gt; non_neg_integer()</h3>

<ul class="type">
<li><code>OptMod = '_' | atom()</code></li><li><code>OptFun = '_' | atom()</code></li><li><code>OptArgs = '_' | args_spec()</code></li><li><code>OptCallerPid = '_' | pid()</code></li></ul>
<div class="description">

<p>Returns the number of times process <code>Pid</code> has called <code>Mod:Func</code>
       with <code>Args</code>.</p>
 
  <p>This will check the history for the module, <code>Mod</code>, to determine how
  many times process <code>Pid</code> has called the function, <code>Fun</code>, with
  arguments, <code>Args</code> and returns the result.
 </p>
<p><em>See also:</em> <a href="#num_calls/3" class="seealso">num_calls/3</a>.</p>
</div></div>
<div class="function">
<h3 id="reset/1">reset(Mods) -&gt; ok</h3>

<ul class="type">
<li><code>Mods = Mod | [Mod]</code></li><li><code>Mod = atom()</code></li></ul>
<div class="description">

<p>Erases the call history for a mocked module or a list of mocked modules.</p>
 
  <p>This function will erase all calls made heretofore from the history of the
  specified modules. It is intended to prevent cluttering of test results with
  calls to mocked modules made during the test setup phase.</p>
</div></div>
<div class="function">
<h3 id="loop/1">loop(Loop) -&gt; ret_spec()</h3>

<ul class="type">
<li><code>Loop = [ret_spec()]</code></li></ul>
<div class="description">

<p>Converts a list of terms into <a href="#type-ret_spec" class="seealso">ret_spec()</a> defining a loop of
  values. It is intended to be in construction of clause specs for the
  <a href="#expect/3" class="seealso">expect/3</a> function.</p>
 
  <p>Calls to an expect, created with <a href="#type-ret_spec" class="seealso">ret_spec()</a> returned by this function,
  will return one element at a time from the <code>Loop</code> list and will restart at
  the first element when the end is reached.</p>
</div></div>
<div class="function">
<h3 id="seq/1">seq(Sequence) -&gt; ret_spec()</h3>

<ul class="type">
<li><code>Sequence = [ret_spec()]</code></li></ul>
<div class="description">

<p>Converts a list of terms into <a href="#type-ret_spec" class="seealso">ret_spec()</a> defining a sequence of
  values. It is intended to be in construction of clause specs for the
  <a href="#expect/3" class="seealso">expect/3</a> function.</p>
 
  <p>Calls to an expect, created with <a href="ret_spec.html" class="seealso">ret_spec</a> returned by this function,
  will exhaust the <code>Sequence</code> list of return values in order until the last
  value is reached. That value is then returned for all subsequent calls.</p>
</div></div>
<div class="function">
<h3 id="val/1">val(Value) -&gt; ret_spec()</h3>

<ul class="type">
<li><code>Value = any()</code></li></ul>
<div class="description">

<p>Converts a term into <a href="#type-ret_spec" class="seealso">ret_spec()</a> defining an individual value.
  It is intended to be in construction of clause specs for the
  <a href="#expect/3" class="seealso">expect/3</a> function.</p>
</div></div>
<div class="function">
<h3 id="raise/2">raise(Class, Reason) -&gt; ret_spec()</h3>

<ul class="type">
<li><code>Class = throw | error | exit</code></li><li><code>Reason = term</code></li></ul>
<div class="description">

<p>Creates a <a href="#type-ret_spec" class="seealso">ret_spec()</a> that defines an exception.</p>
 
  <p>Calls to an expect, created with <a href="#type-ret_spec" class="seealso">ret_spec()</a> returned by this function,
  will raise the specified exception.</p>
</div></div>
<div class="function">
<h3 id="passthrough/0">passthrough() -&gt; ret_spec()</h3>


<div class="description">

<p>Creates a <a href="#type-ret_spec" class="seealso">ret_spec()</a> that makes the original module function be  
called.</p>
 
  <p>Calls to an expect, created with <a href="#type-ret_spec" class="seealso">ret_spec()</a> returned by this function,
  will be forwarded to the original function.</p>
</div></div>
<div class="function">
<h3 id="exec/1">exec(Fun::function()) -&gt; ret_spec()</h3>


<div class="description">

<p>Creates a <a href="#type-ret_spec" class="seealso">ret_spec()</a> from a function. Calls to an expect,
  created with <a href="#type-ret_spec" class="seealso">ret_spec()</a> returned by this function, will be forwarded
  to the specified function.</p>
</div></div></div>

<authors>

<aname>Adam Lindberg</aname>
<email>eproxus@gmail.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
