<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>switchboard (switchboard) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>switchboard</h1>
<h2 class="modsummary">This module provides the main interface to Switchboard.</h2>
<div class="description">
<p>This module provides the main interface to Switchboard.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-keytype">keytype() = account<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| active<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| idlers<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {idler | operator | idler_sup, <a href="imap.html#type-mailbox" class="seealso">imap:mailbox()</a>}</h3></div>
    <div class="type"><h3 id="type-pubsub_channel">pubsub_channel() = new</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start/0">start() -&gt; term()
</h3>


<div class="description">

<p>Start the Switchboard application.</p>
</div></div>
<div class="function">
<h3 id="add/1">add(ConnSpec::connspec() (see module imap), Auth::auth() (see module imap)) -&gt; startchild_ret() (see module supervisor)</h3>


<div class="description">
<p>Equivalent to <a href="#add/3" class="seealso">add(ConnSpec, Auth, [])</a>.</p>
</div></div>
<div class="function">
<h3 id="add/1-1">add(ConnSpec::connspec() (see module imap), Auth::auth() (see module imap), Mailboxes::[mailbox() (see module imap)]) -&gt; startchild_ret() (see module supervisor)</h3>


<div class="description">

<p>Add the specified account to be monitored by the switchboard application.
  Each mailbox provided will be monitored for new emails, and notifications
  of new email arrivals will be published to the <code>new</code> channel.</p>
 
  <p>Note: This will start an <code>active</code> IMAP connection which can be used for queries,
  as well as one <code>idler</code> IMAP connection per mailbox given. Some email providers
  <a href="../https///support.google.html#com/mail/answer/97150?hl=en" class="seealso">limit</a> the number  
of open imap connections.</p>
 
  <p>Once started, the IMAP client processes can be accessed using <code>where</code>.</p>
</div></div>
<div class="function">
<h3 id="stop/1">stop(Account::binary()) -&gt; ok | {error, not_found | simple_one_for_one}</h3>


<div class="description">

<p>Stop the account from being monitored. Unlike add, this only
  requires the account name, e.g. <code>dispatchonme@gmail.com</code></p>
</div></div>
<div class="function">
<h3 id="add_mailbox_monitor/1">add_mailbox_monitor(Account::account() (see module imap), Mailbox::mailbox() (see module imap)) -&gt; startchild_ret() (see module supervisor)</h3>


<div class="description">

<p>Add a mailbox to be monitored for the provided account.</p>
</div></div>
<div class="function">
<h3 id="stop_mailbox_monitor/1">stop_mailbox_monitor(Account::account() (see module imap), Mailbox::mailbox() (see module imap)) -&gt; ok | {error, not_found | simple_one_for_one}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="key_for/2">key_for(Account, Type) -&gt; {n, l, {switchboard, {Type, Account}}}</h3>

<ul class="type">
<li><code>Account = account() (see module imap)</code></li><li><code>Type = keytype()</code></li></ul>
<div class="description">

<p>Returns the key for the given account and process type.</p>
 
  <p>Switchboard processes are registered using descriptive erlang terms via
  <a href="../https///github.com/uwiger/gproc.html" class="seealso">gproc</a>. This function  
wraps the term with gproc properties and a switchboard namespace.</p>
 
  <taglist>
    <dt><code>active</code></dt>
      <item><p>The active IMAP client. While used internally by Switchboard,
          this can also be used externally to make requests.
      </p></item>
    <dt><code>{idler, Mailbox}</code></dt>
      <item><p>The IMAP client monitoring <code>Mailbox</code> via the <code>idle</code> command.
      </p></item>
    <dt>... others</dt>
      <item><p>Other processes are intended to be opaque.
      </p></item>
  </taglist>
</div></div>
<div class="function">
<h3 id="register_callback/1">register_callback(Account::account() (see module imap), Type::keytype()) -&gt; (State) -&gt; State</h3>

<ul class="type">
<li><code>State = any()</code></li></ul>
<div class="description">

<p>An IMAP InitCallback function used to register the process its called upon  
with gproc.</p>
 
  <p>This is useful since processes can only be registered with gproc from within
  themselves. It is currently used as an imap <code>post_init_callback</code>.</p>
</div></div>
<div class="function">
<h3 id="where/2">where(Account, Type) -&gt; term()
</h3>


<div class="description">

<p>Returns the process of type for the provided account.</p>
 
  <p>For example, <code>where(&lt;&lt;"dispatchonme@gmail.com"&gt;&gt;, active)</code> would return
  the <code>active</code> IMAP client for <code>dispatchonme@gmail.com</code>.
 </p>
<p><em>See also:</em> <a href="#key_for/2" class="seealso">key_for/2</a>.</p>
</div></div>
<div class="function">
<h3 id="await/1">await(Account::account() (see module imap), Type::keytype()) -&gt; pid()</h3>


<div class="description">
<p>Equivalent to <a href="#await/3" class="seealso">await(Account, Type, 5000)</a>.</p>
</div></div>
<div class="function">
<h3 id="await/1-1">await(Account::account() (see module imap), Type::keytype(), Timeout::non_neg_integer()) -&gt; pid()</h3>


<div class="description">

<p>Wraps gproc's await command for Switchboard. This plays an
  important role since the IMAP connections move from supervisor init
  -&gt; startup cmds -&gt; registering via gproc. Awaiting registration
  will provide a ready to go process.</p>
</div></div>
<div class="function">
<h3 id="checkout/1">checkout(Account) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="return/2">return(Account, IMAP) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="with_imap/2">with_imap(Account, Fun) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="subscribe/1">subscribe(X1::pubsub_channel()) -&gt; true</h3>


<div class="description">

<p>Subscribe to Switchboard messages using the provided channel.</p>
 
  <p>Channels:
  </p><taglist>
    <dt><code>new</code></dt>
      <item><p>This channel provides email arrival notifications. The messages should
          take the form of <code>{new, {Account, Mailbox}, Item}</code> where Item is
          the result of a cleaned ALL fetch (@see imap:call).
      </p></item>
  </taglist>
</div></div>
<div class="function">
<h3 id="unsubscribe/1">unsubscribe(X1::pubsub_channel()) -&gt; true</h3>


<div class="description">

<p>Unsubscribe from the provided Switchboard channel.</p>
<p><em>See also:</em> <a href="subscribe.html" class="seealso">subscribe</a>.</p>
</div></div>
<div class="function">
<h3 id="publish/1">publish(X1::pubsub_channel(), Msg) -&gt; Msg</h3>

<ul class="type">
<li><code>Msg = any()</code></li></ul>
<div class="description">

<p>Publish a message to the Switchboard channel.</p>
<p><em>See also:</em> <a href="subscribe.html" class="seealso">subscribe</a>.</p>
</div></div>
<div class="function">
<h3 id="accounts/0">accounts() -&gt; [binary()]</h3>


<div class="description">

<p>Returns the list of accounts currently being managed by Switchboard.</p>
</div></div>
<div class="function">
<h3 id="mailbox_monitors/1">mailbox_monitors(Account::account() (see module imap)) -&gt; [binary()]</h3>


<div class="description">

<p>Returns the list of mailboxes which are being monitored for the
  provided Account.</p>
</div></div></div>

<authors>

<aname>Thomas Moulia</aname>
<email>jtmoulia@pocketknife.io</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
