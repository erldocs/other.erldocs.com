<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>riak_kv_mrc_pipe (riak_kv) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_kv_mrc_pipe</h1>
<h2 class="modsummary">Riak KV MapReduce / Riak Pipe Compatibility.</h2>
<div class="description">
<p>Riak KV MapReduce / Riak Pipe Compatibility</p>
 
  <p>== About using <code>{modfun, Mod, Fun, Arg}</code> generator to a MapReduce job</p>
 
  <p>An uncommonly-used option for Riak KV MapReduce is the option to  
use a fourth method of specifying inputs to the beginning of the  
MapReduce workflow.  All four methods are:</p>
 
  <list>
  <item> Specify a bucket name (to emit all bucket/key pairs for that
   bucket) </item>
  <item> Specify a bucket name and keyfilter spec, <code>{Bucket, KeyFilter}</code> </item>
  <item> Specify an explicit list of bucket/key pairs </item>
  <item> Specify <code>{modfun, Mod, Fun, Arg}</code> to generate the raw input data
  for the rest of the workflow </item>
  </list>
 
  <p>For the fourth method, "raw input data" means that the output of the  
function will be used as-is by the next item MapReduce workflow.  
If that next item is a map phase, then that item's input is  
expected to be a bucket/key pair.  If the next item is a reduce  
phase, then the input can be an arbitrary term.</p>
 
  <p>The type specification for a <code>{modfun, Mod, Fun, Arg}</code> generator
  function is:
  </p><pre class="sh_erlang">  -spec generator_func(Pipe::riak_pipe:pipe(), Arg::term(), Timeout::integer() | 'infinity').</pre>
 
  <p>This generator function is responsible for using
  <code>riak_pipe:queue_work()</code> to send any data to the pipe, and it is
  responsible for calling <code>riak_pipe:eoi()</code> to signal the end of  
input.</p>
 
  <p><em><marker id="About_reduce_phase_compatibility">About reduce phase compatibility</marker></em></p>
 
  <p>An Erlang reduce phase is defined by the tuple:
  <code>{reduce, Fun::function(2), Arg::term(), Keep::boolean()}</code>.</p>
 
  <list>
  <item><p> <code>Fun</code> takes the form of <code>Fun(InputList, Arg)</code> where <code>Arg</code> is
  the argument specified in the definition 4-tuple above.
  NOTE: Unlike a fold function (e.g., <code>lists:foldl/3</code>), the <code>Arg</code> argument
        is constant for each iteration of the reduce function. </p></item>
  <item><p> The <code>Arg</code> may be any term, as the caller sees fit.  However, if
       the caller wishes to have more control over the reduce phase,
       then <code>Arg</code> must be a property list.  The control knobs that may
       be specified are:
       </p><list>
       <item><p> <code>reduce_phase_only_1</code> will buffer all inputs to the reduce
            phase fitting and only call the reduce function once.
            NOTE: Use with caution to avoid excessive memory use. </p></item>
       <item><p> <code>{reduce_phase_batch_size, Max::integer()}</code> will buffer all
            inputs to the reduce phase fitting and call the reduce function
            after <code>Max</code> items have been buffered. </p></item>
       </list><p>
  If neither <code>reduce_phase_only_1</code> nor <code>{reduce_phase_batch_size, Max}</code>
  are present, then the batching size will default to the value of the
  application environment variable
  <code>mapred_reduce_phase_batch_size</code> in the <code>riak_kv</code> application.</p>
 
  <p>NOTE: This mixing of user argument data and MapReduce implementation
        metadata is suboptimal, but to do separate the two types of
        data would require a change that is incompatible with the current
        Erlang MapReduce input specification, e.g., a 5-tuple such as
        <code>{reduce, Fun, Arg, Keep, MetaData}</code> or else a custom wrapper
        around the 3rd arg,
        e.g. <code>{reduce, Fun, {magic_tag, Arg, Metadata}, Keep}</code>.
  </p></item>
  <item><p> If <code>Keep</code> is <code>true</code>, then the output of this phase will be returned
       to the caller (i.e. the output will be "kept"). </p></item>
  </list></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="mapred/2">mapred(Inputs, Query) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="mapred/3">mapred(Inputs, Query, Timeout) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="mapred_stream/1">mapred_stream(Query) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="mapred_plan/1">mapred_plan(Query) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="mapred_plan/2">mapred_plan(BucketOrList, Query) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="send_inputs_async/2">send_inputs_async(Pipe, Arg) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="send_inputs_async/3">send_inputs_async(Pipe, Arg, Timeout) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="send_inputs/2">send_inputs(Pipe, Arg) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="send_inputs/3">send_inputs(Pipe, BucketKeyList, Timeout) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="collect_outputs/2">collect_outputs(Pipe, NumKeeps) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="collect_outputs/3">collect_outputs(Pipe, NumKeeps, Timeout) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="group_outputs/2">group_outputs(Outputs, NumKeeps) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="compile_string/1">compile_string(Binary) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="example/0">example() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="example_bucket/0">example_bucket() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="example_reduce/0">example_reduce() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="example_setup/0">example_setup() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="example_setup/1">example_setup(Num) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
