<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>db_dht (scalaris) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>db_dht</h1>
<h2 class="modsummary">   DB back-end for DHTs storing db_entry:entry() objects.</h2>
<div class="description">
<p>   DB back-end for DHTs storing db_entry:entry() objects.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-client_version">client_version() = integer() &gt;= 0</h3></div>
    <div class="type"><h3 id="type-db">db() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{KeyValueDB :: term(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subscribers :: <a href="db_ets.html#type-db" class="seealso">db_ets:db()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SnaphotInfo ::<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{term() | false,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LiveLockCount :: integer() >= 0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SnapLockCount :: integer() >= 0}}</h3></div>
    <div class="type"><h3 id="type-db_as_list">db_as_list() = [<a href="db_entry.html#type-entry" class="seealso">db_entry:entry()</a>]</h3></div>
    <div class="type"><h3 id="type-value">value() = <a href="rdht_tx.html#type-encoded_value" class="seealso">rdht_tx:encoded_value()</a></h3></div>
    <div class="type"><h3 id="type-version">version() = <a href="#type-client_version" class="seealso">client_version()</a></h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="new/1">new(DBName::nonempty_string() | atom()) -&gt; db()</h3>


<div class="description">

<p>Initializes a new database.</p>
</div></div>
<div class="function">
<h3 id="close/1">close(State::db()) -&gt; true</h3>


<div class="description">

<p>Closes the given DB (it may be recoverable using open/1 depending on
       the DB back-end).</p>
</div></div>
<div class="function">
<h3 id="close_and_delete/1">close_and_delete(State::db()) -&gt; true</h3>


<div class="description">

<p>Closes the given DB and deletes all contents (this DB can thus not be
       re-opened using open/1).</p>
</div></div>
<div class="function">
<h3 id="get_load/1">get_load(DB::db()) -&gt; Load::integer()</h3>


<div class="description">

<p>Returns the number of stored keys.</p>
</div></div>
<div class="function">
<h3 id="get_load/1-1">get_load(DB::db(), Interval::interval() (see module intervals)) -&gt; Load::integer()</h3>


<div class="description">

<p>Returns the number of stored keys in the given interval.</p>
</div></div>
<div class="function">
<h3 id="get_data/1">get_data(DB::db()) -&gt; db_as_list()</h3>


<div class="description">

<p>Returns all (including empty, but not null) DB entries.</p>
</div></div>
<div class="function">
<h3 id="get_data/1-1">get_data(DB::db(), FilterFun::(entry() (see module db_entry)) -&gt; boolean(), ValueFun::(entry() (see module db_entry)) -&gt; V) -&gt; [V]</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_entry/1">get_entry(X1::db(), Key::key() (see module rt_frtchord)) -&gt; entry() (see module db_entry)</h3>


<div class="description">

<p>Gets an entry from the DB. If there is no entry with the given key,
       an empty entry will be returned.</p>
</div></div>
<div class="function">
<h3 id="set_entry/1">set_entry(DB::db(), Entry::entry() (see module db_entry)) -&gt; db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set_entry/1-1">set_entry(State::db(), Entry::entry() (see module db_entry), TLogSnapNo::non_neg_integer(), OwnSnapNo::non_neg_integer()) -&gt; db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="delete_entry/1">delete_entry(DB::db(), Entry::entry() (see module db_entry)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Removes all values with the given entry's key from the DB.</p>
</div></div>
<div class="function">
<h3 id="delete_entry_at_key/1">delete_entry_at_key(DB::db(), Key::key() (see module rt_frtchord)) -&gt; NewDB::db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="update_entry/1">update_entry(DB::db(), Entry::entry() (see module db_entry)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Updates an existing (!) entry in the DB.</p>
</div></div>
<div class="function">
<h3 id="read/1">read(DB::db(), Key::key() (see module rt_frtchord)) -&gt; {ok, Value::value(), Version::version()} | {ok, empty_val, -1}</h3>


<div class="description">

<p>Reads the version and value of a key.</p>
</div></div>
<div class="function">
<h3 id="write/1">write(DB::db(), Key::key() (see module rt_frtchord), Value::value(), Version::version()) -&gt; NewDB::db()</h3>


<div class="description">

<p>Updates the value of the given key.</p>
</div></div>
<div class="function">
<h3 id="delete/1">delete(DB::db(), Key::key() (see module rt_frtchord)) -&gt; {NewDB::db(), Status::ok | locks_set | undef}</h3>


<div class="description">

<p>Deletes the key. Returns {DB, undef} if the key does not exist in the
       DB, {DB, locks_set} if read or write locks are still set and {DB, ok}
       if the operation was successfully performed.</p>
</div></div>
<div class="function">
<h3 id="get_chunk/1">get_chunk(DB::db(), StartId::key() (see module rt_frtchord), Interval::interval() (see module intervals), ChunkSize::pos_integer() | all) -&gt; {interval() (see module intervals), db_as_list()}</h3>


<div class="description">

<p>Returns all key-value pairs of the given DB which are in the given
       interval but at most ChunkSize elements.
       Assumes the ets-table is an ordered_set,
       may return data from "both ends" of the DB-range if the interval is
       ""wrapping around", i.e. its begin is larger than its end.
       Returns the chunk and the remaining interval for which the DB may still
       have data (a subset of I).
       Precond: Interval is a subset of the range of the dht_node and continuous!</p>
</div></div>
<div class="function">
<h3 id="get_chunk/1-1">get_chunk(DB::db(), StartId::key() (see module rt_frtchord), Interval::interval() (see module intervals), FilterFun::(entry() (see module db_entry)) -&gt; boolean(), ValueFun::(entry() (see module db_entry)) -&gt; V, ChunkSize::pos_integer() | all) -&gt; {interval() (see module intervals), [V]}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_split_key/1">get_split_key(DB::db(), Begin::key() (see module rt_frtchord), End::key() (see module rt_frtchord), TargetLoad::pos_integer(), X5::forward | backward) -&gt; {key() (see module rt_frtchord), TakenLoad::non_neg_integer()}</h3>


<div class="description">

<p>Returns the key that would remove not more than TargetLoad entries
       from the DB when starting at the key directly after Begin in case of
       forward searches and directly at Begin in case of backward searches,
       respectively.
       Precond: a load larger than 0
       Note: similar to get_chunk/2.</p>
</div></div>
<div class="function">
<h3 id="split_data/1">split_data(DB::db(), MyNewInterval::interval() (see module intervals)) -&gt; {NewDB::db(), db_as_list()}</h3>


<div class="description">

<p>Splits the database into a database (first element) which contains all
  keys in MyNewInterval and a list of the other values (second element).
  Note: removes all keys not in MyNewInterval from the list of changed
  keys!</p>
</div></div>
<div class="function">
<h3 id="add_data/1">add_data(DB::db(), Data::db_as_list()) -&gt; NewDB::db()</h3>


<div class="description">

<p>Adds all db_entry objects in the Data list.</p>
</div></div>
<div class="function">
<h3 id="get_entries/1">get_entries(DB::db(), Range::interval() (see module intervals)) -&gt; db_as_list()</h3>


<div class="description">

<p>Gets (non-empty) db_entry objects in the given range.</p>
</div></div>
<div class="function">
<h3 id="get_entries/1-1">get_entries(DB::db(), FilterFun::(DBEntry::entry() (see module db_entry)) -&gt; boolean(), ValueFun::(DBEntry::entry() (see module db_entry)) -&gt; Value) -&gt; [Value]</h3>


<div class="description">

<p>Gets all custom objects (created by ValueFun(DBEntry)) from the DB for
  which FilterFun returns true.
  TODO only for legacy compatability; get_chunk should be used</p>
</div></div>
<div class="function">
<h3 id="record_changes/1">record_changes(OldDB::db(), NewInterval::interval() (see module intervals)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Adds the new interval to the interval to record changes for. Entries
       which have (potentially) changed can then be gathered by get_changes/1.</p>
</div></div>
<div class="function">
<h3 id="stop_record_changes/1">stop_record_changes(OldDB::db()) -&gt; NewDB::db()</h3>


<div class="description">

<p>Stops recording changes and removes all entries from the table of
       changed keys.</p>
</div></div>
<div class="function">
<h3 id="stop_record_changes/1-1">stop_record_changes(OldDB::db(), Interval::interval() (see module intervals)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Stops recording changes in the given interval and removes all such
       entries from the table of changed keys.</p>
</div></div>
<div class="function">
<h3 id="get_changes/1">get_changes(DB::db()) -&gt; {Changed::db_as_list(), Deleted::[key() (see module rt_frtchord)]}</h3>


<div class="description">

<p>Gets all db_entry objects which have (potentially) been changed or
       deleted (might return objects that have not changed but have been
       touched by one of the DB setters).</p>
</div></div>
<div class="function">
<h3 id="get_changes/1-1">get_changes(DB::db(), Interval::interval() (see module intervals)) -&gt; {Changed::db_as_list(), Deleted::[key() (see module rt_frtchord)]}</h3>


<div class="description">

<p>Gets all db_entry objects in the given interval which have
       (potentially) been changed or deleted (might return objects that have
       not changed but have been touched by one of the DB setters).</p>
</div></div>
<div class="function">
<h3 id="delete_entries/1">delete_entries(DB::db(), RangeOrFun::interval() (see module intervals) | (DBEntry::entry() (see module db_entry)) -&gt; boolean()) -&gt; NewDB::db()</h3>


<div class="description">

<p>Deletes all objects in the given Range or (if a function is provided)
       for which the FilterFun returns true from the DB.</p>
</div></div>
<div class="function">
<h3 id="snapshot_is_running/1">snapshot_is_running(DB::db()) -&gt; boolean()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="add_snapshot_data/1">add_snapshot_data(DB::db(), Entries::db_as_list()) -&gt; NewDB::db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_snapshot_data/1">get_snapshot_data(DB::db(), Interval::interval() (see module intervals)) -&gt; db_as_list()</h3>


<div class="description">

<p>Returns snapshot data as is for a specific interval</p>
</div></div>
<div class="function">
<h3 id="init_snapshot/1">init_snapshot(DB::db()) -&gt; NewDB::db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="delete_snapshot/1">delete_snapshot(DB::db()) -&gt; NewDB::db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="join_snapshot_data/1">join_snapshot_data(DB::db()) -&gt; db_as_list()</h3>


<div class="description">

<p>Join snapshot and primary db such that all tuples in the
       primary db are replaced if there is a matching tuple available
       in the snapshot set. The other tuples are returned as is.</p>
</div></div>
<div class="function">
<h3 id="snapshot_is_lockfree/1">snapshot_is_lockfree(DB::db()) -&gt; boolean()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_live_lc/1">get_live_lc(DB::db()) -&gt; non_neg_integer()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_snap_lc/1">get_snap_lc(DB::db()) -&gt; non_neg_integer()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_snapshot_data/1-1">get_snapshot_data(DB::db()) -&gt; db_as_list()</h3>


<div class="description">

<p>Returns snapshot data as is for whole interval</p>
</div></div>
<div class="function">
<h3 id="set_snapshot_entry/1">set_snapshot_entry(DB::db(), Entry::entry() (see module db_entry)) -&gt; NewDB::db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_snapshot_entry/1">get_snapshot_entry(DB::db(), Key::key() (see module rt_frtchord)) -&gt; entry() (see module db_entry)</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="delete_snapshot_entry/1">delete_snapshot_entry(DB::db(), Entry::entry() (see module db_entry)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Removes all values with the given entry's key from the Snapshot DB.</p>
</div></div>
<div class="function">
<h3 id="delete_snapshot_entry_at_key/1">delete_snapshot_entry_at_key(DB::db(), Key::key() (see module rt_frtchord)) -&gt; NewDB::db()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="check_db/1">check_db(DB::db()) -&gt; {true, []} | {false, InvalidEntries::db_as_list()}</h3>


<div class="description">

<p>Checks whether all entries in the DB are valid, i.e.
       - no writelocks and readlocks at the same time
       - no empty_val values (these should only be in the DB temporarily)
       - version is greater than or equal to 0
       Returns the result of the check and a list of invalid entries.
       Used in unittests.</p>
</div></div>
<div class="function">
<h3 id="copy_value_to_snapshot_table/1">copy_value_to_snapshot_table(DB::db(), Key::key() (see module rt_frtchord)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Copy existing entry to snapshot table</p>
</div></div>
<div class="function">
<h3 id="update_entries/1">update_entries(DB::db(), Values::[entry() (see module db_entry)], Pred::(OldEntry::entry() (see module db_entry), NewEntry::entry() (see module db_entry)) -&gt; boolean(), UpdateFun::(OldEntry::entry() (see module db_entry), NewEntry::entry() (see module db_entry)) -&gt; UpdatedEntry::entry() (see module db_entry)) -&gt; NewDB::db()</h3>


<div class="description">

<p>Updates all (existing or non-existing) non-locked entries from
       NewEntries for which Pred(OldEntry, NewEntry) returns true with
       UpdateFun(OldEntry, NewEntry).</p>
</div></div></div>

<authors>

<aname>Florian Schintke</aname>
<email>schintke@zib.de</email>
<aname>Nico Kruber</aname>
<email>kruber@zib.de</email>
<aname>Jan Fajerski</aname>
<email>fajerski@zib.de</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
