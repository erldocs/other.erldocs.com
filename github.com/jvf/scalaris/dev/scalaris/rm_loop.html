<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>rm_loop (scalaris) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>rm_loop</h1>
<h2 class="modsummary">   Shared process for the ring maintenance implementations.</h2>
<div class="description">
<p>   Shared process for the ring maintenance implementations.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-message">message() = {rm, trigger}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, trigger_action}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, notify_new_pred, NewPred :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, notify_new_succ, NewSucc :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notify_slide_finished,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SlideType :: pred | succ}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propose_new_neighbors,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNodes :: [<a href="node.html#type-node_type" class="seealso">node:node_type()</a>, ...]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node_info,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SourcePid :: <a href="comm.html#type-mypid" class="seealso">comm:mypid()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Which ::<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[is_leaving |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;succlist |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;succ |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;predlist |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pred |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, leave, Tag :: jump | leave}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, update_my_id, NewId :: <a href="rt_chord.html#type-key" class="seealso">rt_chord:key()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {web_debug_info, Requestor :: <a href="comm.html#type-erl_local_pid" class="seealso">comm:erl_local_pid()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscribe,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pid :: pid(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tag :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#type-subscriber_filter_fun" class="seealso">subscriber_filter_fun()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#type-subscriber_exec_fun" class="seealso">subscriber_exec_fun()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxCalls :: integer() >= 1 | inf}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, unsubscribe, Pid :: pid(), Tag :: any()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {rm, get_move_state, Pid :: pid()}</h3></div>
    <div class="type"><h3 id="type-reason">reason() = {slide_finished, pred | succ | none}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {graceful_leave, Node :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {node_crashed, Node :: <a href="comm.html#type-mypid" class="seealso">comm:mypid()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {add_subscriber}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {node_discovery}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {update_id_failed}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {unknown}</h3></div>
    <div class="type"><h3 id="type-state">state()</h3></div>
    <div class="type"><h3 id="type-subscriber_exec_fun">subscriber_exec_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((Subscriber :: pid() | null,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tag :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reason :: <a href="#type-reason" class="seealso">reason()</a>) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any())</h3></div>
    <div class="type"><h3 id="type-subscriber_filter_fun">subscriber_filter_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((OldNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reason :: <a href="#type-reason" class="seealso">reason()</a>) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean())</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="get_neighbors/1">get_neighbors(X1::state()) -&gt; neighborhood() (see module nodelist)</h3>


<div class="description">

<p>Returns the current neighborhood structure.</p>
</div></div>
<div class="function">
<h3 id="has_left/1">has_left(X1::state()) -&gt; boolean()</h3>


<div class="description">

<p>Returns whether the current node has already left the ring
       (intermediate state before the node is killed or jumping to another
       ID).</p>
</div></div>
<div class="function">
<h3 id="is_responsible/1">is_responsible(Key::key() (see module intervals), X2::state()) -&gt; boolean()</h3>


<div class="description">

<p>Convenience method checking whether the current node is responsible
       for the given key, i.e. has not left and Key is in range.
       Improves performance over two calls in dht_node_state/is_responsible/2.</p>
</div></div>
<div class="function">
<h3 id="leave/1">leave(Tag::jump | leave) -&gt; ok</h3>


<div class="description">

<p>Notifies fd-subscribed nodes that the current dht_node is
       going to leave. Will inform the dht_node process (message handled in
       dht_node_move).
       Note: only call this method from inside the dht_node process!</p>
</div></div>
<div class="function">
<h3 id="notify_new_succ/1">notify_new_succ(Node::mypid() (see module comm), NewSucc::node_type() (see module node)) -&gt; ok</h3>


<div class="description">

<p>Sends a message to the remote node's dht_node process notifying
       it of a new successor.</p>
</div></div>
<div class="function">
<h3 id="notify_new_pred/1">notify_new_pred(Node::mypid() (see module comm), NewPred::node_type() (see module node)) -&gt; ok</h3>


<div class="description">

<p>Sends a message to the remote node's dht_node process notifying
       it of a new predecessor.</p>
</div></div>
<div class="function">
<h3 id="notify_slide_finished/1">notify_slide_finished(SlideType::pred | succ) -&gt; ok</h3>


<div class="description">

<p>Sends a message to the local node's dht_node process notifying
       it of a finished slide.</p>
</div></div>
<div class="function">
<h3 id="propose_new_neighbors/1">propose_new_neighbors(NewNodes::[node_type() (see module node), ...]) -&gt; ok</h3>


<div class="description">

<p>Sends a message to the local node's dht_node process notifying
       it of a potential new neighbor.</p>
</div></div>
<div class="function">
<h3 id="update_id/1">update_id(NewId::key() (see module rt_chord)) -&gt; ok</h3>


<div class="description">

<p>Updates a dht node's id and sends the ring maintenance a message about
       the change.
       Beware: the only allowed node id changes are between the node's
       predecessor and successor!</p>
</div></div>
<div class="function">
<h3 id="subscribe_dneighbor_change_filter/1">subscribe_dneighbor_change_filter(OldNeighbors::neighborhood() (see module nodelist), NewNeighbors::neighborhood() (see module nodelist), Reason::reason()) -&gt; boolean()</h3>


<div class="description">

<p>Filter function for subscriptions that returns true if a
       direct neighbor, i.e. pred, succ or base node, changed.</p>
</div></div>
<div class="function">
<h3 id="subscribe_dneighbor_change_slide_filter/1">subscribe_dneighbor_change_slide_filter(OldNeighbors::neighborhood() (see module nodelist), NewNeighbors::neighborhood() (see module nodelist), Reason::reason()) -&gt; boolean()</h3>


<div class="description">

<p>Filter function for subscriptions that returns true if a
       direct neighbor, i.e. pred, succ or base node, changed or a slide
       operation finished.</p>
</div></div>
<div class="function">
<h3 id="subscribe/1">subscribe(Pid::pid() | null, Tag::any(), FilterFun::subscriber_filter_fun(), ExecFun::subscriber_exec_fun(), MaxCalls::pos_integer() | inf) -&gt; ok</h3>


<div class="description">

<p>Registers the given function to be called when the dht_node changes its
       id. It will get the given Pid and the new node as its parameters.</p>
</div></div>
<div class="function">
<h3 id="unsubscribe/1">unsubscribe(Pid::pid() | null, Tag::any()) -&gt; ok</h3>


<div class="description">

<p>Un-registers the given process with the given tag from node change
       updates.</p>
</div></div>
<div class="function">
<h3 id="send_trigger/0">send_trigger() -&gt; ok</h3>


<div class="description">

<p>Starts the RM trigger.</p>
</div></div>
<div class="function">
<h3 id="init_first/0">init_first() -&gt; ok</h3>


<div class="description">

<p>Initializes the rm_loop trigger and whatever the RM-specific code wants.
       NOTE: this is called during dht_node:init/1 and thus is not infected
             with trace_mpath.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(Me::node_type() (see module node), Pred::node_type() (see module node), Succ::node_type() (see module node), OldSubscrTable::null | tid() (see module ets)) -&gt; state()</h3>


<div class="description">

<p>Initializes the rm_loop state.</p>
</div></div>
<div class="function">
<h3 id="unittest_create_state/1">unittest_create_state(Neighbors::neighborhood() (see module nodelist), HasLeft::boolean()) -&gt; state()</h3>


<div class="description">

<p>Creates a state() object for a unit test.
       Pre: the process must have joined a group. See pid_groups:join_as/2.</p>
</div></div>
<div class="function">
<h3 id="on/1">on(Message::message() | custom_message() (see module rm_tman), State::state()) -&gt; state()</h3>


<div class="description">

<p>Message handler when the rm_loop module is fully initialized.</p>
</div></div>
<div class="function">
<h3 id="fd_notify/1">fd_notify(State::state(), Event::event() (see module fd), DeadPid::mypid() (see module comm), Data::term()) -&gt; state()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="zombie_node/1">zombie_node(State::state(), Node::node_type() (see module node)) -&gt; state()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_web_debug_info/1">get_web_debug_info(State::state()) -&gt; [{string(), string()}]</h3>


<div class="description">
 </div></div></div>

<authors>

<aname>Nico Kruber</aname>
<email>kruber@zib.de</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
