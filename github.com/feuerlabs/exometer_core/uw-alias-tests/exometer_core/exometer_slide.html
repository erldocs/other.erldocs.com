<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>exometer_slide (exometer_core) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>exometer_slide</h1>
<h2 class="modsummary">Efficient sliding-window buffer.</h2>
<div class="description">
<p>Efficient sliding-window buffer</p>
 
  <p>Initial implementation: 29 Sep 2009 by Tony Rogvall</p>
 
  <p>This module implements an efficient sliding window, maintaining
  two lists - a primary and a secondary. Values are paired with a
  timestamp (millisecond resolution, see <code>exometer_util:timestamp/0</code>)  
and prepended to the primary list. When the time span between the oldest  
and the newest entry in the primary list exceeds the given window size,  
the primary list is shifted into the secondary list position, and the  
new entry is added to a new (empty) primary list.</p>
 
  <p>The window can be converted to a list using <code>to_list/1</code> or folded
  over using <code>foldl/3</code>.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-cur_state">cur_state() = any()</h3></div>
    <div class="type"><h3 id="type-fold_acc">fold_acc() = any()</h3></div>
    <div class="type"><h3 id="type-fold_fun">fold_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun(({<a href="#type-timestamp" class="seealso">timestamp()</a>, <a href="#type-value" class="seealso">value()</a>}, <a href="#type-fold_acc" class="seealso">fold_acc()</a>) -> <a href="#type-fold_acc" class="seealso">fold_acc()</a>)</h3></div>
    <div class="type"><h3 id="type-sample_fun">sample_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((<a href="#type-timestamp" class="seealso">timestamp()</a>, <a href="#type-value" class="seealso">value()</a>, <a href="#type-cur_state" class="seealso">cur_state()</a>) -> <a href="#type-cur_state" class="seealso">cur_state()</a>)</h3></div>
    <div class="type"><h3 id="type-timestamp">timestamp() = <a href="exometer_util.html#type-timestamp" class="seealso">exometer_util:timestamp()</a></h3></div>
    <div class="type"><h3 id="type-transform_fun">transform_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((<a href="#type-timestamp" class="seealso">timestamp()</a>, <a href="#type-cur_state" class="seealso">cur_state()</a>) -> <a href="#type-cur_state" class="seealso">cur_state()</a>)</h3></div>
    <div class="type"><h3 id="type-value">value() = any()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="new/1">new(Size::integer(), Period::integer(), SampleFun::sample_fun(), TransformFun::transform_fun(), Opts::list()) -&gt; #slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}</h3>


<div class="description">

<p>Callback function for exometer_histogram</p>
 
  <p>This function is not intended to be used directly. The arguments
  <code>_SampleFun</code> and <code>_TransformFun</code> are ignored.</p>
</div></div>
<div class="function">
<h3 id="new/1-1">new(_Size::integer(), _Options::list()) -&gt; #slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}</h3>


<div class="description">

<p>Create a new sliding-window buffer.</p>
 
  <p><code>Size</code> determines the size in milliseconds of the sliding window.
  The implementation prepends values into a primary list until the oldest
  element in the list is <code>Size</code> ms older than the current value. It then
  swaps the primary list into a secondary list, and starts prepending to
  a new primary list. This means that more data than fits inside the window
  will be kept - upwards of twice as much. On the other hand, updating the
  buffer is very cheap.</p>
</div></div>
<div class="function">
<h3 id="reset/1">reset(Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}) -&gt; #slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}</h3>


<div class="description">

<p>Empty the buffer
 </p>
</div></div>
<div class="function">
<h3 id="add_element/1">add_element(Evt::value(), Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}) -&gt; #slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}</h3>


<div class="description">

<p>Add an element to the buffer, tagging it with the current time.</p>
 
  <p>Note that the buffer is a sliding window. Values will be discarded as they
  move out of the specified time span.</p>
</div></div>
<div class="function">
<h3 id="add_element/1-1">add_element(TS::timestamp(), Evt::value(), Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}) -&gt; #slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}</h3>


<div class="description">

<p>Add an element to the buffer, tagged with the given timestamp.</p>
 
  <p>Apart from the specified timestamp, this function works just like
  <a href="#add_element/2" class="seealso">add_element/2</a>.</p>
</div></div>
<div class="function">
<h3 id="add_element/1-2">add_element(TS::timestamp(), Evt::value(), Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}, Wrap::true) -&gt; {boolean(), #slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}}</h3>


<div class="description">

<p>Add an element to the buffer, optionally indicating if a swap occurred.</p>
 
  <p>This function works like <a href="#add_element/3" class="seealso">add_element/3</a>, but will also indicate
  whether the sliding window buffer swapped lists (this means that the
  'primary' buffer list became full and was swapped to 'secondary', starting
  over with an empty primary list. If <code>Wrap == true</code>, the return value will be
  <code>{Bool,Slide}</code>, where <code>Bool==true</code> means that a swap occurred, and
  <code>Bool==false</code> means that it didn't.</p>
 
  <p>If <code>Wrap == false</code>, this function works exactly like <a href="#add_element/3" class="seealso">add_element/3</a>.</p>
 
  <p>One possible use of the <code>Wrap == true</code> option could be to keep a sliding
  window buffer of values that are pushed e.g. to an external stats service.
  The swap indication could be a trigger point where values are pushed in order
  to not lose entries.</p>
</div></div>
<div class="function">
<h3 id="to_list/1">to_list(Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}) -&gt; [{timestamp(), value()}]</h3>


<div class="description">

<p>Convert the sliding window into a list of timestamped values.</p>
</div></div>
<div class="function">
<h3 id="foldl/1">foldl(Timestamp::timestamp(), Fun::fold_fun(), Acc::fold_acc(), Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}) -&gt; fold_acc()</h3>


<div class="description">

<p>Fold over the sliding window, starting from <code>Timestamp</code>.</p>
 
  <p>The fun should as <code>fun({Timestamp, Value}, Acc) -&gt; NewAcc</code>.
  The values are processed in order from oldest to newest.</p>
</div></div>
<div class="function">
<h3 id="foldl/1-1">foldl(Fun::fold_fun(), Acc::fold_acc(), Slide::#slide{size=integer(), n=integer(), max_n=undefined | integer(), last=integer(), buf1=list(), buf2=list()}) -&gt; fold_acc()</h3>


<div class="description">

<p>Fold over all values in the sliding window.</p>
 
  <p>The fun should as <code>fun({Timestamp, Value}, Acc) -&gt; NewAcc</code>.
  The values are processed in order from oldest to newest.</p>
</div></div></div>

<authors>

<aname>Tony Rogvall</aname>
<email>tony@rogvall.se</email>
<aname>Ulf Wiger</aname>
<email>ulf@feuerlabs.com</email>
<aname>Magnus Feuer</aname>
<email>magnus@feuerlabs.com</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
