<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>exometer (exometer) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>exometer</h1>
<h2 class="modsummary">API and behaviour for metrics instances.</h2>
<div class="description">
<p>API and behaviour for metrics instances</p>
 
  <p><em>Predefined templates</em></p>
 
  <p>It is possible to define a set of defaults for exometer.</p>
 
  <p>Example: Putting the following in a sys.config file,
  </p><pre lang="erlang">
  {exometer, [
           {defaults,
            [{['_'], function , [{module, exometer_function}]},
             {['_'], counter  , [{module, exometer}]},
             {['_'], histogram, [{module, exometer_histogram}]},
             {['_'], spiral   , [{module, exometer_spiral}]},
             {['_'], duration , [{module, exometer_folsom}]},
             {['_'], meter    , [{module, exometer_folsom}]},
             {['_'], gauge    , [{module, exometer_folsom}]}
            ]}
          ]}
  </pre><p>
  will define global defaults for the given metric types. The format is
  <code>{NamePattern, Type, Options}</code></p>
 
  <p>The options can be overridden by options given in the <code>new()</code> command.</p>
 
  <p><code>NamePattern</code> is similar to that used in <a href="#find_entries/1" class="seealso">find_entries/1</a>.
  For more information, see <url href="/home/pete/wefwefwef/docs/other/899055163/repo/0.5.3/.xml/exometer/./exometer_admin.xml#set_default-3">exometer_admin:set_default/3</url>.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-error">error() = {error, any()}</h3></div>
    <div class="type"><h3 id="type-info">info() = name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| type<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| module<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| value<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| cache<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| status<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| timestamp<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| options<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ref<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| datapoints</h3></div>
    <div class="type"><h3 id="type-name">name() = list()</h3></div>
    <div class="type"><h3 id="type-options">options() = [{atom(), any()}]</h3></div>
    <div class="type"><h3 id="type-status">status() = enabled | disabled</h3></div>
    <div class="type"><h3 id="type-type">type() = atom()</h3></div>
    <div class="type"><h3 id="type-value">value() = any()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start/0">start() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="stop/0">stop() -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="new/1">new(Name::name(), Type::type()) -&gt; ok</h3>


<div class="description">
<p>Equivalent to <a href="#new/3" class="seealso">new(Name, Type, [])</a>.</p>
</div></div>
<div class="function">
<h3 id="new/1-1">new(Name::name(), Type::type(), Opts::options()) -&gt; ok</h3>


<div class="description">

<p>Create a new metrics entry.</p>
 
  <p><code>Name</code> must be a list of terms (e.g. atoms). <code>Type</code> must be either one  
of the built-in types, or match a predefined template.</p>
 
  <p><code>Options</code> will be passed to the entry, but the framework will recognize  
the following options:</p>
 
  <p>* <code>{cache, Lifetime}</code> - Cache the results of <a href="#get_value/1" class="seealso">get_value/1</a> for
  the given number of milliseconds. Subsequent calls to <a href="#get_value/1" class="seealso">get_value/1</a>
  will get the cached value, if found. Default is <code>0</code>, which means no  
caching will be performed.</p>
 
  <p>* <code>{status, enabled | disabled}</code> - Default is <code>enabled</code>. If the metric
  is <code>disabled</code>, calls to <a href="#get_value/1" class="seealso">get_value/1</a> will return <code>{ok, unavailable}</code>,
  and calls to <a href="#update/2" class="seealso">update/2</a> and <a href="#sample/1" class="seealso">sample/1</a> will return <code>ok</code> but
  will do nothing.</p>
</div></div>
<div class="function">
<h3 id="re_register/1">re_register(Name::name(), Type::type(), Opts::options()) -&gt; ok</h3>


<div class="description">

<p>Create a new metrics entry, overwrite any old entry.</p>
 
  <p>This function behaves as <a href="#new/3" class="seealso">new/3</a>, but will not fail if an entry
  with the same name already exists. Instead, the old entry will be replaced
  by the new.</p>
</div></div>
<div class="function">
<h3 id="update/1">update(Name::name(), Value::value()) -&gt; ok | error()</h3>


<div class="description">

<p>Update the given metric with <code>Value</code>.</p>
 
  <p>The exact semantics of an update will vary depending on metric type.
  For exometer's built-in counters, the counter instance on the current
  scheduler will be incremented. For a plugin metric (e.g. a probe), the
  corresponding callback module will be called. For a disabled metric,
  <code>ok</code> will be returned without any other action being taken.</p>
</div></div>
<div class="function">
<h3 id="get_value/1">get_value(Name::name()) -&gt; {ok, value()} | error()</h3>


<div class="description">

<p>Fetch the current value of the metric.</p>
 
  <p>For a built-in counter, the value returned is the sum of all counter
  instances (one per scheduler). For plugin metrics, the callback module is
  responsible for providing the value. If the metric has a specified
  (non-zero) cache lifetime, and a value resides in the cache, the cached
  value will be returned.</p>
</div></div>
<div class="function">
<h3 id="get_value/1-1">get_value(Name::name(), DataPoint::atom() | [atom()]) -&gt; {ok, value()} | error()</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="delete/1">delete(Name::name()) -&gt; ok | error()</h3>


<div class="description">

<p>Delete the metric</p>
</div></div>
<div class="function">
<h3 id="sample/1">sample(Name::name()) -&gt; ok | error()</h3>


<div class="description">

<p>Tells the metric (mainly probes) to take a sample.</p>
 
  <p>Probes often take care of data sampling using a configured sample
  interval. This function provides a way to explicitly tell a probe to
  take a sample. The operation is asynchronous. For other metrics, the
  operation likely has no effect, and will return <code>ok</code>.</p>
</div></div>
<div class="function">
<h3 id="reset/1">reset(Name::name()) -&gt; ok | error()</h3>


<div class="description">

<p>Reset the metric.</p>
 
  <p>For a built-in counter, the value of the counter is set to zero. For other
  types of metric, the callback module will define exactly what happens
  when a reset() is requested. A timestamp (<code>os:timestamp()</code>) is saved in
  the exometer entry, which can be recalled using <a href="#info/2" class="seealso">info/2</a>, and will
  indicate the time that has passed since the metric was last reset.</p>
</div></div>
<div class="function">
<h3 id="setopts/1">setopts(Name::name(), Options::options()) -&gt; ok | error()</h3>


<div class="description">

<p>Change options for the metric.</p>
 
  <p>Valid options are whatever the metric type supports, plus:</p>
 
  <p>* <code>{cache, Lifetime}</code> - The cache lifetime (0 for no caching).</p>
 
  <p>* <code>{status, enabled | disabled}</code> - the operational status of the metric.</p>
 
  <p>Note that if the metric is disabled, setopts/2 will fail unless the options
  list contains <code>{status, enabled}</code>, which will enable the metric and cause
  other options to be processed.</p>
</div></div>
<div class="function">
<h3 id="info/1">info(Name::name(), Item::info()) -&gt; any()</h3>


<div class="description">

<p>Retrieves information about a metric.</p>
 
  <p>Supported info items:</p>
 
  <p>* <code>name</code> - The name of the metric
  * <code>type</code> - The type of the metric
  * <code>module</code> - The callback module used
  * <code>value</code> - The result of <code>get_value(Name)</code>
  * <code>cache</code> - The cache lifetime
  * <code>status</code> - Operational status: <code>enabled</code> or <code>disabled</code>
  * <code>timestamp</code> - When the metric was last reset/initiated
  * <code>datapoitns</code> - Data points available for retrieval with get_value()
  * <code>options</code> - Options passed to the metric at creation (or via setopts())
  * <code>ref</code> - Instance-specific reference; usually a pid (probe) or undefined</p>
</div></div>
<div class="function">
<h3 id="info/1-1">info(Name::name()) -&gt; [{info(), any()}]</h3>


<div class="description">

<p>Returns a list of info items for Metric, see <a href="#info/2" class="seealso">info/2</a>.</p>
</div></div>
<div class="function">
<h3 id="find_entries/1">find_entries(Path::[any() | '_']) -&gt; [{name(), type(), status()}]</h3>


<div class="description">

<p>Find metrics based on a name prefix pattern.</p>
 
  <p>This function will find and return metrics whose name matches the given
  prefix. For example <code>[kvdb, kvdb_conf, Table]</code> would match any metrics
  tied to the given table in the <code>kvdb_conf</code> database.</p>
 
  <p>It is possible to insert wildcards:
  <code>[kvdb, kvdb_conf, '_', write]</code> would match
  <code>write</code>-related metrics in all tables of the <code>kvdb_conf</code> database.</p>
 
  <p>The format of the returned metrics is <code>[{Name, Type, Status}]</code>.</p>
</div></div>
<div class="function">
<h3 id="get_values/1">get_values(Path) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="select/1">select(Pattern::match_spec() (see module ets)) -&gt; '$end_of_table' | [{name(), type(), status()}]</h3>


<div class="description">

<p>Perform an <code>ets:select()</code> on the set of metrics.</p>
 
  <p>This function operates on a virtual structure representing the metrics,
  but otherwise works as a normal <code>select()</code>. The representation of the
  metrics is <code>{Name, Type, Status}</code>.</p>
</div></div>
<div class="function">
<h3 id="select/1-1">select(Pattern::match_spec() (see module ets), Limit::pos_integer() | infinity) -&gt; '$end_of_table' | {[{name(), type(), status()}], _Cont}</h3>


<div class="description">

<p>Perform an <code>ets:select()</code> with a Limit on the set of metrics.</p>
 
  <p>This function is equivalent to <a href="#select/1" class="seealso">select/1</a>, but also takes a limit.
  After <code>Limit</code> number of matches, the function returns the matches and a
  continuation, which can be passed to <a href="#select_cont/1" class="seealso">select_cont/1</a>.</p>
</div></div>
<div class="function">
<h3 id="select_cont/1">select_cont(Cont::'$end_of_table' | tuple()) -&gt; '$end_of_table' | {[{name(), type(), status()}], _Cont}</h3>


<div class="description">
<p>Equivalent to <a href="ets.xml.html#select/1" class="seealso">ets:select(Cont)</a>.</p>
</div></div>
<div class="function">
<h3 id="create_entry/1">create_entry(Exometer_entry) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
