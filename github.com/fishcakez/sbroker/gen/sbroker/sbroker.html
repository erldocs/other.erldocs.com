<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>sbroker (sbroker) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>sbroker</h1>
<h2 class="modsummary">
  This module provides a process match making service.</h2>
<div class="description">
<p>
  This module provides a process match making service. A process joins one of
  two queues and is matcheid with a process in the other queue. The queues can
  be actively managed using an <code>squeue</code> callback module, and passively managed  
using head or tail drop. A different strategy can be used for both queues.  
Processes that die while in a queue are automatically removed to prevent  
matching with a process that is nolonger alive.</p>
 
  <p>There are two functions to join a queue: <code>ask/1</code> and <code>ask_r/1</code>. Processes
  that call <code>ask/1</code> are matched against processes that call <code>ask_r/1</code>. If no  
match is immediately avaliable a process is queued in the relevant queue  
until a match becomes avaliable. If queue management is used processes may be  
dropped without a match.</p>
 
  <p>Processes calling <code>ask/1</code> try to match with/dequeue a process in the <code>ask_r</code>
  queue. If no process exists they are queued in the <code>ask</code> queue and await a
  process to call <code>ask_r/1</code>.</p>
 
  <p>Similarly processes calling <code>ask_r/1</code> try to match with/dequeue a process
  in the <code>ask</code> queue. If no process exists they are queued in the <code>ask_r</code> queue
  and await a process to call <code>ask/1</code>.</p>
 
  <p>A broker requires a callback module. The callback modules implements one
  callback, <code>init/1</code>, with single argument <code>Args</code>. <code>init/1</code> should return
  <code>{ok, {AskQueueSpec, AskRQueueSpec, Timeout})</code> or <code>ignore</code>. <code>AskQueuSpec</code> is
  the queue specification for the <code>ask</code> queue and <code>AskRQueueSpec</code> is the queue
  specification for the <code>ask_r</code> queue. <code>Timeout</code> is the timeout in
  milliseconds that the active queue is polled when the broker is idle. This
  ensures that the active queue management strategy is applied even if no
  processes are enqueued/dequeued. In the case of <code>ignore</code> the broker is not
  started and <code>start_link</code> returns <code>ignore</code>.</p>
 
  <p>A queue specifcation takes the following form: <code>{Module, Args}</code>. <code>Module</code> is
  the <code>sbroker</code> callback module and <code>Args</code> are its arguments.</p>
 
  <p>For example:</p>
 
  <pre class="sh_erlang">  -module(sbroker_example).
 
  -behaviour(sbroker).
 
  -export([start_link/0]).
  -export([ask/0]).
  -export([ask_r/1]).
  -export([init/1]).
 
  start_link() -&gt;
      sbroker:start_link({local, ?MODULE}, ?MODULE, []).
 
  ask() -&gt;
      sbroker:ask(?MODULE).
 
  ask_r() -&gt;
      sbroker:ask_r(?MODULE).
 
  init([]) -&gt;
      AskQueueSpec = {sbroker_codel_queue, {out, 5, 100, drop_r, 64}},
      AskRQueueSpec = {sbroker_timeout_queue, {out_r, 5000, drop, infinity}},
      Timeout = 200,
      {ok, {AskQueueSpec, AskRQueueSpec, Timeout}}.</pre></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-broker">broker() = pid()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| atom()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {atom(), node()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {global, any()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {via, module(), any()}</h3></div>
    <div class="type"><h3 id="type-debug_option">debug_option() = trace<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| log<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {log, integer() >= 1}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| statistics<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {log_to_file, <a href="file.html#type-filename" class="seealso">file:filename()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {install, {function(), any()}}</h3></div>
    <div class="type"><h3 id="type-name">name() = {local, atom()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {global, any()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {via, module(), any()}</h3></div>
    <div class="type"><h3 id="type-queue_spec">queue_spec() = {module(), any()}</h3></div>
    <div class="type"><h3 id="type-start_option">start_option() = {debug, <a href="#type-debug_option" class="seealso">debug_option()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {timeout, timeout()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {spawn_opt, [<a href="proc_lib.html#type-spawn_option" class="seealso">proc_lib:spawn_option()</a>]}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {time_module, module()}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {time_unit, <a href="sbroker_time.html#type-unit" class="seealso">sbroker_time:unit()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {read_time_after,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;integer() >= 0 | infinity}</h3></div>
    <div class="type"><h3 id="type-start_return">start_return() = {ok, pid()} | ignore | {error, any()}</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="ask/1">ask(Broker) -&gt; Go | Drop</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Drop = {drop, SojournTime}</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#ask/2" class="seealso">ask(Broker, self())</a>.</p>
</div></div>
<div class="function">
<h3 id="ask/2">ask(Broker, ReqValue) -&gt; Go | Drop</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Drop = {drop, SojournTime}</code></li></ul>
<div class="description">

<p>Send a match request, with value <code>ReqValue</code>, to try to match with a
  process calling <code>ask_r/2</code> on the broker, <code>Broker</code>.</p>
 
  <p>Returns <code>{go, Ref, Value, RelativeTime, SojournTime}</code> on a successful
  match or <code>{drop, SojournTime}</code>.</p>
 
  <p><code>Ref</code> is the transaction reference, which is a <code>reference()</code>. <code>Value</code> is the
  value of the matched request sent by the counterparty process. <code>RelativeTime</code>
  is the approximate time differnece (in the broker's time unit) between when
  the request was sent and the matching request was sent. <code>SojournTime</code> is the  
approximate time spent in both the broker's message queue and internal queue.</p>
 
  <p><code>RelativeTime</code> represents the <code>SojournTime</code> without the overhead of the  
broker. The value measures the level of queue congestion without being  
effected by the load of the broker.</p>
 
  <p>If <code>RelativeTime</code> is positive, the request was enqueued in the internal
  queue awaiting a match with another request sent approximately <code>RelativeTime</code>
  after this request was sent. Therefore <code>SojournTime</code> minus <code>RelativeTime</code>  
is the latency, or overhead, of the broker.</p>
 
  <p>If <code>RelativeTime</code> is negative, the request dequeued a request in the internal
  queue that was sent approximately <code>RelativeTime</code> before this request was
  sent. Therefore <code>SojournTime</code> is the latency, or overhead, of the broker.</p>
 
  <p>If <code>RelativeTime</code> is <code>0</code>, the request was matched with a request sent at
  approximately the same time. Therefore <code>SojournTime</code> is the latency, or  
overhead, of the broker.</p>
 
  <p>The sojourn time for matched process can be approximated by <code>SojournTime</code>
  minus <code>RelativeTime</code>.</p>
</div></div>
<div class="function">
<h3 id="ask_r/1">ask_r(Broker) -&gt; Go | Drop</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Drop = {drop, SojournTime}</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#ask_r/2" class="seealso">ask_r(Broker, self())</a>.</p>
</div></div>
<div class="function">
<h3 id="ask_r/2">ask_r(Broker, ReqValue) -&gt; Go | Drop</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Drop = {drop, SojournTime}</code></li></ul>
<div class="description">

<p>Tries to match with a process calling <code>ask/2</code> on the same broker.
 </p>
<p><em>See also:</em> <a href="#ask/2" class="seealso">ask/2</a>.</p>
</div></div>
<div class="function">
<h3 id="nb_ask/1">nb_ask(Broker) -&gt; Go | Retry</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = 0 | neg_integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Retry = {retry, SojournTime}</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#nb_ask/2" class="seealso">nb_ask(Broker, self())</a>.</p>
</div></div>
<div class="function">
<h3 id="nb_ask/2">nb_ask(Broker, ReqValue) -&gt; Go | Retry</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = 0 | neg_integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Retry = {retry, SojournTime}</code></li></ul>
<div class="description">

<p>Tries to match with a process calling <code>ask_r/2</code> on the same broker but
  does not enqueue the request if no immediate match. Returns
  <code>{go, Ref, Value, RelativeTime, SojournTime}</code> on a successful match or
  <code>{retry, SojournTime}</code>.</p>
 
  <p><code>Ref</code> is the transaction reference, which is a <code>reference()</code>. <code>Value</code> is the
  value of the matched process. <code>RelativeTime</code> is the time spent waiting for a
  match after discounting time spent waiting for the broker to handle requests.
  <code>SojournTime</code> is the time spent in the broker's message queue.
 </p>
<p><em>See also:</em> <a href="#ask/2" class="seealso">ask/2</a>.</p>
</div></div>
<div class="function">
<h3 id="nb_ask_r/1">nb_ask_r(Broker) -&gt; Go | Retry</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = 0 | neg_integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Retry = {retry, SojournTime}</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#nb_ask_r/2" class="seealso">nb_ask_r(Broker, self())</a>.</p>
</div></div>
<div class="function">
<h3 id="nb_ask_r/2">nb_ask_r(Broker, ReqValue) -&gt; Go | Retry</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = 0 | neg_integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Retry = {retry, SojournTime}</code></li></ul>
<div class="description">

<p>Tries to match with a process calling <code>ask/2</code> on the same broker but
  does not enqueue the request if no immediate match.
 </p>
<p><em>See also:</em> <a href="#nb_ask/2" class="seealso">nb_ask/2</a>.</p>
</div></div>
<div class="function">
<h3 id="async_ask/1">async_ask(Broker) -&gt; {await, Tag, Pid}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Tag = reference()</code></li><li><code>Pid = pid()</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#async_ask/2" class="seealso">async_ask(Broker, self())</a>.</p>
</div></div>
<div class="function">
<h3 id="async_ask/2">async_ask(Broker, ReqValue) -&gt; {await, Tag, Pid}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Tag = reference()</code></li><li><code>Pid = pid()</code></li></ul>
<div class="description">

<p>Monitors the broker and sends an asynchronous request to match with a
  process calling <code>ask_r/2</code>. Returns <code>{await, Tag, Pid}</code>.</p>
 
  <p><code>Tag</code> is a monitor <code>reference()</code> that uniquely identifies the reply
  containing the result of the request. <code>Pid</code>, is the pid (<code>pid()</code>) of the
  monitored broker. To cancel the request call <code>cancel(Pid, Tag)</code>.</p>
 
  <p>The reply is of the form <code>{Tag, {go, Ref, Value, RelativeTime, SojournTime}</code>
  or <code>{Tag, {drop, SojournTime}}</code>.</p>
 
  <p><code>Ref</code> is the transaction reference, which is a <code>reference()</code>. <code>Value</code> is the
  value of the matched process. <code>RelativeTime</code> is the time spent waiting for a
  match after discounting time spent waiting for the broker to handle requests.
  <code>SojournTime</code> is the time spent in the broker's message queue.</p>
 
  <p>Multiple asynchronous requests can be made from a single process to a
  broker and no guarantee is made of the order of replies. A process making
  multiple requests can reuse the monitor reference for subsequent requests to
  the same broker process (<code>Process</code>) using <code>async_ask/3</code>.
 </p>
<p><em>See also:</em> <a href="#async_ask/3" class="seealso">async_ask/3</a>, <a href="#cancel/2" class="seealso">cancel/2</a>.</p>
</div></div>
<div class="function">
<h3 id="async_ask/3">async_ask(Broker, ReqValue, Tag) -&gt; {await, Tag, Pid}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Tag = any()</code></li><li><code>Pid = pid()</code></li></ul>
<div class="description">

<p>Sends an asynchronous request to match with a process calling <code>ask_r/2</code>.
  Returns <code>{await, Tag, Pid}</code>.</p>
 
  <p><code>Tag</code> is a <code>any()</code> that identifies the reply containing the result of the
  request. <code>Pid</code>, is the pid (<code>pid()</code>) of the broker. To cancel all requests
  identified by <code>Tag</code> on broker <code>Pid</code> call <code>cancel(Pid, Tag)</code>.</p>
 
  <p>The reply is of the form <code>{Tag, {go, Ref, Value, RelativeTime, SojournTime}</code>
  or <code>{Tag, {drop, SojournTime}}</code>.</p>
 
  <p><code>Ref</code> is the transaction reference, which is a <code>reference()</code>. <code>Value</code> is the
  value of the matched process. <code>RelativeTime</code> is the time spent waiting for a
  match after discounting time spent waiting for the broker to handle requests.
  <code>SojournTime</code> is the time spent in the broker's message queue.</p>
 
  <p>Multiple asynchronous requests can be made from a single process to a
  broker and no guarantee is made of the order of replies. If the broker
  exits or is on a disconnected node there is no guarantee of a reply and so
  the caller should take appropriate steps to handle this scenario.
 </p>
<p><em>See also:</em> <a href="#cancel/2" class="seealso">cancel/2</a>.</p>
</div></div>
<div class="function">
<h3 id="async_ask_r/1">async_ask_r(Broker) -&gt; {await, Tag, Pid}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Tag = reference()</code></li><li><code>Pid = pid()</code></li></ul>
<div class="description">
<p>Equivalent to <a href="#async_ask_r/2" class="seealso">async_ask_r(Broker, self())</a>.</p>
</div></div>
<div class="function">
<h3 id="async_ask_r/2">async_ask_r(Broker, ReqValue) -&gt; {await, Tag, Pid}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Tag = reference()</code></li><li><code>Pid = pid()</code></li></ul>
<div class="description">

<p>Monitors the broker and sends an asynchronous request to match with a
  process calling <code>ask/2</code>.
 </p>
<p><em>See also:</em> <a href="#async_ask/2" class="seealso">async_ask/2</a>, <a href="#cancel/2" class="seealso">cancel/2</a>.</p>
</div></div>
<div class="function">
<h3 id="async_ask_r/3">async_ask_r(Broker, ReqValue, Tag) -&gt; {await, Tag, Pid}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>ReqValue = any()</code></li><li><code>Tag = any()</code></li><li><code>Pid = pid()</code></li></ul>
<div class="description">

<p>Sends an asynchronous request to match with a process calling <code>ask/2</code>.
 </p>
<p><em>See also:</em> <a href="#async_ask/3" class="seealso">async_ask/3</a>, <a href="#cancel/2" class="seealso">cancel/2</a>.</p>
</div></div>
<div class="function">
<h3 id="await/2">await(Tag, Timeout) -&gt; Go | Drop</h3>

<ul class="type">
<li><code>Tag = any()</code></li><li><code>Timeout = timeout()</code></li><li><code>Go = {go, Ref, Value, RelativeTime, SojournTime}</code></li><li><code>Ref = reference()</code></li><li><code>Value = any()</code></li><li><code>RelativeTime = integer()</code></li><li><code>SojournTime = non_neg_integer()</code></li><li><code>Drop = {drop, SojournTime}</code></li></ul>
<div class="description">

<p>Await the response to an asynchronous request identified by <code>Tag</code>.</p>
 
  <p>Exits if a response is not received after <code>Timeout</code> milliseconds.</p>
 
  <p>Exits if a <code>DOWN</code> message is received with the reference <code>Tag</code>.
 </p>
<p><em>See also:</em> <a href="#async_ask/2" class="seealso">async_ask/2</a>, <a href="#async_ask_r/2" class="seealso">async_ask_r/2</a>.</p>
</div></div>
<div class="function">
<h3 id="cancel/3">cancel(Broker, Tag, Timeout) -&gt; Count | false</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Tag = any()</code></li><li><code>Timeout = timeout()</code></li><li><code>Count = pos_integer()</code></li></ul>
<div class="description">

<p>Cancels an asynchronous request. Returns the number of cancelled
  requests or <code>false</code> if no requests exist. In the later case a caller may wish
  to check its message queue for an existing reply.
 </p>
<p><em>See also:</em> <a href="#async_ask/1" class="seealso">async_ask/1</a>, <a href="#async_ask_r/1" class="seealso">async_ask_r/1</a>.</p>
</div></div>
<div class="function">
<h3 id="change_config/2">change_config(Broker, Timeout) -&gt; ok | {error, Reason}</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Timeout = timeout()</code></li><li><code>Reason = any()</code></li></ul>
<div class="description">

<p>Change the configuration of the broker. Returns <code>ok</code> on success and
  <code>{error, Reason}</code> on failure, where <code>Reason</code>, is the reason for failure.</p>
 
  <p>Broker calls the <code>init/1</code> callback to get the new configuration. If <code>init/1</code>
  returns <code>ignore</code> the config does not change.</p>
</div></div>
<div class="function">
<h3 id="len/2">len(Broker, Timeout) -&gt; Length</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Timeout = timeout()</code></li><li><code>Length = non_neg_integer()</code></li></ul>
<div class="description">

<p>Get the length of the <code>ask</code> queue in the broker, <code>Broker</code>.</p>
</div></div>
<div class="function">
<h3 id="len_r/2">len_r(Broker, Timeout) -&gt; Length</h3>

<ul class="type">
<li><code>Broker = broker()</code></li><li><code>Timeout = timeout()</code></li><li><code>Length = non_neg_integer()</code></li></ul>
<div class="description">

<p>Get the length of the <code>ask_r</code> queue in the broker, <code>Broker</code>.</p>
</div></div>
<div class="function">
<h3 id="start_link/3">start_link(Module, Args, Opts) -&gt; StartReturn</h3>

<ul class="type">
<li><code>Module = module()</code></li><li><code>Args = any()</code></li><li><code>Opts = [start_option()]</code></li><li><code>StartReturn = start_return()</code></li></ul>
<div class="description">

<p>Starts a broker with callback module <code>Module</code> and argument <code>Args</code>, and
  broker options <code>Opts</code>.</p>
 
  <p><code>Opts</code> is a <code>proplist</code> and supports <code>debug</code>, <code>timeout</code> and <code>spawn_opt</code> used
  by <code>gen_server</code> and <code>gen_fsm</code>. <code>time_module</code> sets the <code>sbroker_time</code>
  callback module, which defaults to <code>erlang</code> if <code>erlang:monotonic_time/1</code> is
  exported, otherwise <code>sbroker_legacy</code>, which uses <code>erlang:now/0</code>. The time
  units are set with <code>time_unit</code>, which defaults to <code>native</code>. <code>read_time_after</code>
  sets the number of requests when a cached time is stale and the time is read
  again. Its value is a <code>non_neg_integer()</code> or <code>infinity</code> and defaults to <code>16</code>.
 </p>
<p><em>See also:</em> <a href="sbroker_time.html" class="seealso">sbroker_time</a>, <a href="gen_server.html#start_link/3" class="seealso">gen_server:start_link/3</a>.</p>
</div></div>
<div class="function">
<h3 id="start_link/4">start_link(Name, Module, Args, Opts) -&gt; StartReturn</h3>

<ul class="type">
<li><code>Name = name()</code></li><li><code>Module = module()</code></li><li><code>Args = any()</code></li><li><code>Opts = [start_option()]</code></li><li><code>StartReturn = start_return()</code></li></ul>
<div class="description">

<p>Starts a broker with name <code>Name</code>, callback module <code>Module</code> and argument
  <code>Args</code>, and broker options <code>Opts</code>.
 </p>
<p><em>See also:</em> <a href="#start_link/3" class="seealso">start_link/3</a>.</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
