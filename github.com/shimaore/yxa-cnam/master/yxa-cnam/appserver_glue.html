<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>appserver_glue (yxa-cnam) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>appserver_glue</h1>
<h2 class="modsummary">     Appserver glue between sipproxy and server transaction.</h2>
<div class="description">
<p>     Appserver glue between sipproxy and server transaction.</p>
  
             <p>During a fork of a request, we typically have the             
following components working together :</p>
  
             <pre class="sh_erlang">                      -------
                      | UAS |
                      ---+---
                         |
                 ------------------
                 | appserver glue |
                 ------------------
                         |
                 ------------------
                 |    sipproxy    |
                 ------------------
                   |     |      |
                 ----- -----  -----
                 |UAC| |UAC|  |UAC|  ...
                 ----- -----  -----</pre>
  
             <p>In this module, the UAS is called the <code>callhandler</code> and
             the sipproxy is called <code>forkpid</code>.</p>
  
             <p>This process does the following :</p>
  
             <p>1) Makes sure we deliver one, and only one, final                
response to the UAS (with one exception, see below)</p>
  
             <p>2) Statelessly forwards any 'late' 200 OK responses to                
INVITE that the sipproxy delivers to us. This is                
necessary because the UAS terminates right after it                
sends the first 200 OK response (if the request was                
an INVITE).</p>
  
             <p>3) Tells sipproxy to CANCEL all pending transactions if                
the UAS is cancelled (the transaction layer receives                
a CANCEL that matches the UAS transaction).</p>
  
             <p>for CPL processing, things work a bit differently. When             
we process a CPL script, we don't pass final responses             
to the UAS but rather to the CPL engine so that it can             
decide what to do.</p>
  
             <p>Signals handled :</p>
  
             <p>From UAS :</p>
  
                <p><code>{servertransaction_cancelled, FromPid, ExtraHeaders}</code> <br />                   
the UAS has been cancelled.</p>
  
                <p><code>{servertransaction_terminating, FromPid}</code>             <br />                   
the UAS is terminating right now.</p>
  
             <p>From sipproxy :</p>
  
                <p><code>{sipproxy_response, FromPid, Branch, Response}</code>       <br />                   
a response has been received from one of the                   
client transactions, that the sipproxy decided                   
should be forwarded upstreams.</p>
  
                <p><code>{sipproxy_all_terminated, FromPid, FinalResponse}</code>    <br />                   
All the call actions provided to the sipproxy have                   
completed.</p>
  
                <p><code>{sipproxy_no_more_actions, FromPid}</code>                  <br />                   
The sipproxy has cancelled all pending client                   
transactions, and is now just staying alive to                   
forward any 200 OK responses.</p>
  
                <code>{sipproxy_terminating, FromPid}</code>                      <br />
                    The sipproxy process is finally terminating.
  </div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-state">state() = #state{}</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/3">start_link(Request, Actions, Surplus) -&gt; term()</h3>

<ul class="type">
<li><code>Request = #request{}</code></li><li><code>Actions = [#sipproxy_action{}]</code></li><li><code>Surplus = [#sipproxy_action{}]</code></li></ul>
<div class="description">

<p>    Start an appserver_glue gen_server. One is started for
           each forked request - acting as glue between a sipproxy
           process and a server transaction.</p>
</div></div></div>

<authors>

<aname>Fredrik Thulin</aname>
<email>ft@it.su.se</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
