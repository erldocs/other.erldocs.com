<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>gen_indira_listener (indira) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>gen_indira_listener</h1>
<h2 class="modsummary">     
Indira listener (TCP, SSL, UNIX, you name it) entry point.</h2>
<div class="description">
<p>     
Indira listener (TCP, SSL, UNIX, you name it) entry point.</p>
  
     <p>Module implementing this behaviour is an entry point for Indira to spawn     
a listener, either directly a worker (e.g. for connection-less     
protocols) or a supervision subtree (e.g. for TCP).</p>
  
     <p>Note that it will be a good idea to describe what's expected as
     the parameter in listener definition in Indira's config (the config
     retrieved with <code>application:get_env(indira, listen)</code>).</p>
  
     <em><marker id="Communication_command_executor">Communication command executor</marker></em>
  
     <p>Command executor is a separate process, possibly implementing
     <code>gen_server</code> behaviour. Messages sent to and expected from are
     documented in <a href="indira.html" class="seealso">indira</a> module, as it's mostly seen by Indira's     
user (daemon author).</p>
  
     <em><marker id="Communication_with_listener">Communication with listener</marker></em>
  
     <p>Listener is expected to read a single line of the request from client
     and send it using <a href="#command/2" class="seealso">command/2</a> or <a href="#command/3" class="seealso">command/3</a> to Indira
     router. Indira router will parse it and send it further to command
     center. Reply to the command will come as a message of form
     <code>{result,Line}</code> (when <a href="#command/2" class="seealso">command/2</a> was called) or
     <code>{result,RoutingHint,Line}</code> (<a href="#command/3" class="seealso">command/3</a>). You may depend on this
     behaviour. <code>Line</code> <em>will not</em> include newline character in any     
form.</p>
  
     <p><a href="#command/3" class="seealso">command/3</a> with <code>{result,RoutingHint,Line}</code> message are intended
     for cases when single listener handles multiple clients and needs to
     distinguish them. Listener may specify anything as a <code>RoutingHint</code> --     
it's opaque to Indira router.</p>
  
     <p>To provide uniformly formatted logs, listener should log errors using
     <a href="indira_log.html#error/3" class="seealso">indira_log:error/3</a> (e.g. in case of problems in communication
     with client) or <a href="indira_log.html#critical/3" class="seealso">indira_log:critical/3</a> (e.g. in case of socket     
setup error).</p>
  
     <em><marker id="Line_format">Line format</marker></em>
  
     <p>Formats of the request and response lines are documented in
     <a href="indira.html" class="seealso">indira</a> module.</p>
  
     <em><marker id="Entry_point_module_API">Entry point module API</marker></em>
  
     <p><code>Module:child_spec/2</code> gets two arguments: Indira router address suitable
     for <a href="#command/2" class="seealso">command/2</a> and the term that was specified as module argument
     in environment specification. Now, <code>Module</code> has an opportunity to pass     
Indira handle to the child to be spawned.</p>
  
     <code>Module:child_spec/2</code> is supposed to return
     <code>supervisor:child_spec()</code>, i.e. <code>{Id, MFA, Restart, Shutdown,
     Type, Modules}</code>, where:
     <list>
       <item><p><code>Id</code> is ignored</p></item>
       <item><p><code>MFA</code> is <code>{Module, Function, Args}</code> suitable for
           <a href="erlang.html#apply/3" class="seealso">erlang:apply/3</a></p></item>
       <item><p><code>Restart</code> is ignored and will always be set to <code>permanent</code></p></item>
       <item><p><code>Shutdown</code> is <code>brutal_kill</code>, integer &gt;0 or <code>infinity</code></p></item>
       <item><p><code>Type</code> is <code>worker</code> or <code>supervisor</code></p></item>
       <item><p><code>Modules</code> is a list of modules used by the child or a single atom
           <code>dynamic</code></p></item>
     </list>
  
     Typically, for module <code>foo</code> it would be:
     <list>
       <item><p><code>{ignore, {foo, start_link, []}, permanent, 5000, worker, [foo]}</code>
           for <code>foo:start_link/0</code> that runs worker</p></item>
       <item><p><code>{ignore, {foo_sup, start_link, []}, permanent, 5000, supervisor,
           [foo_sup]}</code> for <code>foo_sup:start_link/0</code> that runs whole supervision
           tree</p></item>
     </list>
     Note that the definitions above don't pass Indira router address to
     spawned processes. The address most probably should be passed in <code>Args</code>
     (which equals to <code>[]</code> in above examples).
  </div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="behaviour_info/1">behaviour_info(Aspect) -&gt; term()
</h3>


<div class="description">

<p>Behaviour description.</p>
</div></div>
<div class="function">
<h3 id="command/2">command(Indira, Line) -&gt; term()
</h3>


<div class="description">

<p>Send command to Indira router.    
According to client protocol, response to the command from executor will    
be returned as a message to the process that called this function.</p>
 
    <p>This function is intended to be called from <a href="gen_indira_listener.html" class="seealso">gen_indira_listener</a>
    supervision tree.
 </p>
<p><em>See also:</em> <a href="indira_router.html#command/2" class="seealso">indira_router:command/2</a>.</p>
</div></div>
<div class="function">
<h3 id="command/3">command(Indira, RoutingKey, Line) -&gt; term()
</h3>


<div class="description">

<p>Send command to Indira router.    
The process calling this function will get the response as a message.</p>
 
    <p><code>RoutingKey</code> is an additional information to tell apart between multiple    
clients and will be included in command reply message.</p>
 
    <p>This call form is only needed when a single process handles multiple    
clients.</p>
 
    <p>This function is intended to be called from <a href="gen_indira_listener.html" class="seealso">gen_indira_listener</a>
    supervision tree.
 </p>
<p><em>See also:</em> <a href="indira_router.html#command/3" class="seealso">indira_router:command/3</a>.</p>
</div></div></div>
<div class="section"><h4>See also</h4><p><a href="indira_log.html" class="seealso">indira_log</a></p></div>
<authors>
<aname> </aname>
<email> </email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
