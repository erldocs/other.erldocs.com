<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>z_session_page (zotonic) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>z_session_page</h1>
<h2 class="modsummary">Page session for interaction with the page displayed on the user agent.</h2>
<div class="description">
<p>Page session for interaction with the page displayed on the user agent. Support for comet polls and websocket.
       The page session is the switchboard for getting data pushed to the user agent.  All queued requests
       can be sent via the current request being handled, via a comet poll or a websocket connection.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-wm_dict">wm_dict() = dict()</h3></div>
    <div class="type"><h3 id="type-wm_gb_tree">wm_gb_tree() = gb_tree()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/1">start_link(SessionPid::pid(), PageId::binary(), Context::#context{host=atom(), wm_reqdata=#wm_reqdata{socket=any(), metadata=wm_dict(), range=any(), peer=ip_address() (see module inet), bodyfetch=any(), log_data=any(), method=undefined | method() (see module wrq), scheme=undefined | scheme() (see module wrq), version=undefined | version() (see module wrq), disp_path=any(), path=undefined | string(), raw_path=undefined | string(), path_info=undefined | wm_dict(), path_tokens=undefined | [string()], app_root=undefined | string(), response_code=undefined | pos_integer(), max_recv_body=undefined | pos_integer(), req_cookie=undefined | string(), req_qs=undefined | string(), req_headers=undefined | wm_gb_tree(), req_body=any(), resp_redirect=undefined | boolean(), resp_headers=any(), resp_content_encoding=undefined | string(), resp_transfer_encoding=undefined | {string(), function()}, resp_content_type=undefined | string(), resp_chosen_charset=undefined | string(), resp_body=undefined | any(), is_range_ok=boolean(), host_tokens=undefined | [string()], port=undefined | port_number() (see module inet), cache=list()} | undefined, controller_module=atom(), session_pid=pid() | undefined, session_id=string() | undefined, page_pid=pid() | undefined, page_id=string() | undefined, ua_class=device_type() (see module ua_classifier) | undefined, depcache=any(), notifier=any(), session_manager=any(), dispatcher=any(), template_server=any(), scomp_server=any(), dropbox_server=any(), pivot_server=any(), module_indexer=any(), translation_table=any(), dbc=pid() | undefined, db={pid(), atom()} | undefined, language=atom(), tz=string() | binary(), acl=any(), user_id=integer() | undefined, updates=any(), actions=any(), content_scripts=any(), scripts=any(), wire=any(), validators=any(), render=any(), props=any()}) -&gt; {ok, pid()} | {error, term()}</h3>


<div class="description">

<p>Starts the person manager server</p>
</div></div>
<div class="function">
<h3 id="stop/1">stop(Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="whereis/2">whereis(PageId, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="ping/1">ping(Pid) -&gt; term()
</h3>


<div class="description">

<p>Receive a ping, makes sure that we stay alive</p>
</div></div>
<div class="function">
<h3 id="session_pid/1">session_pid(Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_attach_state/1">get_attach_state(Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="auth_change/1">auth_change(Pid) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="page_id/1">page_id(Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set/3">set(Key, Value, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get/2">get(Key, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="incr/3">incr(Key, Value, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="append/3">append(Key, Value, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="comet_attach/2">comet_attach(CometPid, Pid) -&gt; term()
</h3>


<div class="description">

<p>Attach the comet request process to the page session, enabling sending scripts to the user agent</p>
</div></div>
<div class="function">
<h3 id="comet_detach/1">comet_detach(Pid) -&gt; term()
</h3>


<div class="description">

<p>Called when the comet request process closes, we will need to wait for the next connection</p>
</div></div>
<div class="function">
<h3 id="websocket_attach/3">websocket_attach(WsPid, PageId, Context) -&gt; term()
</h3>


<div class="description">

<p>Attach the websocket request process to the page session, enabling sending scripts to the user agent</p>
</div></div>
<div class="function">
<h3 id="websocket_attach/2">websocket_attach(WsPid, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="get_transport_data/1">get_transport_data(Pid) -&gt; term()
</h3>


<div class="description">

<p>Called by the comet process or the page request to fetch any queued transport messages</p>
</div></div>
<div class="function">
<h3 id="add_script/2">add_script(Script, Context) -&gt; term()
</h3>


<div class="description">

<p>Send a script to the user agent, will be queued and send when the comet process attaches</p>
</div></div>
<div class="function">
<h3 id="add_script/1">add_script(Context) -&gt; term()
</h3>


<div class="description">

<p>Split the scripts from the context and add the scripts to the page.</p>
</div></div>
<div class="function">
<h3 id="transport/2">transport(Msg, Context) -&gt; term()
</h3>


<div class="description">

<p>Send a msg to the pages, queue if no page-transport attached</p>
</div></div>
<div class="function">
<h3 id="transport/3">transport(Msg, PageId, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="receive_ack/2">receive_ack(Ack, Context) -&gt; term()
</h3>


<div class="description">

<p>Receive an ack for a sent message</p>
</div></div>
<div class="function">
<h3 id="receive_ack/3">receive_ack(Ack, PageId, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="spawn_link/4">spawn_link(Module, Func, Args, Context) -&gt; term()
</h3>


<div class="description">

<p>Spawn a new process, linked to the page pid</p>
</div></div>
<div class="function">
<h3 id="check_timeout/1">check_timeout(Pid) -&gt; term()
</h3>


<div class="description">

<p>Kill this page when timeout has been reached</p>
</div></div>
<div class="function">
<h3 id="init/1">init(X1::Args) -&gt; {ok, State} | {ok, State, Timeout} | ignore | {stop, Reason}</h3>


<div class="description">

<p>Initiates the server, initialises the pid lookup dicts</p>
</div></div>
<div class="function">
<h3 id="handle_cast/2">handle_cast(Message::Msg, State) -&gt; {noreply, State} | {noreply, State, Timeout} | {stop, Reason, State}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_call/3">handle_call(Message::Request, From, State) -&gt; {reply, Reply, State} | {reply, Reply, State, Timeout} | {noreply, State} | {noreply, State, Timeout} | {stop, Reason, Reply, State} | {stop, Reason, State}</h3>


<div class="description">

<p>Handling call messages</p>
</div></div>
<div class="function">
<h3 id="handle_info/2">handle_info(X1::Info, State) -&gt; {noreply, State} | {noreply, State, Timeout} | {stop, Reason, State}</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="terminate/2">terminate(Reason, State) -&gt; void()</h3>


<div class="description">

<p>Terminate all processes coupled to the page.</p>
</div></div>
<div class="function">
<h3 id="code_change/3">code_change(OldVsn, State, Extra) -&gt; {ok, NewState}</h3>


<div class="description">

<p>Convert process state when code is changed</p>
</div></div></div>

<authors>

<aname>Marc Worrell</aname>
<email>marc@worrell.nl</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
