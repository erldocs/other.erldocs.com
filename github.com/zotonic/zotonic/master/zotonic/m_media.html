<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>m_media (zotonic) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>m_media</h1>
<h2 class="modsummary">Model for medium database.</h2>
<div class="description">
<p>Model for medium database</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-wm_dict">wm_dict() = dict()</h3></div>
    <div class="type"><h3 id="type-wm_gb_tree">wm_gb_tree() = gb_tree()</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="m_find_value/3">m_find_value(Id::Key, M::Source, Context) -&gt; term()</h3>


<div class="description">

<p>Fetch the value for the key from a model source</p>
</div></div>
<div class="function">
<h3 id="m_to_list/2">m_to_list(M::Source, Context) -&gt; List</h3>


<div class="description">

<p>Transform a m_config value to a list, used for template loops</p>
</div></div>
<div class="function">
<h3 id="m_value/2">m_value(M::Source, Context) -&gt; term()</h3>


<div class="description">

<p>Transform a model value so that it can be formatted or piped through filters</p>
</div></div>
<div class="function">
<h3 id="identify/2">identify(Id::ImageFilePath, Context) -&gt; {ok, PropList} | {error, Reason}</h3>


<div class="description">

<p>Return the identification of a medium. Used by z_media_identify:identify()</p>
</div></div>
<div class="function">
<h3 id="exists/2">exists(Name, Context) -&gt; term()
</h3>


<div class="description">

<p>Check if a medium record exists</p>
</div></div>
<div class="function">
<h3 id="get/2">get(Id::RscId, Context) -&gt; PropList</h3>


<div class="description">

<p>Get the medium record with the id</p>
</div></div>
<div class="function">
<h3 id="get_file_data/2">get_file_data(Id, Context) -&gt; term()
</h3>


<div class="description">

<p>Return the contents of the file belonging to the media resource</p>
</div></div>
<div class="function">
<h3 id="get_by_filename/2">get_by_filename(Filename, Context) -&gt; term()
</h3>


<div class="description">

<p>Fetch a medium by filename</p>
</div></div>
<div class="function">
<h3 id="depiction/2">depiction(Id::RscId, Context) -&gt; PropList | undefined</h3>


<div class="description">

<p>Get the medium record that depicts the resource id. "depiction" Predicates are preferred, when
  they are missing then the attached medium record itself is returned.  We must be able to generate a preview
  from the medium.</p>
</div></div>
<div class="function">
<h3 id="depicts/2">depicts(Id::RscId, Context) -&gt; [Id]</h3>


<div class="description">

<p>Return the list of resources that is depicted by the medium (excluding the rsc itself)</p>
</div></div>
<div class="function">
<h3 id="delete/2">delete(Id::RscId, Context) -&gt; ok | {error, Reason}</h3>


<div class="description">

<p>Delete the medium at the id.  The file is queued for later deletion.</p>
</div></div>
<div class="function">
<h3 id="replace/3">replace(Id, Props, Context) -&gt; ok | {error, Reason}</h3>


<div class="description">

<p>Replace or insert a medium record for the page.  This is useful for non-file related media.
  Resets all non mentioned attributes.</p>
</div></div>
<div class="function">
<h3 id="duplicate/3">duplicate(FromId, ToId, Context) -&gt; term()
</h3>


<div class="description">

<p>Duplicate the media item from the id to the new-id. Called by m_rsc:duplicate/3</p>
</div></div>
<div class="function">
<h3 id="insert_file/2">insert_file(File, Context) -&gt; {ok, Id} | {error, Reason}</h3>


<div class="description">

<p>Make a new resource for the file, when the file is not in the archive dir then a copy is made in the archive dir</p>
</div></div>
<div class="function">
<h3 id="insert_file/3">insert_file(Upload, Props, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="insert_file/4">insert_file(Upload, Props, Options, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="insert_medium/4">insert_medium(Medium, RscProps, Options, Context) -&gt; term()
</h3>


<div class="description">

<p>Insert a medium, together with rsc props and an optional preview_url. This is used for importing media</p>
</div></div>
<div class="function">
<h3 id="replace_medium/5">replace_medium(Medium, RscId, RscProps, Options, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="insert_url/2">insert_url(Url::File, Context) -&gt; {ok, Id} | {error, Reason}</h3>


<div class="description">

<p>Make a new resource for the file based on a URL.</p>
</div></div>
<div class="function">
<h3 id="insert_url/3">insert_url(Url, Props, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="insert_url/4">insert_url(Url, Props, Options, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="replace_file/3">replace_file(File, RscId, Context) -&gt; {ok, Id} | {error, Reason}</h3>


<div class="description">

<p>Replaces a medium file, when the file is not in archive then a copy is made in the archive.
  When the resource is in the media category, then the category is adapted depending on the mime type of the uploaded file.</p>
</div></div>
<div class="function">
<h3 id="replace_file/4">replace_file(File, RscId, Props, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="replace_file/5">replace_file(File, RscId, Props, Opts, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="replace_file/6">replace_file(Upload, RscId, Props, MInfo, Opts, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="replace_url/4">replace_url(Url, RscId, Props, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="replace_url/5">replace_url(Url, RscId, Props, Options, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="download_file/1">download_file(Url) -&gt; term()
</h3>


<div class="description">

<p>Download a file from a http or data url.</p>
</div></div>
<div class="function">
<h3 id="download_file/2">download_file(Url, Options) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="save_preview_url/3">save_preview_url(RscId, Url, Context) -&gt; term()
</h3>


<div class="description">

<p>Save a new file from a preview_url as the preview of a medium</p>
</div></div>
<div class="function">
<h3 id="save_preview/4">save_preview(RscId, Data, Mime, Context) -&gt; term()
</h3>


<div class="description">

<p>Save a preview for a medium record. The data is saved to a file in the archive directory.</p>
</div></div>
<div class="function">
<h3 id="make_preview_unique/1">make_preview_unique(RscId::integer() | insert_rsc, Extension::string(), Context::#context{host=atom(), wm_reqdata=#wm_reqdata{socket=any(), metadata=wm_dict(), range=any(), peer=ip_address() (see module inet), bodyfetch=any(), log_data=any(), method=undefined | method() (see module wrq), scheme=undefined | scheme() (see module wrq), version=undefined | version() (see module wrq), disp_path=any(), path=undefined | string(), raw_path=undefined | string(), path_info=undefined | wm_dict(), path_tokens=undefined | [string()], app_root=undefined | string(), response_code=undefined | pos_integer(), max_recv_body=undefined | pos_integer(), req_cookie=undefined | string(), req_qs=undefined | string(), req_headers=undefined | wm_gb_tree(), req_body=any(), resp_redirect=undefined | boolean(), resp_headers=any(), resp_content_encoding=undefined | string(), resp_transfer_encoding=undefined | {string(), function()}, resp_content_type=undefined | string(), resp_chosen_charset=undefined | string(), resp_body=undefined | any(), is_range_ok=boolean(), host_tokens=undefined | [string()], port=undefined | port_number() (see module inet), cache=list()} | undefined, controller_module=atom(), session_pid=pid() | undefined, session_id=string() | undefined, page_pid=pid() | undefined, page_id=string() | undefined, ua_class=device_type() (see module ua_classifier) | undefined, depcache=any(), notifier=any(), session_manager=any(), dispatcher=any(), template_server=any(), scomp_server=any(), dropbox_server=any(), pivot_server=any(), module_indexer=any(), translation_table=any(), dbc=pid() | undefined, db={pid(), atom()} | undefined, language=atom(), tz=string() | binary(), acl=any(), user_id=integer() | undefined, updates=any(), actions=any(), content_scripts=any(), scripts=any(), wire=any(), validators=any(), render=any(), props=any()}) -&gt; filename() (see module file)</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="is_unique_file/2">is_unique_file(Filename, Context) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>

<aname>Marc Worrell</aname>
<email>marc@worrell.nl</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
