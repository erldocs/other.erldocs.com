<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>z_depcache (zotonic) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>z_depcache</h1>
<h2 class="modsummary">Simple caching server with dependency checks and local in process memoization of lookups.</h2>
<div class="description">
<p>Simple caching server with dependency checks and local in process memoization of lookups.</p></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="start_link/1">start_link(SiteProps) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="memo/2">memo(Function, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="memo/3">memo(Function, MaxAge, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="memo/4">memo(F, Key, MaxAge, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="memo/5">memo(F, Key, MaxAge, Dep, Context) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="set/3">set(Key, Data, Context) -&gt; void()</h3>


<div class="description">

<p>Add the key to the depcache, hold it for 3600 seconds and no dependencies</p>
</div></div>
<div class="function">
<h3 id="set/4">set(Key, Data, MaxAge, Context) -&gt; void()</h3>


<div class="description">

<p>Add the key to the depcache, hold it for MaxAge seconds and no dependencies</p>
</div></div>
<div class="function">
<h3 id="set/5">set(Key, Data, MaxAge, Depend, Context) -&gt; void()</h3>


<div class="description">

<p>Add the key to the depcache, hold it for MaxAge seconds and check the dependencies</p>
</div></div>
<div class="function">
<h3 id="get_wait/2">get_wait(Key, Context) -&gt; {ok, Data} | undefined</h3>


<div class="description">

<p>Fetch the key from the cache, when the key does not exist then lock the entry and let
  the calling process insert the value. All other processes requesting the key will wait till
  the key is updated and receive the key's new value.</p>
</div></div>
<div class="function">
<h3 id="get/2">get(Key, Context) -&gt; {ok, Data} | undefined</h3>


<div class="description">

<p>Fetch the key from the cache, return the data or an undefined if not found (or not valid)</p>
</div></div>
<div class="function">
<h3 id="get_subkey/3">get_subkey(Key, SubKey, Context) -&gt; {ok, Data} | undefined</h3>


<div class="description">

<p>Fetch the key from the cache, return the data or an undefined if not found (or not valid)</p>
</div></div>
<div class="function">
<h3 id="get/3">get(Key, SubKey, Context) -&gt; {ok, Data} | undefined</h3>


<div class="description">

<p>Fetch the key from the cache, return the data or an undefined if not found (or not valid)</p>
</div></div>
<div class="function">
<h3 id="flush/2">flush(Key, Context::#context{}) -&gt; void()</h3>


<div class="description">

<p>Flush the key and all keys depending on the key</p>
</div></div>
<div class="function">
<h3 id="flush/1">flush(Context::#context{}) -&gt; void()</h3>


<div class="description">

<p>Flush all keys from the caches</p>
</div></div>
<div class="function">
<h3 id="tick/1">tick(Context::#context{}) -&gt; none()</h3>


<div class="description">

<p>Periodic tick used for incrementing the clock</p>
</div></div>
<div class="function">
<h3 id="size/1">size(Context::#context{}) -&gt; int()</h3>


<div class="description">

<p>Return the total memory size of all stored terms</p>
</div></div>
<div class="function">
<h3 id="in_process/0">in_process() -&gt; term()
</h3>


<div class="description">

<p>Check if we use a local process dict cache</p>
</div></div>
<div class="function">
<h3 id="in_process/1">in_process(X1) -&gt; term()
</h3>


<div class="description">

<p>Enable or disable the in-process caching using the process dictionary</p>
</div></div>
<div class="function">
<h3 id="flush_process_dict/0">flush_process_dict() -&gt; term()
</h3>


<div class="description">

<p>Flush all items memoized in the process dictionary.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(SiteProps) -&gt; {ok, State}</h3>


<div class="description">

<p>Initialize the depcache.  Creates ets tables for the deps, meta and data.  Spawns garbage collector.</p>
</div></div>
<div class="function">
<h3 id="handle_call/3">handle_call(X1, From, State) -&gt; term()
</h3>


<div class="description">

<p>Return the ets tables used by the cache</p>
</div></div>
<div class="function">
<h3 id="handle_cast/2">handle_cast(Msg, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="handle_info/2">handle_info(Msg, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="terminate/2">terminate(Reason, State) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="code_change/3">code_change(OldVersion, State, Extra) -&gt; term()
</h3>


<div class="description">
 </div></div>
<div class="function">
<h3 id="cleanup/5">cleanup(Pid, MetaTable, DepsTable, DataTable, MemoryMax) -&gt; term()
</h3>


<div class="description">

<p>Cleanup process for the depcache.  Periodically checks a batch of depcache items for their validity.
       Asks the depcache server to delete invalidated items.  When the load of the data table is too high then
       This cleanup process starts to delete random entries.  By using a random delete we don't need to keep
       a LRU list, which is a bit expensive.</p>
</div></div>
<div class="function">
<h3 id="cleanup/9">cleanup(Pid, MetaTable, DepsTable, DataTable, MemoryMax, SlotNr, Now, Mode, Ct) -&gt; term()
</h3>


<div class="description">
 </div></div></div>

<authors>

<aname>Marc Worrell</aname>
<email>marc@worrell.nl</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
