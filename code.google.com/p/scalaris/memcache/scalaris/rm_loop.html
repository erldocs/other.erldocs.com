<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>rm_loop (scalaris) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>rm_loop</h1>
<h2 class="modsummary">   Shared process for the ring maintenance implementations.</h2>
<div class="description">
<p>   Shared process for the ring maintenance implementations.</p></div>
<div id="types" class="category"><h4><a href="#types">Types</a></h4><hr />
    <div class="type"><h3 id="type-message">message() = {get_neighb_tid, SourcePid :: <a href="comm.html#type-erl_local_pid" class="seealso">comm:erl_local_pid()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {zombie, Node :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {crash, DeadPid :: <a href="comm.html#type-mypid" class="seealso">comm:mypid()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {check_ring,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Token :: integer() >= 0,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Master :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {init_check_ring, Token :: integer() >= 0}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {notify_new_pred, NewPred :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {notify_new_succ, NewSucc :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {pred_left,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldPred :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PredsPred :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {succ_left,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldSucc :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SuccsSucc :: <a href="node.html#type-node_type" class="seealso">node:node_type()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {update_id, NewId :: <a href="rt_chord.html#type-key" class="seealso">rt_chord:key()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {web_debug_info, Requestor :: <a href="comm.html#type-erl_local_pid" class="seealso">comm:erl_local_pid()</a>}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {subscribe,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pid :: pid(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tag :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#type-subscriber_filter_fun" class="seealso">subscriber_filter_fun()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#type-subscriber_exec_fun" class="seealso">subscriber_exec_fun()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxCalls :: integer() >= 1 | inf}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| {unsubscribe, Pid :: pid(), Tag :: any()}</h3></div>
    <div class="type"><h3 id="type-state_init">state_init() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{NeighbTable :: <a href="#type-tid" class="seealso">tid()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RM_State :: <a href="rm_tman.html#type-state" class="seealso">rm_tman:state()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubscrTable :: <a href="#type-tid" class="seealso">tid()</a>}</h3></div>
    <div class="type"><h3 id="type-state_uninit">state_uninit() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{uninit,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NeighbTable :: <a href="#type-tid" class="seealso">tid()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubscrTable :: <a href="#type-tid" class="seealso">tid()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueuedMessages :: <a href="msg_queue.html#type-msg_queue" class="seealso">msg_queue:msg_queue()</a>}</h3></div>
    <div class="type"><h3 id="type-subscriber_exec_fun">subscriber_exec_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((Subscriber :: pid() | null,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tag :: any(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any())</h3></div>
    <div class="type"><h3 id="type-subscriber_filter_fun">subscriber_filter_fun() = <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun((OldNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NewNeighbors :: <a href="nodelist.html#type-neighborhood" class="seealso">nodelist:neighborhood()</a>) -><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean())</h3></div></div>
<div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr />
<div class="function">
<h3 id="activate/1">activate(Me::node_type() (see module node), Pred::node_type() (see module node), Succ::node_type() (see module node)) -&gt; ok</h3>


<div class="description">

<p>Sends an initialization message to the node's rm_tman process.</p>
</div></div>
<div class="function">
<h3 id="get_neighbors/1">get_neighbors(Table::tid()) -&gt; neighborhood() (see module nodelist)</h3>


<div class="description">

<p>Returns the current neighborhood structure.</p>
</div></div>
<div class="function">
<h3 id="has_left/1">has_left(Table::tid()) -&gt; boolean()</h3>


<div class="description">

<p>Returns whether the current node has already left the ring
       (intermediate state before the node is killed or jumping to another
       ID).</p>
</div></div>
<div class="function">
<h3 id="get_neighbors_table/0">get_neighbors_table() -&gt; tid()</h3>


<div class="description">

<p>Gets the tid of the table rm_tman uses to store its neighbors.
       Beware: this is a synchronous call to the rm_tman process!</p>
</div></div>
<div class="function">
<h3 id="leave/0">leave() -&gt; ok</h3>


<div class="description">

<p>Notifies the successor and predecessor that the current dht_node is
       going to leave. Will reset the ring_maintenance state to uninit
       and inform the dht_node process (message handled in dht_node_move).
       Note: only call this method from inside the dht_node process!</p>
</div></div>
<div class="function">
<h3 id="notify_new_succ/1">notify_new_succ(Node::mypid() (see module comm), NewSucc::node_type() (see module node)) -&gt; ok</h3>


<div class="description">

<p>Sends a message to the remote node's ring_maintenance process notifying
       it of a new successor.</p>
</div></div>
<div class="function">
<h3 id="notify_new_pred/1">notify_new_pred(Node::mypid() (see module comm), NewPred::node_type() (see module node)) -&gt; ok</h3>


<div class="description">

<p>Sends a message to the remote node's ring_maintenance process notifying
       it of a new predecessor.</p>
</div></div>
<div class="function">
<h3 id="update_id/1">update_id(NewId::key() (see module rt_chord)) -&gt; ok</h3>


<div class="description">

<p>Updates a dht node's id and sends the ring maintenance a message about
       the change.
       Beware: the only allowed node id changes are between the node's
       predecessor and successor!</p>
</div></div>
<div class="function">
<h3 id="send_changes_to_subscriber/1">send_changes_to_subscriber(Pid::pid(), Tag::any(), OldNeighbors::neighborhood() (see module nodelist), NewNeighbors::neighborhood() (see module nodelist)) -&gt; ok</h3>


<div class="description">

<p>Default function to send changes to a subscriber when the neighborhood
       changes.</p>
</div></div>
<div class="function">
<h3 id="subscribe_default_filter/1">subscribe_default_filter(OldNeighbors::neighborhood() (see module nodelist), NewNeighbors::neighborhood() (see module nodelist)) -&gt; boolean()</h3>


<div class="description">

<p>Default filter function for subscriptions that returns true if the
       old neighborhood differs from the new neighborhood.</p>
</div></div>
<div class="function">
<h3 id="subscribe_node_change_filter/1">subscribe_node_change_filter(OldNeighbors::neighborhood() (see module nodelist), NewNeighbors::neighborhood() (see module nodelist)) -&gt; boolean()</h3>


<div class="description">

<p>Filter function for subscriptions that returns true if the
       old neighborhood's base node differs from the new node.
       Note: a node can only ever get newer, e.g. change its ID and increase
       its ID version.</p>
</div></div>
<div class="function">
<h3 id="subscribe_dneighbor_change_filter/1">subscribe_dneighbor_change_filter(OldNeighbors::neighborhood() (see module nodelist), NewNeighbors::neighborhood() (see module nodelist)) -&gt; boolean()</h3>


<div class="description">

<p>Filter function for subscriptions that returns true if the
       pred, succ or base node changed.</p>
</div></div>
<div class="function">
<h3 id="subscribe/1">subscribe(Pid::pid() | null, Tag::any(), FilterFun::subscriber_filter_fun(), ExecFun::subscriber_exec_fun(), MaxCalls::pos_integer() | inf) -&gt; ok</h3>


<div class="description">

<p>Registers the given function to be called when the dht_node changes its
       id. It will get the given Pid and the new node as its parameters.</p>
</div></div>
<div class="function">
<h3 id="unsubscribe/1">unsubscribe(Pid::pid() | null, Tag::any()) -&gt; ok</h3>


<div class="description">

<p>Un-registers the given process with the given tag from node change
       updates.</p>
</div></div>
<div class="function">
<h3 id="start_link/1">start_link(DHTNodeGroup::groupname() (see module pid_groups)) -&gt; {ok, pid()}</h3>


<div class="description">

<p>Starts the ring maintenance process, registers it with the
       process dictionary and returns its pid for use by a supervisor.</p>
</div></div>
<div class="function">
<h3 id="init/1">init(X1::any()) -&gt; {'$gen_component', [{on_handler, Handler::on_startup}], State::state_uninit()}</h3>


<div class="description">

<p>Initialises the module with an uninitialized state.</p>
</div></div>
<div class="function">
<h3 id="on_startup/1">on_startup(Msg::message(), X2::state_uninit()) -&gt; state_uninit()</h3>


<div class="description">

<p>Message handler during start up phase (will change to on/2 when a
       'init_rm' message is received).</p>
</div></div>
<div class="function">
<h3 id="on/1">on(Message::message() | custom_message() (see module rm_tman), State::state_init()) -&gt; state_init()</h3>


<div class="description">

<p>Message handler when the rm_loop module is fully initialized.</p>
</div></div>
<div class="function">
<h3 id="update_neighbors/1">update_neighbors(Table::tid(), Neighborhood::neighborhood() (see module nodelist)) -&gt; ok</h3>


<div class="description">

<p>Updates the stored neighborhood object. Only use inside the rm_loop
       process, i.e. in the rm_* modules called from here. Fails otherwise.</p>
</div></div></div>

<authors>

<aname>Nico Kruber</aname>
<email>kruber@zib.de</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
