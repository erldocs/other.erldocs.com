<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>clone_module (translib) -  (Erlang Documentation)</title>
    <link href="/erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-54292016-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>clone_module</h1>
<h2 class="modsummary">Parse transformer that builds a module by cloning the content of another  
one.</h2>
<div class="description">
<p>Parse transformer that builds a module by cloning the content of another  
one.</p>
 
  <p>Performs parse transformation that makes a copy of a specified module, from
  his beam file (by default) or his source file. This transformation uses the
  abstract code of a module, the source module, and merges it with the abstract
  code of another one, the destination module. It copies all attributes and
  functions found in the abstract code of the source module, except <code>module</code>
  attributes. For functions with same name and arity in the source module and
  the destination module, we only keep the ones coming from the destination
  module. To deal with this goal and make the parsing easier, This module
  also implements the <a href="gen_trans.html" class="seealso">gen_trans</a> behaviour.</p>
 
  <p>To perform this kind of transformation, we must define the attribute <code>clone</code>  
following the syntax</p>
 
      <p><div class="example">
  <pre class="sh_erlang">  -clone({Module, Options}).</pre>
      </div></p>
 
  <p>where <code>Module</code> is the name of the source module and <code>Options</code> is a list of  
options. Supported options are:</p>
 
  <list>
    <item><p><code>{source, Filename}</code>: <code>Filename</code> refers to an Erlang source file.
  it can be an abosulte name or a relative one.</p></item>
    <item><p><code>{source, {Apps, Filename}}</code>: <code>Filename</code> refers to an Erlang source
  file. This is a relative name from the directory of the application <code>Apps</code>.
  <code>Apps</code> is an atom.</p></item>
    <item><p><code>{beam, Filename}</code>: <code>Filename</code> refers to an Erlang beam file.</p></item>
    <item><p><code>{unused, [{Fun,Arity}]}</code>: With this option, we can define a list of
  functions that are not cloned.</p></item>
  </list>
 
  <p>This is usefull to speficy the Erlang source file of a source module if we
  cannot extract the abstract code from the beam file (See
  <url href="http://www.erlang.org/doc/man/beam_lib.html#debug_info">beam_lib(3)</url>).</p>
 
  <p><a href="transhell.html" class="seealso">transhell</a> uses this parse transformation with the module
  <url href="http://www.erlang.org/doc/man/shell.html">shell</url>.</p>
 
  <p><em><marker id="Examples">Examples</marker></em></p>
 
      <p><div class="example">
  <pre class="sh_erlang">  -clone({lists, []}).
  -clone({lists, [{source, {"/usr/lib/erlang/lib/stdlib-1.15.5/src/lists.erl"}]}).
  -clone({lists, [{source, {stdlib, "src/lists.erl"}}]}).
  -clone({string, [{unused, [{to_float, 1}, {to_integer, 1}]}]}).</pre>
      </div></p>
 
 
  <p><br />
  <em><marker id="EXPORTS">EXPORTS</marker></em>
 <marker id="parse_transform-2"> </marker>
 </p><pre class="sh_erlang"> parse_transform(Forms, Options) -&gt; NewForms | {error, Errors, []}</pre><p>
  <div class="REFBODY">
    Types:
    <div class="REFTYPES">
      <pre class="sh_erlang">      Forms, NewForms = [erlang_form()]
      Options = [compiler_options()]
      Errors = [{Filename, [ErrorInfo]}]
         FileName = atom() | string()
         ErrorInfo = see separate description below.</pre>
    </div>
 
    <p>Implements the actual transformation at compile time. This function is
    called by the compiler to do the source code transformation if and when the
    option <code>{parse_transform, clone_module}</code> is passed to the compiler. This
    function starts a new <url href="gen_trans.xml"><code>gen_trans</code></url> by calling <url href="gen_trans.xml#start-3"><code>gen_trans:start/3</code></url> with <code>clone_module</code> as callback module.</p>
 
    <p>If the abstract code format is successfully parsed, the function returns
    <code>NewForms</code>. if it fails the function returns <code>{error, Errors, []}</code>.</p>
 
    <p>See <a href="http://www.erlang.org/doc/man/compile.html" target="_top">compile(3)</a>.</p>
 
  </div></p>
 
 <p><marker id="format_error-1"> </marker>
 </p><pre class="sh_erlang"> format_error(ErrCode) -&gt; ErrMessage</pre><p>
  <div class="REFBODY">
    Types:
    <div class="REFTYPES">
      <pre class="sh_erlang">      Errcode = term()
      ErrMessage = string()</pre>
    </div>
 
    <p>Takes an error code returned by one of the other functions in the module
    and creates a textual description of the error. The <code>ErrCode</code> can be either
    of the following terms. The <code>format_error/1</code> function returns a descriptive    
string which describes the error.</p>
 
    <list>
       <item><code>redefine_clone</code>. The clone attribute are redefined.</item>
       <item><code>no_module</code>. The module specified to the clone attribute was not found.</item>
       <item><code>no_abstract_code</code>. Abstract code chunk of the beam file is empty.</item>
       <item><code>no_source</code>. The source file specified as argument to the clone attribute was not found.</item>
       <item><code>{beam_lib_error, Error}</code>. <code>Error</code> returned by the module <code>beam_lib</code>.</item>
       <item><code>{epp_error, Error}</code>. <code>Error</code> returned by the module <code>epp</code>.</item>
       <item><code>{erl_lint_error, Errors}</code>. <code>Errors</code> returned by the module <code>erl_lint</code>.</item>
       <item>Other <code>ErrCode</code>. Unknown error: <code>ErrCode</code>.</item>
    </list>
 
  </div></p>
 
 
  <p><br />
  <em><marker id="Error_Information">Error Information</marker></em></p>
 
  <p>The <code>ErrorInfo</code> mentioned above is the standard <code>ErrorInfo</code> structure which
  is returned from <code>lambda_expr</code> module. It has the following format:</p>
 
  <p><div class="example">
 <pre class="sh_erlang">    {ErrorLine, lambda_expr, ErrorDescriptor}</pre>
  </div></p>
 
  <p>A string which describes the error is obtained with the following call:</p>
 
  <p><div class="example">
 <pre class="sh_erlang">    apply(lambda_expr, format_error, ErrorDescriptor)</pre>
  </div>
 </p></div>


<authors>

<aname>Christopher Faulet</aname>
<email>christopher.faulet@capflam.org</email></authors>
      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="/erldocs.js"></script>
  </body>
</html>
